/*! iScroll v5.1.1 ~ (c) 2008-2014 Matteo Spinelli ~ http://cubiq.org/license */

/* Pretty handling of time axes.

Copyright (c) 2007-2013 IOLA and Ole Laursen.
Licensed under the MIT license.

Set axis.mode to "time" to enable. See the section "Time series data" in
API.txt for details.

*/

/* Flot plugin for thresholding data.

Copyright (c) 2007-2013 IOLA and Ole Laursen.
Licensed under the MIT license.

The plugin supports these options:

    series: {
        threshold: {
            below: number,
            above: mumber,
            color: colorspec
        }
    }

It can also be applied to a single series, like this:

    $.plot( $("#placeholder"), [{
        data: [ ... ],
        threshold: { ... }
    }])

An array can be passed for multiple thresholding, like this:

    threshold: [{
        below: number1,
        color: color1
    },{
        above: number2,
        color: color2
    }]

These multiple threshold objects can be passed in any order since they are
sorted by the processing function.

The data points below "below" are drawn with the specified color. This makes
it easy to mark points below 0, e.g. for budget data.

Internally, the plugin works by splitting the data into two series, above and
below the threshold. The extra series below the threshold will have its label
cleared and the special "originSeries" attribute set to the original series.
You may need to check for this in hover events.

*/

/*  Geodesy representation conversion functions (c) Chris Veness 2002-2012                        */

/*  Latitude/longitude spherical geodesy formulae & scripts (c) Chris Veness 2002-2012            */

/*
 Leaflet 0.8-dev (a5e8ee9), a JS library for interactive maps. http://leafletjs.com
 (c) 2010-2014 Vladimir Agafonkin, (c) 2010-2011 CloudMade
*/

/* ----------------------------------
 * TOGGLE v2.0.1
 * Licensed under The MIT License
 * http://opensource.org/licenses/MIT
 * ---------------------------------- */

/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js*/

/* ========================================================================
 * Bootstrap: transition.js v3.1.1
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

function LatLon(e,t,n){typeof n=="undefined"&&(n=6371),this._lat=typeof e=="number"?e:typeof e=="string"&&e.trim()!=""?+e:NaN,this._lon=typeof t=="number"?t:typeof t=="string"&&t.trim()!=""?+t:NaN,this._radius=typeof n=="number"?n:typeof n=="string"&&trim(t)!=""?+n:NaN}(function(e,t,n){function s(e,n){this.wrapper=typeof e=="string"?t.querySelector(e):e,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={resizeScrollbars:!0,mouseWheelSpeed:20,snapThreshold:.334,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0};for(var r in n)this.options[r]=n[r];this.translateZ=this.options.HWCompositing&&i.hasPerspective?" translateZ(0)":"",this.options.useTransition=i.hasTransition&&this.options.useTransition,this.options.useTransform=i.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY=this.options.eventPassthrough=="vertical"?!1:this.options.scrollY,this.options.scrollX=this.options.eventPassthrough=="horizontal"?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing=typeof this.options.bounceEasing=="string"?i.ease[this.options.bounceEasing]||i.ease.circular:this.options.bounceEasing,this.options.resizePolling=this.options.resizePolling===undefined?60:this.options.resizePolling,this.options.tap===!0&&(this.options.tap="tap"),this.options.shrinkScrollbars=="scale"&&(this.options.useTransition=!1),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}function o(e,n,r){var i=t.createElement("div"),s=t.createElement("div");return r===!0&&(i.style.cssText="position:absolute;z-index:9999",s.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px"),s.className="iScrollIndicator",e=="h"?(r===!0&&(i.style.cssText+=";height:7px;left:2px;right:2px;bottom:0",s.style.height="100%"),i.className="iScrollHorizontalScrollbar"):(r===!0&&(i.style.cssText+=";width:7px;bottom:2px;top:2px;right:1px",s.style.width="100%"),i.className="iScrollVerticalScrollbar"),i.style.cssText+=";overflow:hidden",n||(i.style.pointerEvents="none"),i.appendChild(s),i}function u(n,r){this.wrapper=typeof r.el=="string"?t.querySelector(r.el):r.el,this.wrapperStyle=this.wrapper.style,this.indicator=this.wrapper.children[0],this.indicatorStyle=this.indicator.style,this.scroller=n,this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,shrink:!1,fade:!1,speedRatioX:0,speedRatioY:0};for(var s in r)this.options[s]=r[s];this.sizeRatioX=1,this.sizeRatioY=1,this.maxPosX=0,this.maxPosY=0,this.options.interactive&&(this.options.disableTouch||(i.addEvent(this.indicator,"touchstart",this),i.addEvent(e,"touchend",this)),this.options.disablePointer||(i.addEvent(this.indicator,"MSPointerDown",this),i.addEvent(e,"MSPointerUp",this)),this.options.disableMouse||(i.addEvent(this.indicator,"mousedown",this),i.addEvent(e,"mouseup",this))),this.options.fade&&(this.wrapperStyle[i.style.transform]=this.scroller.translateZ,this.wrapperStyle[i.style.transitionDuration]=i.isBadAndroid?"0.001s":"0ms",this.wrapperStyle.opacity="0")}var r=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){e.setTimeout(t,1e3/60)},i=function(){function o(e){return s===!1?!1:s===""?e:s+e.charAt(0).toUpperCase()+e.substr(1)}var r={},i=t.createElement("div").style,s=function(){var e=["t","webkitT","MozT","msT","OT"],t,n=0,r=e.length;for(;n<r;n++){t=e[n]+"ransform";if(t in i)return e[n].substr(0,e[n].length-1)}return!1}();r.getTime=Date.now||function(){return(new Date).getTime()},r.extend=function(e,t){for(var n in t)e[n]=t[n]},r.addEvent=function(e,t,n,r){e.addEventListener(t,n,!!r)},r.removeEvent=function(e,t,n,r){e.removeEventListener(t,n,!!r)},r.momentum=function(e,t,r,i,s,o){var u=e-t,a=n.abs(u)/r,f,l;return o=o===undefined?6e-4:o,f=e+a*a/(2*o)*(u<0?-1:1),l=a/o,f<i?(f=s?i-s/2.5*(a/8):i,u=n.abs(f-e),l=u/a):f>0&&(f=s?s/2.5*(a/8):0,u=n.abs(e)+f,l=u/a),{destination:n.round(f),duration:l}};var u=o("transform");return r.extend(r,{hasTransform:u!==!1,hasPerspective:o("perspective")in i,hasTouch:"ontouchstart"in e,hasPointer:navigator.msPointerEnabled,hasTransition:o("transition")in i}),r.isBadAndroid=/Android /.test(e.navigator.appVersion)&&!/Chrome\/\d/.test(e.navigator.appVersion),r.extend(r.style={},{transform:u,transitionTimingFunction:o("transitionTimingFunction"),transitionDuration:o("transitionDuration"),transitionDelay:o("transitionDelay"),transformOrigin:o("transformOrigin")}),r.hasClass=function(e,t){var n=new RegExp("(^|\\s)"+t+"(\\s|$)");return n.test(e.className)},r.addClass=function(e,t){if(r.hasClass(e,t))return;var n=e.className.split(" ");n.push(t),e.className=n.join(" ")},r.removeClass=function(e,t){if(!r.hasClass(e,t))return;var n=new RegExp("(^|\\s)"+t+"(\\s|$)","g");e.className=e.className.replace(n," ")},r.offset=function(e){var t=-e.offsetLeft,n=-e.offsetTop;while(e=e.offsetParent)t-=e.offsetLeft,n-=e.offsetTop;return{left:t,top:n}},r.preventDefaultException=function(e,t){for(var n in t)if(t[n].test(e[n]))return!0;return!1},r.extend(r.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),r.extend(r.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(e){return e*(2-e)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(e){return n.sqrt(1- --e*e)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(e){var t=4;return(e-=1)*e*((t+1)*e+t)+1}},bounce:{style:"",fn:function(e){return(e/=1)<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}},elastic:{style:"",fn:function(e){var t=.22,r=.4;return e===0?0:e==1?1:r*n.pow(2,-10*e)*n.sin((e-t/4)*2*n.PI/t)+1}}}),r.tap=function(e,n){var r=t.createEvent("Event");r.initEvent(n,!0,!0),r.pageX=e.pageX,r.pageY=e.pageY,e.target.dispatchEvent(r)},r.click=function(e){var n=e.target,r;/(SELECT|INPUT|TEXTAREA)/i.test(n.tagName)||(r=t.createEvent("MouseEvents"),r.initMouseEvent("click",!0,!0,e.view,1,n.screenX,n.screenY,n.clientX,n.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),r._constructed=!0,n.dispatchEvent(r))},r}();s.prototype={version:"5.1.1",_init:function(){this._initEvents(),(this.options.scrollbars||this.options.indicators)&&this._initIndicators(),this.options.mouseWheel&&this._initWheel(),this.options.snap&&this._initSnap(),this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0),this._execEvent("destroy")},_transitionEnd:function(e){if(e.target!=this.scroller||!this.isInTransition)return;this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd"))},_start:function(e){if(i.eventType[e.type]!=1&&e.button!==0)return;if(!this.enabled||this.initiated&&i.eventType[e.type]!==this.initiated)return;this.options.preventDefault&&!i.isBadAndroid&&!i.preventDefaultException(e.target,this.options.preventDefaultException)&&e.preventDefault();var t=e.touches?e.touches[0]:e,r;this.initiated=i.eventType[e.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this._transitionTime(),this.startTime=i.getTime(),this.options.useTransition&&this.isInTransition?(this.isInTransition=!1,r=this.getComputedPosition(),this._translate(n.round(r.x),n.round(r.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=t.pageX,this.pointY=t.pageY,this._execEvent("beforeScrollStart")},_move:function(e){if(!this.enabled||i.eventType[e.type]!==this.initiated)return;this.options.preventDefault&&e.preventDefault();var t=e.touches?e.touches[0]:e,r=t.pageX-this.pointX,s=t.pageY-this.pointY,o=i.getTime(),u,a,f,l;this.pointX=t.pageX,this.pointY=t.pageY,this.distX+=r,this.distY+=s,f=n.abs(this.distX),l=n.abs(this.distY);if(o-this.endTime>300&&f<10&&l<10)return;!this.directionLocked&&!this.options.freeScroll&&(f>l+this.options.directionLockThreshold?this.directionLocked="h":l>=f+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n");if(this.directionLocked=="h"){if(this.options.eventPassthrough=="vertical")e.preventDefault();else if(this.options.eventPassthrough=="horizontal"){this.initiated=!1;return}s=0}else if(this.directionLocked=="v"){if(this.options.eventPassthrough=="horizontal")e.preventDefault();else if(this.options.eventPassthrough=="vertical"){this.initiated=!1;return}r=0}r=this.hasHorizontalScroll?r:0,s=this.hasVerticalScroll?s:0,u=this.x+r,a=this.y+s;if(u>0||u<this.maxScrollX)u=this.options.bounce?this.x+r/3:u>0?0:this.maxScrollX;if(a>0||a<this.maxScrollY)a=this.options.bounce?this.y+s/3:a>0?0:this.maxScrollY;this.directionX=r>0?-1:r<0?1:0,this.directionY=s>0?-1:s<0?1:0,this.moved||this._execEvent("scrollStart"),this.moved=!0,this._translate(u,a),o-this.startTime>300&&(this.startTime=o,this.startX=this.x,this.startY=this.y)},_end:function(e){if(!this.enabled||i.eventType[e.type]!==this.initiated)return;this.options.preventDefault&&!i.preventDefaultException(e.target,this.options.preventDefaultException)&&e.preventDefault();var t=e.changedTouches?e.changedTouches[0]:e,r,s,o=i.getTime()-this.startTime,u=n.round(this.x),a=n.round(this.y),f=n.abs(u-this.startX),l=n.abs(a-this.startY),c=0,h="";this.isInTransition=0,this.initiated=0,this.endTime=i.getTime();if(this.resetPosition(this.options.bounceTime))return;this.scrollTo(u,a);if(!this.moved){this.options.tap&&i.tap(e,this.options.tap),this.options.click&&i.click(e),this._execEvent("scrollCancel");return}if(this._events.flick&&o<200&&f<100&&l<100){this._execEvent("flick");return}this.options.momentum&&o<300&&(r=this.hasHorizontalScroll?i.momentum(this.x,this.startX,o,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:u,duration:0},s=this.hasVerticalScroll?i.momentum(this.y,this.startY,o,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:a,duration:0},u=r.destination,a=s.destination,c=n.max(r.duration,s.duration),this.isInTransition=1);if(this.options.snap){var p=this._nearestSnap(u,a);this.currentPage=p,c=this.options.snapSpeed||n.max(n.max(n.min(n.abs(u-p.x),1e3),n.min(n.abs(a-p.y),1e3)),300),u=p.x,a=p.y,this.directionX=0,this.directionY=0,h=this.options.bounceEasing}if(u!=this.x||a!=this.y){if(u>0||u<this.maxScrollX||a>0||a<this.maxScrollY)h=i.ease.quadratic;this.scrollTo(u,a,c,h);return}this._execEvent("scrollEnd")},_resize:function(){var e=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){e.refresh()},this.options.resizePolling)},resetPosition:function(e){var t=this.x,n=this.y;return e=e||0,!this.hasHorizontalScroll||this.x>0?t=0:this.x<this.maxScrollX&&(t=this.maxScrollX),!this.hasVerticalScroll||this.y>0?n=0:this.y<this.maxScrollY&&(n=this.maxScrollY),t==this.x&&n==this.y?!1:(this.scrollTo(t,n,e,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){var e=this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=this.scroller.offsetWidth,this.scrollerHeight=this.scroller.offsetHeight,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=i.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},on:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},off:function(e,t){if(!this._events[e])return;var n=this._events[e].indexOf(t);n>-1&&this._events[e].splice(n,1)},_execEvent:function(e){if(!this._events[e])return;var t=0,n=this._events[e].length;if(!n)return;for(;t<n;t++)this._events[e][t].apply(this,[].slice.call(arguments,1))},scrollBy:function(e,t,n,r){e=this.x+e,t=this.y+t,n=n||0,this.scrollTo(e,t,n,r)},scrollTo:function(e,t,n,r){r=r||i.ease.circular,this.isInTransition=this.options.useTransition&&n>0,!n||this.options.useTransition&&r.style?(this._transitionTimingFunction(r.style),this._transitionTime(n),this._translate(e,t)):this._animate(e,t,n,r.fn)},scrollToElement:function(e,t,r,s,o){e=e.nodeType?e:this.scroller.querySelector(e);if(!e)return;var u=i.offset(e);u.left-=this.wrapperOffset.left,u.top-=this.wrapperOffset.top,r===!0&&(r=n.round(e.offsetWidth/2-this.wrapper.offsetWidth/2)),s===!0&&(s=n.round(e.offsetHeight/2-this.wrapper.offsetHeight/2)),u.left-=r||0,u.top-=s||0,u.left=u.left>0?0:u.left<this.maxScrollX?this.maxScrollX:u.left,u.top=u.top>0?0:u.top<this.maxScrollY?this.maxScrollY:u.top,t=t===undefined||t===null||t==="auto"?n.max(n.abs(this.x-u.left),n.abs(this.y-u.top)):t,this.scrollTo(u.left,u.top,t,o)},_transitionTime:function(e){e=e||0,this.scrollerStyle[i.style.transitionDuration]=e+"ms",!e&&i.isBadAndroid&&(this.scrollerStyle[i.style.transitionDuration]="0.001s");if(this.indicators)for(var t=this.indicators.length;t--;)this.indicators[t].transitionTime(e)},_transitionTimingFunction:function(e){this.scrollerStyle[i.style.transitionTimingFunction]=e;if(this.indicators)for(var t=this.indicators.length;t--;)this.indicators[t].transitionTimingFunction(e)},_translate:function(e,t){this.options.useTransform?this.scrollerStyle[i.style.transform]="translate("+e+"px,"+t+"px)"+this.translateZ:(e=n.round(e),t=n.round(t),this.scrollerStyle.left=e+"px",this.scrollerStyle.top=t+"px"),this.x=e,this.y=t;if(this.indicators)for(var r=this.indicators.length;r--;)this.indicators[r].updatePosition()},_initEvents:function(t){var n=t?i.removeEvent:i.addEvent,r=this.options.bindToWrapper?this.wrapper:e;n(e,"orientationchange",this),n(e,"resize",this),this.options.click&&n(this.wrapper,"click",this,!0),this.options.disableMouse||(n(this.wrapper,"mousedown",this),n(r,"mousemove",this),n(r,"mousecancel",this),n(r,"mouseup",this)),i.hasPointer&&!this.options.disablePointer&&(n(this.wrapper,"MSPointerDown",this),n(r,"MSPointerMove",this),n(r,"MSPointerCancel",this),n(r,"MSPointerUp",this)),i.hasTouch&&!this.options.disableTouch&&(n(this.wrapper,"touchstart",this),n(r,"touchmove",this),n(r,"touchcancel",this),n(r,"touchend",this)),n(this.scroller,"transitionend",this),n(this.scroller,"webkitTransitionEnd",this),n(this.scroller,"oTransitionEnd",this),n(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var t=e.getComputedStyle(this.scroller,null),n,r;return this.options.useTransform?(t=t[i.style.transform].split(")")[0].split(", "),n=+(t[12]||t[4]),r=+(t[13]||t[5])):(n=+t.left.replace(/[^-\d.]/g,""),r=+t.top.replace(/[^-\d.]/g,"")),{x:n,y:r}},_initIndicators:function(){function a(e){for(var t=i.indicators.length;t--;)e.call(i.indicators[t])}var e=this.options.interactiveScrollbars,t=typeof this.options.scrollbars!="string",n=[],r,i=this;this.indicators=[],this.options.scrollbars&&(this.options.scrollY&&(r={el:o("v",e,this.options.scrollbars),interactive:e,defaultScrollbars:!0,customStyle:t,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:!1},this.wrapper.appendChild(r.el),n.push(r)),this.options.scrollX&&(r={el:o("h",e,this.options.scrollbars),interactive:e,defaultScrollbars:!0,customStyle:t,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:!1},this.wrapper.appendChild(r.el),n.push(r))),this.options.indicators&&(n=n.concat(this.options.indicators));for(var s=n.length;s--;)this.indicators.push(new u(this,n[s]));this.options.fadeScrollbars&&(this.on("scrollEnd",function(){a(function(){this.fade()})}),this.on("scrollCancel",function(){a(function(){this.fade()})}),this.on("scrollStart",function(){a(function(){this.fade(1)})}),this.on("beforeScrollStart",function(){a(function(){this.fade(1,!0)})})),this.on("refresh",function(){a(function(){this.refresh()})}),this.on("destroy",function(){a(function(){this.destroy()}),delete this.indicators})},_initWheel:function(){i.addEvent(this.wrapper,"wheel",this),i.addEvent(this.wrapper,"mousewheel",this),i.addEvent(this.wrapper,"DOMMouseScroll",this),this.on("destroy",function(){i.removeEvent(this.wrapper,"wheel",this),i.removeEvent(this.wrapper,"mousewheel",this),i.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(e){if(!this.enabled)return;e.preventDefault(),e.stopPropagation();var t,r,i,s,o=this;this.wheelTimeout===undefined&&o._execEvent("scrollStart"),clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){o._execEvent("scrollEnd"),o.wheelTimeout=undefined},400);if("deltaX"in e)t=-e.deltaX,r=-e.deltaY;else if("wheelDeltaX"in e)t=e.wheelDeltaX/120*this.options.mouseWheelSpeed,r=e.wheelDeltaY/120*this.options.mouseWheelSpeed;else if("wheelDelta"in e)t=r=e.wheelDelta/120*this.options.mouseWheelSpeed;else{if(!("detail"in e))return;t=r=-e.detail/3*this.options.mouseWheelSpeed}t*=this.options.invertWheelDirection,r*=this.options.invertWheelDirection,this.hasVerticalScroll||(t=r,r=0);if(this.options.snap){i=this.currentPage.pageX,s=this.currentPage.pageY,t>0?i--:t<0&&i++,r>0?s--:r<0&&s++,this.goToPage(i,s);return}i=this.x+n.round(this.hasHorizontalScroll?t:0),s=this.y+n.round(this.hasVerticalScroll?r:0),i>0?i=0:i<this.maxScrollX&&(i=this.maxScrollX),s>0?s=0:s<this.maxScrollY&&(s=this.maxScrollY),this.scrollTo(i,s,0)},_initSnap:function(){this.currentPage={},typeof this.options.snap=="string"&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap)),this.on("refresh",function(){var e=0,t,r=0,i,s,o,u=0,a,f=this.options.snapStepX||this.wrapperWidth,l=this.options.snapStepY||this.wrapperHeight,c;this.pages=[];if(!this.wrapperWidth||!this.wrapperHeight||!this.scrollerWidth||!this.scrollerHeight)return;if(this.options.snap===!0){s=n.round(f/2),o=n.round(l/2);while(u>-this.scrollerWidth){this.pages[e]=[],t=0,a=0;while(a>-this.scrollerHeight)this.pages[e][t]={x:n.max(u,this.maxScrollX),y:n.max(a,this.maxScrollY),width:f,height:l,cx:u-s,cy:a-o},a-=l,t++;u-=f,e++}}else{c=this.options.snap,t=c.length,i=-1;for(;e<t;e++){if(e===0||c[e].offsetLeft<=c[e-1].offsetLeft)r=0,i++;this.pages[r]||(this.pages[r]=[]),u=n.max(-c[e].offsetLeft,this.maxScrollX),a=n.max(-c[e].offsetTop,this.maxScrollY),s=u-n.round(c[e].offsetWidth/2),o=a-n.round(c[e].offsetHeight/2),this.pages[r][i]={x:u,y:a,width:c[e].offsetWidth,height:c[e].offsetHeight,cx:s,cy:o},u>this.maxScrollX&&r++}}this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0),this.options.snapThreshold%1===0?(this.snapThresholdX=this.options.snapThreshold,this.snapThresholdY=this.options.snapThreshold):(this.snapThresholdX=n.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=n.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}),this.on("flick",function(){var e=this.options.snapSpeed||n.max(n.max(n.min(n.abs(this.x-this.startX),1e3),n.min(n.abs(this.y-this.startY),1e3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,e)})},_nearestSnap:function(e,t){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var r=0,i=this.pages.length,s=0;if(n.abs(e-this.absStartX)<this.snapThresholdX&&n.abs(t-this.absStartY)<this.snapThresholdY)return this.currentPage;e>0?e=0:e<this.maxScrollX&&(e=this.maxScrollX),t>0?t=0:t<this.maxScrollY&&(t=this.maxScrollY);for(;r<i;r++)if(e>=this.pages[r][0].cx){e=this.pages[r][0].x;break}i=this.pages[r].length;for(;s<i;s++)if(t>=this.pages[0][s].cy){t=this.pages[0][s].y;break}return r==this.currentPage.pageX&&(r+=this.directionX,r<0?r=0:r>=this.pages.length&&(r=this.pages.length-1),e=this.pages[r][0].x),s==this.currentPage.pageY&&(s+=this.directionY,s<0?s=0:s>=this.pages[0].length&&(s=this.pages[0].length-1),t=this.pages[0][s].y),{x:e,y:t,pageX:r,pageY:s}},goToPage:function(e,t,r,i){i=i||this.options.bounceEasing,e>=this.pages.length?e=this.pages.length-1:e<0&&(e=0),t>=this.pages[e].length?t=this.pages[e].length-1:t<0&&(t=0);var s=this.pages[e][t].x,o=this.pages[e][t].y;r=r===undefined?this.options.snapSpeed||n.max(n.max(n.min(n.abs(s-this.x),1e3),n.min(n.abs(o-this.y),1e3)),300):r,this.currentPage={x:s,y:o,pageX:e,pageY:t},this.scrollTo(s,o,r,i)},next:function(e,t){var n=this.currentPage.pageX,r=this.currentPage.pageY;n++,n>=this.pages.length&&this.hasVerticalScroll&&(n=0,r++),this.goToPage(n,r,e,t)},prev:function(e,t){var n=this.currentPage.pageX,r=this.currentPage.pageY;n--,n<0&&this.hasVerticalScroll&&(n=0,r--),this.goToPage(n,r,e,t)},_initKeys:function(t){var n={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40},r;if(typeof this.options.keyBindings=="object")for(r in this.options.keyBindings)typeof this.options.keyBindings[r]=="string"&&(this.options.keyBindings[r]=this.options.keyBindings[r].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(r in n)this.options.keyBindings[r]=this.options.keyBindings[r]||n[r];i.addEvent(e,"keydown",this),this.on("destroy",function(){i.removeEvent(e,"keydown",this)})},_key:function(e){if(!this.enabled)return;var t=this.options.snap,r=t?this.currentPage.pageX:this.x,s=t?this.currentPage.pageY:this.y,o=i.getTime(),u=this.keyTime||0,a=.25,f;this.options.useTransition&&this.isInTransition&&(f=this.getComputedPosition(),this._translate(n.round(f.x),n.round(f.y)),this.isInTransition=!1),this.keyAcceleration=o-u<200?n.min(this.keyAcceleration+a,50):0;switch(e.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?r+=t?1:this.wrapperWidth:s+=t?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?r-=t?1:this.wrapperWidth:s-=t?1:this.wrapperHeight;break;case this.options.keyBindings.end:r=t?this.pages.length-1:this.maxScrollX,s=t?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:r=0,s=0;break;case this.options.keyBindings.left:r+=t?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:s+=t?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:r-=t?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:s-=t?1:5+this.keyAcceleration>>0;break;default:return}if(t){this.goToPage(r,s);return}r>0?(r=0,this.keyAcceleration=0):r<this.maxScrollX&&(r=this.maxScrollX,this.keyAcceleration=0),s>0?(s=0,this.keyAcceleration=0):s<this.maxScrollY&&(s=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(r,s,0),this.keyTime=o},_animate:function(e,t,n,s){function c(){var h=i.getTime(),p,d,v;if(h>=l){o.isAnimating=!1,o._translate(e,t),o.resetPosition(o.options.bounceTime)||o._execEvent("scrollEnd");return}h=(h-f)/n,v=s(h),p=(e-u)*v+u,d=(t-a)*v+a,o._translate(p,d),o.isAnimating&&r(c)}var o=this,u=this.x,a=this.y,f=i.getTime(),l=f+n;this.isAnimating=!0,c()},handleEvent:function(e){switch(e.type){case"touchstart":case"MSPointerDown":case"mousedown":this._start(e);break;case"touchmove":case"MSPointerMove":case"mousemove":this._move(e);break;case"touchend":case"MSPointerUp":case"mouseup":case"touchcancel":case"MSPointerCancel":case"mousecancel":this._end(e);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(e);break;case"wheel":case"DOMMouseScroll":case"mousewheel":this._wheel(e);break;case"keydown":this._key(e);break;case"click":e._constructed||(e.preventDefault(),e.stopPropagation())}}},u.prototype={handleEvent:function(e){switch(e.type){case"touchstart":case"MSPointerDown":case"mousedown":this._start(e);break;case"touchmove":case"MSPointerMove":case"mousemove":this._move(e);break;case"touchend":case"MSPointerUp":case"mouseup":case"touchcancel":case"MSPointerCancel":case"mousecancel":this._end(e)}},destroy:function(){this.options.interactive&&(i.removeEvent(this.indicator,"touchstart",this),i.removeEvent(this.indicator,"MSPointerDown",this),i.removeEvent(this.indicator,"mousedown",this),i.removeEvent(e,"touchmove",this),i.removeEvent(e,"MSPointerMove",this),i.removeEvent(e,"mousemove",this),i.removeEvent(e,"touchend",this),i.removeEvent(e,"MSPointerUp",this),i.removeEvent(e,"mouseup",this)),this.options.defaultScrollbars&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(t){var n=t.touches?t.touches[0]:t;t.preventDefault(),t.stopPropagation(),this.transitionTime(),this.initiated=!0,this.moved=!1,this.lastPointX=n.pageX,this.lastPointY=n.pageY,this.startTime=i.getTime(),this.options.disableTouch||i.addEvent(e,"touchmove",this),this.options.disablePointer||i.addEvent(e,"MSPointerMove",this),this.options.disableMouse||i.addEvent(e,"mousemove",this),this.scroller._execEvent("beforeScrollStart")},_move:function(e){var t=e.touches?e.touches[0]:e,n,r,s,o,u=i.getTime();this.moved||this.scroller._execEvent("scrollStart"),this.moved=!0,n=t.pageX-this.lastPointX,this.lastPointX=t.pageX,r=t.pageY-this.lastPointY,this.lastPointY=t.pageY,s=this.x+n,o=this.y+r,this._pos(s,o),e.preventDefault(),e.stopPropagation()},_end:function(t){if(!this.initiated)return;this.initiated=!1,t.preventDefault(),t.stopPropagation(),i.removeEvent(e,"touchmove",this),i.removeEvent(e,"MSPointerMove",this),i.removeEvent(e,"mousemove",this);if(this.scroller.options.snap){var r=this.scroller._nearestSnap(this.scroller.x,this.scroller.y),s=this.options.snapSpeed||n.max(n.max(n.min(n.abs(this.scroller.x-r.x),1e3),n.min(n.abs(this.scroller.y-r.y),1e3)),300);if(this.scroller.x!=r.x||this.scroller.y!=r.y)this.scroller.directionX=0,this.scroller.directionY=0,this.scroller.currentPage=r,this.scroller.scrollTo(r.x,r.y,s,this.scroller.options.bounceEasing)}this.moved&&this.scroller._execEvent("scrollEnd")},transitionTime:function(e){e=e||0,this.indicatorStyle[i.style.transitionDuration]=e+"ms",!e&&i.isBadAndroid&&(this.indicatorStyle[i.style.transitionDuration]="0.001s")},transitionTimingFunction:function(e){this.indicatorStyle[i.style.transitionTimingFunction]=e},refresh:function(){this.transitionTime(),this.options.listenX&&!this.options.listenY?this.indicatorStyle.display=this.scroller.hasHorizontalScroll?"block":"none":this.options.listenY&&!this.options.listenX?this.indicatorStyle.display=this.scroller.hasVerticalScroll?"block":"none":this.indicatorStyle.display=this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?"block":"none",this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(i.addClass(this.wrapper,"iScrollBothScrollbars"),i.removeClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="8px":this.wrapper.style.bottom="8px")):(i.removeClass(this.wrapper,"iScrollBothScrollbars"),i.addClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="2px":this.wrapper.style.bottom="2px"));var e=this.wrapper.offsetHeight;this.options.listenX&&(this.wrapperWidth=this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=n.max(n.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),8),this.indicatorStyle.width=this.indicatorWidth+"px"):this.indicatorWidth=this.indicator.clientWidth,this.maxPosX=this.wrapperWidth-this.indicatorWidth,this.options.shrink=="clip"?(this.minBoundaryX=-this.indicatorWidth+8,this.maxBoundaryX=this.wrapperWidth-8):(this.minBoundaryX=0,this.maxBoundaryX=this.maxPosX),this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX),this.options.listenY&&(this.wrapperHeight=this.wrapper.clientHeight,this.options.resize?(this.indicatorHeight=n.max(n.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8),this.indicatorStyle.height=this.indicatorHeight+"px"):this.indicatorHeight=this.indicator.clientHeight,this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.options.shrink=="clip"?(this.minBoundaryY=-this.indicatorHeight+8,this.maxBoundaryY=this.wrapperHeight-8):(this.minBoundaryY=0,this.maxBoundaryY=this.maxPosY),this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY),this.updatePosition()},updatePosition:function(){var e=this.options.listenX&&n.round(this.sizeRatioX*this.scroller.x)||0,t=this.options.listenY&&n.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(e<this.minBoundaryX?(this.options.shrink=="scale"&&(this.width=n.max(this.indicatorWidth+e,8),this.indicatorStyle.width=this.width+"px"),e=this.minBoundaryX):e>this.maxBoundaryX?this.options.shrink=="scale"?(this.width=n.max(this.indicatorWidth-(e-this.maxPosX),8),this.indicatorStyle.width=this.width+"px",e=this.maxPosX+this.indicatorWidth-this.width):e=this.maxBoundaryX:this.options.shrink=="scale"&&this.width!=this.indicatorWidth&&(this.width=this.indicatorWidth,this.indicatorStyle.width=this.width+"px"),t<this.minBoundaryY?(this.options.shrink=="scale"&&(this.height=n.max(this.indicatorHeight+t*3,8),this.indicatorStyle.height=this.height+"px"),t=this.minBoundaryY):t>this.maxBoundaryY?this.options.shrink=="scale"?(this.height=n.max(this.indicatorHeight-(t-this.maxPosY)*3,8),this.indicatorStyle.height=this.height+"px",t=this.maxPosY+this.indicatorHeight-this.height):t=this.maxBoundaryY:this.options.shrink=="scale"&&this.height!=this.indicatorHeight&&(this.height=this.indicatorHeight,this.indicatorStyle.height=this.height+"px")),this.x=e,this.y=t,this.scroller.options.useTransform?this.indicatorStyle[i.style.transform]="translate("+e+"px,"+t+"px)"+this.scroller.translateZ:(this.indicatorStyle.left=e+"px",this.indicatorStyle.top=t+"px")},_pos:function(e,t){e<0?e=0:e>this.maxPosX&&(e=this.maxPosX),t<0?t=0:t>this.maxPosY&&(t=this.maxPosY),e=this.options.listenX?n.round(e/this.sizeRatioX):this.scroller.x,t=this.options.listenY?n.round(t/this.sizeRatioY):this.scroller.y,this.scroller.scrollTo(e,t)},fade:function(e,t){if(t&&!this.visible)return;clearTimeout(this.fadeTimeout),this.fadeTimeout=null;var n=e?250:500,r=e?0:300;e=e?"1":"0",this.wrapperStyle[i.style.transitionDuration]=n+"ms",this.fadeTimeout=setTimeout(function(e){this.wrapperStyle.opacity=e,this.visible=+e}.bind(this,e),r)}},s.utils=i,typeof module!="undefined"&&module.exports?module.exports=s:e.IScroll=s})(window,document,Math),define("Iscroll",function(e){return function(){var t,n;return t||e.IScroll}}(this)),!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("spin",t):e.Spinner=t()}(this,function(){function e(e,t){var n,r=document.createElement(e||"div");for(n in t)r[n]=t[n];return r}function t(e){for(var t=1,n=arguments.length;n>t;t++)e.appendChild(arguments[t]);return e}function n(e,t,n,r){var i=["opacity",t,~~(100*e),n,r].join("-"),s=.01+n/r*100,o=Math.max(1-(1-e)/t*(100-s),e),u=f.substring(0,f.indexOf("Animation")).toLowerCase(),a=u&&"-"+u+"-"||"";return c[i]||(h.insertRule("@"+a+"keyframes "+i+"{0%{opacity:"+o+"}"+s+"%{opacity:"+e+"}"+(s+.01)+"%{opacity:1}"+(s+t)%100+"%{opacity:"+e+"}100%{opacity:"+o+"}}",h.cssRules.length),c[i]=1),i}function r(e,t){var n,r,i=e.style;for(t=t.charAt(0).toUpperCase()+t.slice(1),r=0;r<l.length;r++)if(n=l[r]+t,void 0!==i[n])return n;return void 0!==i[t]?t:void 0}function i(e,t){for(var n in t)e.style[r(e,n)||n]=t[n];return e}function s(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)void 0===e[r]&&(e[r]=n[r])}return e}function o(e,t){return"string"==typeof e?e:e[t%e.length]}function u(e){this.opts=s(e||{},u.defaults,p)}function a(){function n(t,n){return e("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',n)}h.addRule(".spin-vml","behavior:url(#default#VML)"),u.prototype.lines=function(e,r){function s(){return i(n("group",{coordsize:l+" "+l,coordorigin:-f+" "+ -f}),{width:l,height:l})}function u(e,u,a){t(h,t(i(s(),{rotation:360/r.lines*e+"deg",left:~~u}),t(i(n("roundrect",{arcsize:r.corners}),{width:f,height:r.width,left:r.radius,top:-r.width>>1,filter:a}),n("fill",{color:o(r.color,e),opacity:r.opacity}),n("stroke",{opacity:0}))))}var a,f=r.length+r.width,l=2*f,c=2*-(r.width+r.length)+"px",h=i(s(),{position:"absolute",top:c,left:c});if(r.shadow)for(a=1;a<=r.lines;a++)u(a,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(a=1;a<=r.lines;a++)u(a);return t(e,h)},u.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}}var f,l=["webkit","Moz","ms","O"],c={},h=function(){var n=e("style",{type:"text/css"});return t(document.getElementsByTagName("head")[0],n),n.sheet||n.styleSheet}(),p={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};u.defaults={},s(u.prototype,{spin:function(t){this.stop();var n=this,r=n.opts,s=n.el=i(e(0,{className:r.className}),{position:r.position,width:0,zIndex:r.zIndex});r.radius+r.length+r.width;if(t&&(t.insertBefore(s,t.firstChild||null),i(s,{left:r.left,top:r.top})),s.setAttribute("role","progressbar"),n.lines(s,n.opts),!f){var o,u=0,a=(r.lines-1)*(1-r.direction)/2,l=r.fps,c=l/r.speed,h=(1-r.opacity)/(c*r.trail/100),p=c/r.lines;!function d(){u++;for(var e=0;e<r.lines;e++)o=Math.max(1-(u+(r.lines-e)*p)%c*h,r.opacity),n.opacity(s,e*r.direction+a,o,r);n.timeout=n.el&&setTimeout(d,~~(1e3/l))}()}return n},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(r,s){function u(t,n){return i(e(),{position:"absolute",width:s.length+s.width+"px",height:s.width+"px",background:t,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/s.lines*l+s.rotate)+"deg) translate("+s.radius+"px,0)",borderRadius:(s.corners*s.width>>1)+"px"})}for(var a,l=0,c=(s.lines-1)*(1-s.direction)/2;l<s.lines;l++)a=i(e(),{position:"absolute",top:1+~(s.width/2)+"px",transform:s.hwaccel?"translate3d(0,0,0)":"",opacity:s.opacity,animation:f&&n(s.opacity,s.trail,c+l*s.direction,s.lines)+" "+1/s.speed+"s linear infinite"}),s.shadow&&t(a,i(u("#000","0 0 4px #000"),{top:"2px"})),t(r,t(a,u(o(s.color,l),"0 0 1px rgba(0,0,0,.1)")));return r},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}});var d=i(e("group"),{behavior:"url(#default#VML)"});return!r(d,"transform")&&d.adj?a():f=r(d,"animation"),u}),define("models/parkingarea",["jquery","underscore","backbone"],function(e,t,n){return app.models.Parkingarea=n.Model.extend({defaults:{distance:"n.a"},initialize:function(){return this},parse:function(e){return e.name!==undefined&&e["name"].split("-").length==2&&(e.name=e.name.split("-")[1]),e}}),app.models.Parkingarea}),define("models/parkingareaCollection",["jquery","underscore","backbone","models/parkingarea"],function(e,t,n){return app.models.ParkingareaCollection=n.Collection.extend({initialize:function(){return this.listenTo(n,"collection:update",this.update,this),this},model:app.models.Parkingarea,url:"http://ipchannels.integreen-life.bz.it/parkingFrontEnd/rest/get-parking-stations",comparator:function(e){return e.get("name")},update:function(){n.trigger("freeslot:update"),this.fetch({error:function(){n.trigger("collection:failed"),console.log("errore",arguments)},success:function(){}})},update_all:function(){console.log("update_all di ParkingareaCollection"),n.trigger("collection:update_all"),this.fetch({reset:!0,cache:!1,error:function(){n.trigger("collection:failed"),console.log("errore",arguments)},success:function(){}})}}),app.models.ParkingareaCollection}),define("views/freeslot",["jquery","underscore","backbone","spin"],function(e,t,n,r){return app.views.Freeslot=n.View.extend({tagName:"span",initialize:function(){t.bindAll(this,"render","fetchSuccess","fetchError"),this.is_loading=!1,this.model.bind("change",function(e){this.render()},this),this.listenTo(n,"tick:30secs",this.reload,this),this.listenTo(n,"freeslot:update",this.reload,this),this.reload()},render:function(){if(this.is_loading===!0){this.$el.removeClass("badge"),this.$el.html("<span></span>");var t=e("span",this.$el).get(0);this.spinner=(new r(opts_spinner)).spin(t)}else this.model.attributes[0]===undefined?html="...":(html=this.model.attributes[0][0],this.model.attributes[0][0]>30?this.$el.addClass("badge badge-positive"):this.$el.addClass("badge badge-negative")),this.$el.html(html);return this},reload:function(){this.is_loading=!0,this.render(),setTimeout(e.proxy(function(){this.model.fetch({error:this.fetchError,success:this.fetchSuccess})},this),Math.floor(Math.random()*10+1)*250)},fetchSuccess:function(){n.trigger("freeslot:updated"),this.is_loading=!1,this.render()},fetchError:function(){console.log("fetchError"),n.trigger("freeslot:updated"),this.is_loading=!1,this.render()}}),app.views.Freeslot}),define("models/history",["jquery","underscore","backbone"],function(e,t,n){return app.models.History=n.Model.extend({initialize:function(){return this},urlRoot:"http://ipchannels.integreen-life.bz.it/parkingFrontEnd/rest/getFreeSlotsByTimeAndParkingArea",url:function(){return this.urlRoot+"?minutes=30&identifier="+this.id},last:function(){return this.attributes[0]}}),app.models.History}),define("views/history",["jquery","underscore","backbone","models/history"],function(e,t,n){return app.views.History=n.View.extend({initialize:function(){t.bindAll(this,"render"),this.model.bind("change",function(e){this.render()},this),this.model.fetch({error:function(){console.log(arguments)}})},render:function(){var t="#history_template_growup";return this.model.attributes[0][0]>this.model.attributes[1][0]&&(t="#history_template_growdown"),this.$el.html(e(t).html()),this}}),app.views.History}),function(e){e.color={},e.color.make=function(t,n,r,i){var s={};return s.r=t||0,s.g=n||0,s.b=r||0,s.a=i!=null?i:1,s.add=function(e,t){for(var n=0;n<e.length;++n)s[e.charAt(n)]+=t;return s.normalize()},s.scale=function(e,t){for(var n=0;n<e.length;++n)s[e.charAt(n)]*=t;return s.normalize()},s.toString=function(){return s.a>=1?"rgb("+[s.r,s.g,s.b].join(",")+")":"rgba("+[s.r,s.g,s.b,s.a].join(",")+")"},s.normalize=function(){function e(e,t,n){return t<e?e:t>n?n:t}return s.r=e(0,parseInt(s.r),255),s.g=e(0,parseInt(s.g),255),s.b=e(0,parseInt(s.b),255),s.a=e(0,s.a,1),s},s.clone=function(){return e.color.make(s.r,s.b,s.g,s.a)},s.normalize()},e.color.extract=function(t,n){var r;do{r=t.css(n).toLowerCase();if(r!=""&&r!="transparent")break;t=t.parent()}while(t.length&&!e.nodeName(t.get(0),"body"));return r=="rgba(0, 0, 0, 0)"&&(r="transparent"),e.color.parse(r)},e.color.parse=function(n){var r,i=e.color.make;if(r=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(n))return i(parseInt(r[1],10),parseInt(r[2],10),parseInt(r[3],10));if(r=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(n))return i(parseInt(r[1],10),parseInt(r[2],10),parseInt(r[3],10),parseFloat(r[4]));if(r=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(n))return i(parseFloat(r[1])*2.55,parseFloat(r[2])*2.55,parseFloat(r[3])*2.55);if(r=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(n))return i(parseFloat(r[1])*2.55,parseFloat(r[2])*2.55,parseFloat(r[3])*2.55,parseFloat(r[4]));if(r=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(n))return i(parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16));if(r=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(n))return i(parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16),parseInt(r[3]+r[3],16));var s=e.trim(n).toLowerCase();return s=="transparent"?i(255,255,255,0):(r=t[s]||[0,0,0],i(r[0],r[1],r[2]))};var t={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}}(jQuery),function(e){function n(t,n){var r=n.children("."+t)[0];if(r==null){r=document.createElement("canvas"),r.className=t,e(r).css({direction:"ltr",position:"absolute",left:0,top:0}).appendTo(n);if(!r.getContext){if(!window.G_vmlCanvasManager)throw new Error("Canvas is not available. If you're using IE with a fall-back such as Excanvas, then there's either a mistake in your conditional include, or the page has no DOCTYPE and is rendering in Quirks Mode.");r=window.G_vmlCanvasManager.initElement(r)}}this.element=r;var i=this.context=r.getContext("2d"),s=window.devicePixelRatio||1,o=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1;this.pixelRatio=s/o,this.resize(n.width(),n.height()),this.textContainer=null,this.text={},this._textCache={}}function r(t,r,s,o){function E(e,t){t=[w].concat(t);for(var n=0;n<e.length;++n)e[n].apply(this,t)}function S(){var t={Canvas:n};for(var r=0;r<o.length;++r){var i=o[r];i.init(w,t),i.options&&e.extend(!0,a,i.options)}}function x(n){e.extend(!0,a,n),n&&n.colors&&(a.colors=n.colors),a.xaxis.color==null&&(a.xaxis.color=e.color.parse(a.grid.color).scale("a",.22).toString()),a.yaxis.color==null&&(a.yaxis.color=e.color.parse(a.grid.color).scale("a",.22).toString()),a.xaxis.tickColor==null&&(a.xaxis.tickColor=a.grid.tickColor||a.xaxis.color),a.yaxis.tickColor==null&&(a.yaxis.tickColor=a.grid.tickColor||a.yaxis.color),a.grid.borderColor==null&&(a.grid.borderColor=a.grid.color),a.grid.tickColor==null&&(a.grid.tickColor=e.color.parse(a.grid.color).scale("a",.22).toString());var r,i,s,o=t.css("font-size"),u=o?+o.replace("px",""):13,f={style:t.css("font-style"),size:Math.round(.8*u),variant:t.css("font-variant"),weight:t.css("font-weight"),family:t.css("font-family")};s=a.xaxes.length||1;for(r=0;r<s;++r)i=a.xaxes[r],i&&!i.tickColor&&(i.tickColor=i.color),i=e.extend(!0,{},a.xaxis,i),a.xaxes[r]=i,i.font&&(i.font=e.extend({},f,i.font),i.font.color||(i.font.color=i.color),i.font.lineHeight||(i.font.lineHeight=Math.round(i.font.size*1.15)));s=a.yaxes.length||1;for(r=0;r<s;++r)i=a.yaxes[r],i&&!i.tickColor&&(i.tickColor=i.color),i=e.extend(!0,{},a.yaxis,i),a.yaxes[r]=i,i.font&&(i.font=e.extend({},f,i.font),i.font.color||(i.font.color=i.color),i.font.lineHeight||(i.font.lineHeight=Math.round(i.font.size*1.15)));a.xaxis.noTicks&&a.xaxis.ticks==null&&(a.xaxis.ticks=a.xaxis.noTicks),a.yaxis.noTicks&&a.yaxis.ticks==null&&(a.yaxis.ticks=a.yaxis.noTicks),a.x2axis&&(a.xaxes[1]=e.extend(!0,{},a.xaxis,a.x2axis),a.xaxes[1].position="top"),a.y2axis&&(a.yaxes[1]=e.extend(!0,{},a.yaxis,a.y2axis),a.yaxes[1].position="right"),a.grid.coloredAreas&&(a.grid.markings=a.grid.coloredAreas),a.grid.coloredAreasColor&&(a.grid.markingsColor=a.grid.coloredAreasColor),a.lines&&e.extend(!0,a.series.lines,a.lines),a.points&&e.extend(!0,a.series.points,a.points),a.bars&&e.extend(!0,a.series.bars,a.bars),a.shadowSize!=null&&(a.series.shadowSize=a.shadowSize),a.highlightColor!=null&&(a.series.highlightColor=a.highlightColor);for(r=0;r<a.xaxes.length;++r)O(d,r+1).options=a.xaxes[r];for(r=0;r<a.yaxes.length;++r)O(v,r+1).options=a.yaxes[r];for(var l in b)a.hooks[l]&&a.hooks[l].length&&(b[l]=b[l].concat(a.hooks[l]));E(b.processOptions,[a])}function T(e){u=N(e),M(),_()}function N(t){var n=[];for(var r=0;r<t.length;++r){var i=e.extend(!0,{},a.series);t[r].data!=null?(i.data=t[r].data,delete t[r].data,e.extend(!0,i,t[r]),t[r].data=i.data):i.data=t[r],n.push(i)}return n}function C(e,t){var n=e[t+"axis"];return typeof n=="object"&&(n=n.n),typeof n!="number"&&(n=1),n}function k(){return e.grep(d.concat(v),function(e){return e})}function L(e){var t={},n,r;for(n=0;n<d.length;++n)r=d[n],r&&r.used&&(t["x"+r.n]=r.c2p(e.left));for(n=0;n<v.length;++n)r=v[n],r&&r.used&&(t["y"+r.n]=r.c2p(e.top));return t.x1!==undefined&&(t.x=t.x1),t.y1!==undefined&&(t.y=t.y1),t}function A(e){var t={},n,r,i;for(n=0;n<d.length;++n){r=d[n];if(r&&r.used){i="x"+r.n,e[i]==null&&r.n==1&&(i="x");if(e[i]!=null){t.left=r.p2c(e[i]);break}}}for(n=0;n<v.length;++n){r=v[n];if(r&&r.used){i="y"+r.n,e[i]==null&&r.n==1&&(i="y");if(e[i]!=null){t.top=r.p2c(e[i]);break}}}return t}function O(t,n){return t[n-1]||(t[n-1]={n:n,direction:t==d?"x":"y",options:e.extend(!0,{},t==d?a.xaxis:a.yaxis)}),t[n-1]}function M(){var t=u.length,n=-1,r;for(r=0;r<u.length;++r){var i=u[r].color;i!=null&&(t--,typeof i=="number"&&i>n&&(n=i))}t<=n&&(t=n+1);var s,o=[],f=a.colors,l=f.length,c=0;for(r=0;r<t;r++)s=e.color.parse(f[r%l]||"#666"),r%l==0&&r&&(c>=0?c<.5?c=-c-.2:c=0:c=-c),o[r]=s.scale("rgb",1+c);var h=0,p;for(r=0;r<u.length;++r){p=u[r],p.color==null?(p.color=o[h].toString(),++h):typeof p.color=="number"&&(p.color=o[p.color].toString());if(p.lines.show==null){var m,g=!0;for(m in p)if(p[m]&&p[m].show){g=!1;break}g&&(p.lines.show=!0)}p.lines.zero==null&&(p.lines.zero=!!p.lines.fill),p.xaxis=O(d,C(p,"x")),p.yaxis=O(v,C(p,"y"))}}function _(){function x(e,t,n){t<e.datamin&&t!=-r&&(e.datamin=t),n>e.datamax&&n!=r&&(e.datamax=n)}var t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.MAX_VALUE,i,s,o,a,f,l,c,h,p,d,v,m,g,y,w,S;e.each(k(),function(e,r){r.datamin=t,r.datamax=n,r.used=!1});for(i=0;i<u.length;++i)l=u[i],l.datapoints={points:[]},E(b.processRawData,[l,l.data,l.datapoints]);for(i=0;i<u.length;++i){l=u[i],w=l.data,S=l.datapoints.format;if(!S){S=[],S.push({x:!0,number:!0,required:!0}),S.push({y:!0,number:!0,required:!0});if(l.bars.show||l.lines.show&&l.lines.fill){var T=!!(l.bars.show&&l.bars.zero||l.lines.show&&l.lines.zero);S.push({y:!0,number:!0,required:!1,defaultValue:0,autoscale:T}),l.bars.horizontal&&(delete S[S.length-1].y,S[S.length-1].x=!0)}l.datapoints.format=S}if(l.datapoints.pointsize!=null)continue;l.datapoints.pointsize=S.length,h=l.datapoints.pointsize,c=l.datapoints.points;var N=l.lines.show&&l.lines.steps;l.xaxis.used=l.yaxis.used=!0;for(s=o=0;s<w.length;++s,o+=h){y=w[s];var C=y==null;if(!C)for(a=0;a<h;++a)m=y[a],g=S[a],g&&(g.number&&m!=null&&(m=+m,isNaN(m)?m=null:m==Infinity?m=r:m==-Infinity&&(m=-r)),m==null&&(g.required&&(C=!0),g.defaultValue!=null&&(m=g.defaultValue))),c[o+a]=m;if(C)for(a=0;a<h;++a)m=c[o+a],m!=null&&(g=S[a],g.autoscale!==!1&&(g.x&&x(l.xaxis,m,m),g.y&&x(l.yaxis,m,m))),c[o+a]=null;else if(N&&o>0&&c[o-h]!=null&&c[o-h]!=c[o]&&c[o-h+1]!=c[o+1]){for(a=0;a<h;++a)c[o+h+a]=c[o+a];c[o+1]=c[o-h+1],o+=h}}}for(i=0;i<u.length;++i)l=u[i],E(b.processDatapoints,[l,l.datapoints]);for(i=0;i<u.length;++i){l=u[i],c=l.datapoints.points,h=l.datapoints.pointsize,S=l.datapoints.format;var L=t,A=t,O=n,M=n;for(s=0;s<c.length;s+=h){if(c[s]==null)continue;for(a=0;a<h;++a){m=c[s+a],g=S[a];if(!g||g.autoscale===!1||m==r||m==-r)continue;g.x&&(m<L&&(L=m),m>O&&(O=m)),g.y&&(m<A&&(A=m),m>M&&(M=m))}}if(l.bars.show){var _;switch(l.bars.align){case"left":_=0;break;case"right":_=-l.bars.barWidth;break;default:_=-l.bars.barWidth/2}l.bars.horizontal?(A+=_,M+=_+l.bars.barWidth):(L+=_,O+=_+l.bars.barWidth)}x(l.xaxis,L,O),x(l.yaxis,A,M)}e.each(k(),function(e,r){r.datamin==t&&(r.datamin=null),r.datamax==n&&(r.datamax=null)})}function D(){t.css("padding",0).children().filter(function(){return!e(this).hasClass("flot-overlay")&&!e(this).hasClass("flot-base")}).remove(),t.css("position")=="static"&&t.css("position","relative"),f=new n("flot-base",t),l=new n("flot-overlay",t),h=f.context,p=l.context,c=e(l.element).unbind();var r=t.data("plot");r&&(r.shutdown(),l.clear()),t.data("plot",w)}function P(){a.grid.hoverable&&(c.mousemove(at),c.bind("mouseleave",ft)),a.grid.clickable&&c.click(lt),E(b.bindEvents,[c])}function H(){ot&&clearTimeout(ot),c.unbind("mousemove",at),c.unbind("mouseleave",ft),c.unbind("click",lt),E(b.shutdown,[c])}function B(e){function t(e){return e}var n,r,i=e.options.transform||t,s=e.options.inverseTransform;e.direction=="x"?(n=e.scale=g/Math.abs(i(e.max)-i(e.min)),r=Math.min(i(e.max),i(e.min))):(n=e.scale=y/Math.abs(i(e.max)-i(e.min)),n=-n,r=Math.max(i(e.max),i(e.min))),i==t?e.p2c=function(e){return(e-r)*n}:e.p2c=function(e){return(i(e)-r)*n},s?e.c2p=function(e){return s(r+e/n)}:e.c2p=function(e){return r+e/n}}function j(e){var t=e.options,n=e.ticks||[],r=t.labelWidth||0,i=t.labelHeight||0,s=r||(e.direction=="x"?Math.floor(f.width/(n.length||1)):null),o=e.direction+"Axis "+e.direction+e.n+"Axis",u="flot-"+e.direction+"-axis flot-"+e.direction+e.n+"-axis "+o,a=t.font||"flot-tick-label tickLabel";for(var l=0;l<n.length;++l){var c=n[l];if(!c.label)continue;var h=f.getTextInfo(u,c.label,a,null,s);r=Math.max(r,h.width),i=Math.max(i,h.height)}e.labelWidth=t.labelWidth||r,e.labelHeight=t.labelHeight||i}function F(t){var n=t.labelWidth,r=t.labelHeight,i=t.options.position,s=t.direction==="x",o=t.options.tickLength,u=a.grid.axisMargin,l=a.grid.labelMargin,c=!0,h=!0,p=!0,g=!1;e.each(s?d:v,function(e,n){n&&n.reserveSpace&&(n===t?g=!0:n.options.position===i&&(g?h=!1:c=!1),g||(p=!1))}),h&&(u=0),o==null&&(o=p?"full":5),isNaN(+o)||(l+=+o),s?(r+=l,i=="bottom"?(m.bottom+=r+u,t.box={top:f.height-m.bottom,height:r}):(t.box={top:m.top+u,height:r},m.top+=r+u)):(n+=l,i=="left"?(t.box={left:m.left+u,width:n},m.left+=n+u):(m.right+=n+u,t.box={left:f.width-m.right,width:n})),t.position=i,t.tickLength=o,t.box.padding=l,t.innermost=c}function I(e){e.direction=="x"?(e.box.left=m.left-e.labelWidth/2,e.box.width=f.width-m.left-m.right+e.labelWidth):(e.box.top=m.top-e.labelHeight/2,e.box.height=f.height-m.bottom-m.top+e.labelHeight)}function q(){var t=a.grid.minBorderMargin,n,r;if(t==null){t=0;for(r=0;r<u.length;++r)t=Math.max(t,2*(u[r].points.radius+u[r].points.lineWidth/2))}var i={left:t,right:t,top:t,bottom:t};e.each(k(),function(e,t){if(t.reserveSpace&&t.ticks&&t.ticks.length){var n=t.ticks[t.ticks.length-1];t.direction==="x"?(i.left=Math.max(i.left,t.labelWidth/2),n.v<=t.max&&(i.right=Math.max(i.right,t.labelWidth/2))):(i.bottom=Math.max(i.bottom,t.labelHeight/2),n.v<=t.max&&(i.top=Math.max(i.top,t.labelHeight/2)))}}),m.left=Math.ceil(Math.max(i.left,m.left)),m.right=Math.ceil(Math.max(i.right,m.right)),m.top=Math.ceil(Math.max(i.top,m.top)),m.bottom=Math.ceil(Math.max(i.bottom,m.bottom))}function R(){var t,n=k(),r=a.grid.show;for(var i in m){var s=a.grid.margin||0;m[i]=typeof s=="number"?s:s[i]||0}E(b.processOffset,[m]);for(var i in m)typeof a.grid.borderWidth=="object"?m[i]+=r?a.grid.borderWidth[i]:0:m[i]+=r?a.grid.borderWidth:0;e.each(n,function(e,t){t.show=t.options.show,t.show==null&&(t.show=t.used),t.reserveSpace=t.show||t.options.reserveSpace,U(t)});if(r){var o=e.grep(n,function(e){return e.reserveSpace});e.each(o,function(e,t){z(t),W(t),X(t,t.ticks),j(t)});for(t=o.length-1;t>=0;--t)F(o[t]);q(),e.each(o,function(e,t){I(t)})}g=f.width-m.left-m.right,y=f.height-m.bottom-m.top,e.each(n,function(e,t){B(t)}),r&&G(),it()}function U(e){var t=e.options,n=+(t.min!=null?t.min:e.datamin),r=+(t.max!=null?t.max:e.datamax),i=r-n;if(i==0){var s=r==0?1:.01;t.min==null&&(n-=s);if(t.max==null||t.min!=null)r+=s}else{var o=t.autoscaleMargin;o!=null&&(t.min==null&&(n-=i*o,n<0&&e.datamin!=null&&e.datamin>=0&&(n=0)),t.max==null&&(r+=i*o,r>0&&e.datamax!=null&&e.datamax<=0&&(r=0)))}e.min=n,e.max=r}function z(t){var n=t.options,r;typeof n.ticks=="number"&&n.ticks>0?r=n.ticks:r=.3*Math.sqrt(t.direction=="x"?f.width:f.height);var s=(t.max-t.min)/r,o=-Math.floor(Math.log(s)/Math.LN10),u=n.tickDecimals;u!=null&&o>u&&(o=u);var a=Math.pow(10,-o),l=s/a,c;l<1.5?c=1:l<3?(c=2,l>2.25&&(u==null||o+1<=u)&&(c=2.5,++o)):l<7.5?c=5:c=10,c*=a,n.minTickSize!=null&&c<n.minTickSize&&(c=n.minTickSize),t.delta=s,t.tickDecimals=Math.max(0,u!=null?u:o),t.tickSize=n.tickSize||c;if(n.mode=="time"&&!t.tickGenerator)throw new Error("Time mode requires the flot.time plugin.");t.tickGenerator||(t.tickGenerator=function(e){var t=[],n=i(e.min,e.tickSize),r=0,s=Number.NaN,o;do o=s,s=n+r*e.tickSize,t.push(s),++r;while(s<e.max&&s!=o);return t},t.tickFormatter=function(e,t){var n=t.tickDecimals?Math.pow(10,t.tickDecimals):1,r=""+Math.round(e*n)/n;if(t.tickDecimals!=null){var i=r.indexOf("."),s=i==-1?0:r.length-i-1;if(s<t.tickDecimals)return(s?r:r+".")+(""+n).substr(1,t.tickDecimals-s)}return r}),e.isFunction(n.tickFormatter)&&(t.tickFormatter=function(e,t){return""+n.tickFormatter(e,t)});if(n.alignTicksWithAxis!=null){var h=(t.direction=="x"?d:v)[n.alignTicksWithAxis-1];if(h&&h.used&&h!=t){var p=t.tickGenerator(t);p.length>0&&(n.min==null&&(t.min=Math.min(t.min,p[0])),n.max==null&&p.length>1&&(t.max=Math.max(t.max,p[p.length-1]))),t.tickGenerator=function(e){var t=[],n,r;for(r=0;r<h.ticks.length;++r)n=(h.ticks[r].v-h.min)/(h.max-h.min),n=e.min+n*(e.max-e.min),t.push(n);return t};if(!t.mode&&n.tickDecimals==null){var m=Math.max(0,-Math.floor(Math.log(t.delta)/Math.LN10)+1),g=t.tickGenerator(t);g.length>1&&/\..*0$/.test((g[1]-g[0]).toFixed(m))||(t.tickDecimals=m)}}}}function W(t){var n=t.options.ticks,r=[];n==null||typeof n=="number"&&n>0?r=t.tickGenerator(t):n&&(e.isFunction(n)?r=n(t):r=n);var i,s;t.ticks=[];for(i=0;i<r.length;++i){var o=null,u=r[i];typeof u=="object"?(s=+u[0],u.length>1&&(o=u[1])):s=+u,o==null&&(o=t.tickFormatter(s,t)),isNaN(s)||t.ticks.push({v:s,label:o})}}function X(e,t){e.options.autoscaleMargin&&t.length>0&&(e.options.min==null&&(e.min=Math.min(e.min,t[0].v)),e.options.max==null&&t.length>1&&(e.max=Math.max(e.max,t[t.length-1].v)))}function V(){f.clear(),E(b.drawBackground,[h]);var e=a.grid;e.show&&e.backgroundColor&&K(),e.show&&!e.aboveData&&Q();for(var t=0;t<u.length;++t)E(b.drawSeries,[h,u[t]]),Y(u[t]);E(b.draw,[h]),e.show&&e.aboveData&&Q(),f.render(),ht()}function J(e,t){var n,r,i,s,o=k();for(var u=0;u<o.length;++u){n=o[u];if(n.direction==t){s=t+n.n+"axis",!e[s]&&n.n==1&&(s=t+"axis");if(e[s]){r=e[s].from,i=e[s].to;break}}}e[s]||(n=t=="x"?d[0]:v[0],r=e[t+"1"],i=e[t+"2"]);if(r!=null&&i!=null&&r>i){var a=r;r=i,i=a}return{from:r,to:i,axis:n}}function K(){h.save(),h.translate(m.left,m.top),h.fillStyle=bt(a.grid.backgroundColor,y,0,"rgba(255, 255, 255, 0)"),h.fillRect(0,0,g,y),h.restore()}function Q(){var t,n,r,i;h.save(),h.translate(m.left,m.top);var s=a.grid.markings;if(s){e.isFunction(s)&&(n=w.getAxes(),n.xmin=n.xaxis.min,n.xmax=n.xaxis.max,n.ymin=n.yaxis.min,n.ymax=n.yaxis.max,s=s(n));for(t=0;t<s.length;++t){var o=s[t],u=J(o,"x"),f=J(o,"y");u.from==null&&(u.from=u.axis.min),u.to==null&&(u.to=u.axis.max),f.from==null&&(f.from=f.axis.min),f.to==null&&(f.to=f.axis.max);if(u.to<u.axis.min||u.from>u.axis.max||f.to<f.axis.min||f.from>f.axis.max)continue;u.from=Math.max(u.from,u.axis.min),u.to=Math.min(u.to,u.axis.max),f.from=Math.max(f.from,f.axis.min),f.to=Math.min(f.to,f.axis.max);if(u.from==u.to&&f.from==f.to)continue;u.from=u.axis.p2c(u.from),u.to=u.axis.p2c(u.to),f.from=f.axis.p2c(f.from),f.to=f.axis.p2c(f.to),u.from==u.to||f.from==f.to?(h.beginPath(),h.strokeStyle=o.color||a.grid.markingsColor,h.lineWidth=o.lineWidth||a.grid.markingsLineWidth,h.moveTo(u.from,f.from),h.lineTo(u.to,f.to),h.stroke()):(h.fillStyle=o.color||a.grid.markingsColor,h.fillRect(u.from,f.to,u.to-u.from,f.from-f.to))}}n=k(),r=a.grid.borderWidth;for(var l=0;l<n.length;++l){var c=n[l],p=c.box,d=c.tickLength,v,b,E,S;if(!c.show||c.ticks.length==0)continue;h.lineWidth=1,c.direction=="x"?(v=0,d=="full"?b=c.position=="top"?0:y:b=p.top-m.top+(c.position=="top"?p.height:0)):(b=0,d=="full"?v=c.position=="left"?0:g:v=p.left-m.left+(c.position=="left"?p.width:0)),c.innermost||(h.strokeStyle=c.options.color,h.beginPath(),E=S=0,c.direction=="x"?E=g+1:S=y+1,h.lineWidth==1&&(c.direction=="x"?b=Math.floor(b)+.5:v=Math.floor(v)+.5),h.moveTo(v,b),h.lineTo(v+E,b+S),h.stroke()),h.strokeStyle=c.options.tickColor,h.beginPath();for(t=0;t<c.ticks.length;++t){var x=c.ticks[t].v;E=S=0;if(isNaN(x)||x<c.min||x>c.max||d=="full"&&(typeof r=="object"&&r[c.position]>0||r>0)&&(x==c.min||x==c.max))continue;c.direction=="x"?(v=c.p2c(x),S=d=="full"?-y:d,c.position=="top"&&(S=-S)):(b=c.p2c(x),E=d=="full"?-g:d,c.position=="left"&&(E=-E)),h.lineWidth==1&&(c.direction=="x"?v=Math.floor(v)+.5:b=Math.floor(b)+.5),h.moveTo(v,b),h.lineTo(v+E,b+S)}h.stroke()}r&&(i=a.grid.borderColor,typeof r=="object"||typeof i=="object"?(typeof r!="object"&&(r={top:r,right:r,bottom:r,left:r}),typeof i!="object"&&(i={top:i,right:i,bottom:i,left:i}),r.top>0&&(h.strokeStyle=i.top,h.lineWidth=r.top,h.beginPath(),h.moveTo(0-r.left,0-r.top/2),h.lineTo(g,0-r.top/2),h.stroke()),r.right>0&&(h.strokeStyle=i.right,h.lineWidth=r.right,h.beginPath(),h.moveTo(g+r.right/2,0-r.top),h.lineTo(g+r.right/2,y),h.stroke()),r.bottom>0&&(h.strokeStyle=i.bottom,h.lineWidth=r.bottom,h.beginPath(),h.moveTo(g+r.right,y+r.bottom/2),h.lineTo(0,y+r.bottom/2),h.stroke()),r.left>0&&(h.strokeStyle=i.left,h.lineWidth=r.left,h.beginPath(),h.moveTo(0-r.left/2,y+r.bottom),h.lineTo(0-r.left/2,0),h.stroke())):(h.lineWidth=r,h.strokeStyle=a.grid.borderColor,h.strokeRect(-r/2,-r/2,g+r,y+r))),h.restore()}function G(){e.each(k(),function(e,t){var n=t.box,r=t.direction+"Axis "+t.direction+t.n+"Axis",i="flot-"+t.direction+"-axis flot-"+t.direction+t.n+"-axis "+r,s=t.options.font||"flot-tick-label tickLabel",o,u,a,l,c;f.removeText(i);if(!t.show||t.ticks.length==0)return;for(var h=0;h<t.ticks.length;++h){o=t.ticks[h];if(!o.label||o.v<t.min||o.v>t.max)continue;t.direction=="x"?(l="center",u=m.left+t.p2c(o.v),t.position=="bottom"?a=n.top+n.padding:(a=n.top+n.height-n.padding,c="bottom")):(c="middle",a=m.top+t.p2c(o.v),t.position=="left"?(u=n.left+n.width-n.padding,l="right"):u=n.left+n.padding),f.addText(i,u,a,o.label,s,null,null,l,c)}})}function Y(e){e.lines.show&&Z(e),e.bars.show&&nt(e),e.points.show&&et(e)}function Z(e){function t(e,t,n,r,i){var s=e.points,o=e.pointsize,u=null,a=null;h.beginPath();for(var f=o;f<s.length;f+=o){var l=s[f-o],c=s[f-o+1],p=s[f],d=s[f+1];if(l==null||p==null)continue;if(c<=d&&c<i.min){if(d<i.min)continue;l=(i.min-c)/(d-c)*(p-l)+l,c=i.min}else if(d<=c&&d<i.min){if(c<i.min)continue;p=(i.min-c)/(d-c)*(p-l)+l,d=i.min}if(c>=d&&c>i.max){if(d>i.max)continue;l=(i.max-c)/(d-c)*(p-l)+l,c=i.max}else if(d>=c&&d>i.max){if(c>i.max)continue;p=(i.max-c)/(d-c)*(p-l)+l,d=i.max}if(l<=p&&l<r.min){if(p<r.min)continue;c=(r.min-l)/(p-l)*(d-c)+c,l=r.min}else if(p<=l&&p<r.min){if(l<r.min)continue;d=(r.min-l)/(p-l)*(d-c)+c,p=r.min}if(l>=p&&l>r.max){if(p>r.max)continue;c=(r.max-l)/(p-l)*(d-c)+c,l=r.max}else if(p>=l&&p>r.max){if(l>r.max)continue;d=(r.max-l)/(p-l)*(d-c)+c,p=r.max}(l!=u||c!=a)&&h.moveTo(r.p2c(l)+t,i.p2c(c)+n),u=p,a=d,h.lineTo(r.p2c(p)+t,i.p2c(d)+n)}h.stroke()}function n(e,t,n){var r=e.points,i=e.pointsize,s=Math.min(Math.max(0,n.min),n.max),o=0,u,a=!1,f=1,l=0,c=0;for(;;){if(i>0&&o>r.length+i)break;o+=i;var p=r[o-i],d=r[o-i+f],v=r[o],m=r[o+f];if(a){if(i>0&&p!=null&&v==null){c=o,i=-i,f=2;continue}if(i<0&&o==l+i){h.fill(),a=!1,i=-i,f=1,o=l=c+i;continue}}if(p==null||v==null)continue;if(p<=v&&p<t.min){if(v<t.min)continue;d=(t.min-p)/(v-p)*(m-d)+d,p=t.min}else if(v<=p&&v<t.min){if(p<t.min)continue;m=(t.min-p)/(v-p)*(m-d)+d,v=t.min}if(p>=v&&p>t.max){if(v>t.max)continue;d=(t.max-p)/(v-p)*(m-d)+d,p=t.max}else if(v>=p&&v>t.max){if(p>t.max)continue;m=(t.max-p)/(v-p)*(m-d)+d,v=t.max}a||(h.beginPath(),h.moveTo(t.p2c(p),n.p2c(s)),a=!0);if(d>=n.max&&m>=n.max){h.lineTo(t.p2c(p),n.p2c(n.max)),h.lineTo(t.p2c(v),n.p2c(n.max));continue}if(d<=n.min&&m<=n.min){h.lineTo(t.p2c(p),n.p2c(n.min)),h.lineTo(t.p2c(v),n.p2c(n.min));continue}var g=p,y=v;d<=m&&d<n.min&&m>=n.min?(p=(n.min-d)/(m-d)*(v-p)+p,d=n.min):m<=d&&m<n.min&&d>=n.min&&(v=(n.min-d)/(m-d)*(v-p)+p,m=n.min),d>=m&&d>n.max&&m<=n.max?(p=(n.max-d)/(m-d)*(v-p)+p,d=n.max):m>=d&&m>n.max&&d<=n.max&&(v=(n.max-d)/(m-d)*(v-p)+p,m=n.max),p!=g&&h.lineTo(t.p2c(g),n.p2c(d)),h.lineTo(t.p2c(p),n.p2c(d)),h.lineTo(t.p2c(v),n.p2c(m)),v!=y&&(h.lineTo(t.p2c(v),n.p2c(m)),h.lineTo(t.p2c(y),n.p2c(m)))}}h.save(),h.translate(m.left,m.top),h.lineJoin="round";var r=e.lines.lineWidth,i=e.shadowSize;if(r>0&&i>0){h.lineWidth=i,h.strokeStyle="rgba(0,0,0,0.1)";var s=Math.PI/18;t(e.datapoints,Math.sin(s)*(r/2+i/2),Math.cos(s)*(r/2+i/2),e.xaxis,e.yaxis),h.lineWidth=i/2,t(e.datapoints,Math.sin(s)*(r/2+i/4),Math.cos(s)*(r/2+i/4),e.xaxis,e.yaxis)}h.lineWidth=r,h.strokeStyle=e.color;var o=rt(e.lines,e.color,0,y);o&&(h.fillStyle=o,n(e.datapoints,e.xaxis,e.yaxis)),r>0&&t(e.datapoints,0,0,e.xaxis,e.yaxis),h.restore()}function et(e){function t(e,t,n,r,i,s,o,u){var a=e.points,f=e.pointsize;for(var l=0;l<a.length;l+=f){var c=a[l],p=a[l+1];if(c==null||c<s.min||c>s.max||p<o.min||p>o.max)continue;h.beginPath(),c=s.p2c(c),p=o.p2c(p)+r,u=="circle"?h.arc(c,p,t,0,i?Math.PI:Math.PI*2,!1):u(h,c,p,t,i),h.closePath(),n&&(h.fillStyle=n,h.fill()),h.stroke()}}h.save(),h.translate(m.left,m.top);var n=e.points.lineWidth,r=e.shadowSize,i=e.points.radius,s=e.points.symbol;n==0&&(n=1e-4);if(n>0&&r>0){var o=r/2;h.lineWidth=o,h.strokeStyle="rgba(0,0,0,0.1)",t(e.datapoints,i,null,o+o/2,!0,e.xaxis,e.yaxis,s),h.strokeStyle="rgba(0,0,0,0.2)",t(e.datapoints,i,null,o/2,!0,e.xaxis,e.yaxis,s)}h.lineWidth=n,h.strokeStyle=e.color,t(e.datapoints,i,rt(e.points,e.color),0,!1,e.xaxis,e.yaxis,s),h.restore()}function tt(e,t,n,r,i,s,o,u,a,f,l){var c,h,p,d,v,m,g,y,b;f?(y=m=g=!0,v=!1,c=n,h=e,d=t+r,p=t+i,h<c&&(b=h,h=c,c=b,v=!0,m=!1)):(v=m=g=!0,y=!1,c=e+r,h=e+i,p=n,d=t,d<p&&(b=d,d=p,p=b,y=!0,g=!1));if(h<o.min||c>o.max||d<u.min||p>u.max)return;c<o.min&&(c=o.min,v=!1),h>o.max&&(h=o.max,m=!1),p<u.min&&(p=u.min,y=!1),d>u.max&&(d=u.max,g=!1),c=o.p2c(c),p=u.p2c(p),h=o.p2c(h),d=u.p2c(d),s&&(a.fillStyle=s(p,d),a.fillRect(c,d,h-c,p-d)),l>0&&(v||m||g||y)&&(a.beginPath(),a.moveTo(c,p),v?a.lineTo(c,d):a.moveTo(c,d),g?a.lineTo(h,d):a.moveTo(h,d),m?a.lineTo(h,p):a.moveTo(h,p),y?a.lineTo(c,p):a.moveTo(c,p),a.stroke())}function nt(e){function t(t,n,r,i,s,o){var u=t.points,a=t.pointsize;for(var f=0;f<u.length;f+=a){if(u[f]==null)continue;tt(u[f],u[f+1],u[f+2],n,r,i,s,o,h,e.bars.horizontal,e.bars.lineWidth)}}h.save(),h.translate(m.left,m.top),h.lineWidth=e.bars.lineWidth,h.strokeStyle=e.color;var n;switch(e.bars.align){case"left":n=0;break;case"right":n=-e.bars.barWidth;break;default:n=-e.bars.barWidth/2}var r=e.bars.fill?function(t,n){return rt(e.bars,e.color,t,n)}:null;t(e.datapoints,n,n+e.bars.barWidth,r,e.xaxis,e.yaxis),h.restore()}function rt(t,n,r,i){var s=t.fill;if(!s)return null;if(t.fillColor)return bt(t.fillColor,r,i,n);var o=e.color.parse(n);return o.a=typeof s=="number"?s:.4,o.normalize(),o.toString()}function it(){a.legend.container!=null?e(a.legend.container).html(""):t.find(".legend").remove();if(!a.legend.show)return;var n=[],r=[],i=!1,s=a.legend.labelFormatter,o,f;for(var l=0;l<u.length;++l)o=u[l],o.label&&(f=s?s(o.label,o):o.label,f&&r.push({label:f,color:o.color}));if(a.legend.sorted)if(e.isFunction(a.legend.sorted))r.sort(a.legend.sorted);else if(a.legend.sorted=="reverse")r.reverse();else{var c=a.legend.sorted!="descending";r.sort(function(e,t){return e.label==t.label?0:e.label<t.label!=c?1:-1})}for(var l=0;l<r.length;++l){var h=r[l];l%a.legend.noColumns==0&&(i&&n.push("</tr>"),n.push("<tr>"),i=!0),n.push('<td class="legendColorBox"><div style="border:1px solid '+a.legend.labelBoxBorderColor+';padding:1px"><div style="width:4px;height:0;border:5px solid '+h.color+';overflow:hidden"></div></div></td>'+'<td class="legendLabel">'+h.label+"</td>")}i&&n.push("</tr>");if(n.length==0)return;var p='<table style="font-size:smaller;color:'+a.grid.color+'">'+n.join("")+"</table>";if(a.legend.container!=null)e(a.legend.container).html(p);else{var d="",v=a.legend.position,g=a.legend.margin;g[0]==null&&(g=[g,g]),v.charAt(0)=="n"?d+="top:"+(g[1]+m.top)+"px;":v.charAt(0)=="s"&&(d+="bottom:"+(g[1]+m.bottom)+"px;"),v.charAt(1)=="e"?d+="right:"+(g[0]+m.right)+"px;":v.charAt(1)=="w"&&(d+="left:"+(g[0]+m.left)+"px;");var y=e('<div class="legend">'+p.replace('style="','style="position:absolute;'+d+";")+"</div>").appendTo(t);if(a.legend.backgroundOpacity!=0){var b=a.legend.backgroundColor;b==null&&(b=a.grid.backgroundColor,b&&typeof b=="string"?b=e.color.parse(b):b=e.color.extract(y,"background-color"),b.a=1,b=b.toString());var w=y.children();e('<div style="position:absolute;width:'+w.width()+"px;height:"+w.height()+"px;"+d+"background-color:"+b+';"> </div>').prependTo(y).css("opacity",a.legend.backgroundOpacity)}}}function ut(e,t,n){var r=a.grid.mouseActiveRadius,i=r*r+1,s=null,o=!1,f,l,c;for(f=u.length-1;f>=0;--f){if(!n(u[f]))continue;var h=u[f],p=h.xaxis,d=h.yaxis,v=h.datapoints.points,m=p.c2p(e),g=d.c2p(t),y=r/p.scale,b=r/d.scale;c=h.datapoints.pointsize,p.options.inverseTransform&&(y=Number.MAX_VALUE),d.options.inverseTransform&&(b=Number.MAX_VALUE);if(h.lines.show||h.points.show)for(l=0;l<v.length;l+=c){var w=v[l],E=v[l+1];if(w==null)continue;if(w-m>y||w-m<-y||E-g>b||E-g<-b)continue;var S=Math.abs(p.p2c(w)-e),x=Math.abs(d.p2c(E)-t),T=S*S+x*x;T<i&&(i=T,s=[f,l/c])}if(h.bars.show&&!s){var N,C;switch(h.bars.align){case"left":N=0;break;case"right":N=-h.bars.barWidth;break;default:N=-h.bars.barWidth/2}C=N+h.bars.barWidth;for(l=0;l<v.length;l+=c){var w=v[l],E=v[l+1],k=v[l+2];if(w==null)continue;if(u[f].bars.horizontal?m<=Math.max(k,w)&&m>=Math.min(k,w)&&g>=E+N&&g<=E+C:m>=w+N&&m<=w+C&&g>=Math.min(k,E)&&g<=Math.max(k,E))s=[f,l/c]}}}return s?(f=s[0],l=s[1],c=u[f].datapoints.pointsize,{datapoint:u[f].datapoints.points.slice(l*c,(l+1)*c),dataIndex:l,series:u[f],seriesIndex:f}):null}function at(e){a.grid.hoverable&&ct("plothover",e,function(e){return e["hoverable"]!=0})}function ft(e){a.grid.hoverable&&ct("plothover",e,function(e){return!1})}function lt(e){ct("plotclick",e,function(e){return e["clickable"]!=0})}function ct(e,n,r){var i=c.offset(),s=n.pageX-i.left-m.left,o=n.pageY-i.top-m.top,u=L({left:s,top:o});u.pageX=n.pageX,u.pageY=n.pageY;var f=ut(s,o,r);f&&(f.pageX=parseInt(f.series.xaxis.p2c(f.datapoint[0])+i.left+m.left,10),f.pageY=parseInt(f.series.yaxis.p2c(f.datapoint[1])+i.top+m.top,10));if(a.grid.autoHighlight){for(var l=0;l<st.length;++l){var h=st[l];h.auto==e&&(!f||h.series!=f.series||h.point[0]!=f.datapoint[0]||h.point[1]!=f.datapoint[1])&&vt(h.series,h.point)}f&&dt(f.series,f.datapoint,e)}t.trigger(e,[u,f])}function ht(){var e=a.interaction.redrawOverlayInterval;if(e==-1){pt();return}ot||(ot=setTimeout(pt,e))}function pt(){ot=null,p.save(),l.clear(),p.translate(m.left,m.top);var e,t;for(e=0;e<st.length;++e)t=st[e],t.series.bars.show?yt(t.series,t.point):gt(t.series,t.point);p.restore(),E(b.drawOverlay,[p])}function dt(e,t,n){typeof e=="number"&&(e=u[e]);if(typeof t=="number"){var r=e.datapoints.pointsize;t=e.datapoints.points.slice(r*t,r*(t+1))}var i=mt(e,t);i==-1?(st.push({series:e,point:t,auto:n}),ht()):n||(st[i].auto=!1)}function vt(e,t){if(e==null&&t==null){st=[],ht();return}typeof e=="number"&&(e=u[e]);if(typeof t=="number"){var n=e.datapoints.pointsize;t=e.datapoints.points.slice(n*t,n*(t+1))}var r=mt(e,t);r!=-1&&(st.splice(r,1),ht())}function mt(e,t){for(var n=0;n<st.length;++n){var r=st[n];if(r.series==e&&r.point[0]==t[0]&&r.point[1]==t[1])return n}return-1}function gt(t,n){var r=n[0],i=n[1],s=t.xaxis,o=t.yaxis,u=typeof t.highlightColor=="string"?t.highlightColor:e.color.parse(t.color).scale("a",.5).toString();if(r<s.min||r>s.max||i<o.min||i>o.max)return;var a=t.points.radius+t.points.lineWidth/2;p.lineWidth=a,p.strokeStyle=u;var f=1.5*a;r=s.p2c(r),i=o.p2c(i),p.beginPath(),t.points.symbol=="circle"?p.arc(r,i,f,0,2*Math.PI,!1):t.points.symbol(p,r,i,f,!1),p.closePath(),p.stroke()}function yt(t,n){var r=typeof t.highlightColor=="string"?t.highlightColor:e.color.parse(t.color).scale("a",.5).toString(),i=r,s;switch(t.bars.align){case"left":s=0;break;case"right":s=-t.bars.barWidth;break;default:s=-t.bars.barWidth/2}p.lineWidth=t.bars.lineWidth,p.strokeStyle=r,tt(n[0],n[1],n[2]||0,s,s+t.bars.barWidth,function(){return i},t.xaxis,t.yaxis,p,t.bars.horizontal,t.bars.lineWidth)}function bt(t,n,r,i){if(typeof t=="string")return t;var s=h.createLinearGradient(0,r,0,n);for(var o=0,u=t.colors.length;o<u;++o){var a=t.colors[o];if(typeof a!="string"){var f=e.color.parse(i);a.brightness!=null&&(f=f.scale("rgb",a.brightness)),a.opacity!=null&&(f.a*=a.opacity),a=f.toString()}s.addColorStop(o/(u-1),a)}return s}var u=[],a={colors:["#edc240","#afd8f8","#cb4b4b","#4da74d","#9440ed"],legend:{show:!0,noColumns:1,labelFormatter:null,labelBoxBorderColor:"#ccc",container:null,position:"ne",margin:5,backgroundColor:null,backgroundOpacity:.85,sorted:null},xaxis:{show:null,position:"bottom",mode:null,font:null,color:null,tickColor:null,transform:null,inverseTransform:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,reserveSpace:null,tickLength:null,alignTicksWithAxis:null,tickDecimals:null,tickSize:null,minTickSize:null},yaxis:{autoscaleMargin:.02,position:"left"},xaxes:[],yaxes:[],series:{points:{show:!1,radius:3,lineWidth:2,fill:!0,fillColor:"#ffffff",symbol:"circle"},lines:{lineWidth:2,fill:!1,fillColor:null,steps:!1},bars:{show:!1,lineWidth:2,barWidth:1,fill:!0,fillColor:null,align:"left",horizontal:!1,zero:!0},shadowSize:3,highlightColor:null},grid:{show:!0,aboveData:!1,color:"#545454",backgroundColor:null,borderColor:null,tickColor:null,margin:0,labelMargin:5,axisMargin:8,borderWidth:2,minBorderMargin:null,markings:null,markingsColor:"#f4f4f4",markingsLineWidth:2,clickable:!1,hoverable:!1,autoHighlight:!0,mouseActiveRadius:10},interaction:{redrawOverlayInterval:1e3/60},hooks:{}},f=null,l=null,c=null,h=null,p=null,d=[],v=[],m={left:0,right:0,top:0,bottom:0},g=0,y=0,b={processOptions:[],processRawData:[],processDatapoints:[],processOffset:[],drawBackground:[],drawSeries:[],draw:[],bindEvents:[],drawOverlay:[],shutdown:[]},w=this;w.setData=T,w.setupGrid=R,w.draw=V,w.getPlaceholder=function(){return t},w.getCanvas=function(){return f.element},w.getPlotOffset=function(){return m},w.width=function(){return g},w.height=function(){return y},w.offset=function(){var e=c.offset();return e.left+=m.left,e.top+=m.top,e},w.getData=function(){return u},w.getAxes=function(){var t={},n;return e.each(d.concat(v),function(e,n){n&&(t[n.direction+(n.n!=1?n.n:"")+"axis"]=n)}),t},w.getXAxes=function(){return d},w.getYAxes=function(){return v},w.c2p=L,w.p2c=A,w.getOptions=function(){return a},w.highlight=dt,w.unhighlight=vt,w.triggerRedrawOverlay=ht,w.pointOffset=function(e){return{left:parseInt(d[C(e,"x")-1].p2c(+e.x)+m.left,10),top:parseInt(v[C(e,"y")-1].p2c(+e.y)+m.top,10)}},w.shutdown=H,w.destroy=function(){H(),t.removeData("plot").empty(),u=[],a=null,f=null,l=null,c=null,h=null,p=null,d=[],v=[],b=null,st=[],w=null},w.resize=function(){var e=t.width(),n=t.height();f.resize(e,n),l.resize(e,n)},w.hooks=b,S(w),x(s),D(),T(r),R(),V(),P();var st=[],ot=null}function i(e,t){return t*Math.floor(e/t)}var t=Object.prototype.hasOwnProperty;n.prototype.resize=function(e,t){if(e<=0||t<=0)throw new Error("Invalid dimensions for plot, width = "+e+", height = "+t);var n=this.element,r=this.context,i=this.pixelRatio;this.width!=e&&(n.width=e*i,n.style.width=e+"px",this.width=e),this.height!=t&&(n.height=t*i,n.style.height=t+"px",this.height=t),r.restore(),r.save(),r.scale(i,i)},n.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},n.prototype.render=function(){var e=this._textCache;for(var n in e)if(t.call(e,n)){var r=this.getTextLayer(n),i=e[n];r.hide();for(var s in i)if(t.call(i,s)){var o=i[s];for(var u in o)if(t.call(o,u)){var a=o[u].positions;for(var f=0,l;l=a[f];f++)l.active?l.rendered||(r.append(l.element),l.rendered=!0):(a.splice(f--,1),l.rendered&&l.element.detach());a.length==0&&delete o[u]}}r.show()}},n.prototype.getTextLayer=function(t){var n=this.text[t];return n==null&&(this.textContainer==null&&(this.textContainer=e("<div class='flot-text'></div>").css({position:"absolute",top:0,left:0,bottom:0,right:0,"font-size":"smaller",color:"#545454"}).insertAfter(this.element)),n=this.text[t]=e("<div></div>").addClass(t).css({position:"absolute",top:0,left:0,bottom:0,right:0}).appendTo(this.textContainer)),n},n.prototype.getTextInfo=function(t,n,r,i,s){var o,u,a,f;n=""+n,typeof r=="object"?o=r.style+" "+r.variant+" "+r.weight+" "+r.size+"px/"+r.lineHeight+"px "+r.family:o=r,u=this._textCache[t],u==null&&(u=this._textCache[t]={}),a=u[o],a==null&&(a=u[o]={}),f=a[n];if(f==null){var l=e("<div></div>").html(n).css({position:"absolute","max-width":s,top:-9999}).appendTo(this.getTextLayer(t));typeof r=="object"?l.css({font:o,color:r.color}):typeof r=="string"&&l.addClass(r),f=a[n]={width:l.outerWidth(!0),height:l.outerHeight(!0),element:l,positions:[]},l.detach()}return f},n.prototype.addText=function(e,t,n,r,i,s,o,u,a){var f=this.getTextInfo(e,r,i,s,o),l=f.positions;u=="center"?t-=f.width/2:u=="right"&&(t-=f.width),a=="middle"?n-=f.height/2:a=="bottom"&&(n-=f.height);for(var c=0,h;h=l[c];c++)if(h.x==t&&h.y==n){h.active=!0;return}h={active:!0,rendered:!1,element:l.length?f.element.clone():f.element,x:t,y:n},l.push(h),h.element.css({top:Math.round(n),left:Math.round(t),"text-align":u})},n.prototype.removeText=function(e,n,r,i,s,o){if(i==null){var u=this._textCache[e];if(u!=null)for(var a in u)if(t.call(u,a)){var f=u[a];for(var l in f)if(t.call(f,l)){var c=f[l].positions;for(var h=0,p;p=c[h];h++)p.active=!1}}}else{var c=this.getTextInfo(e,i,s,o).positions;for(var h=0,p;p=c[h];h++)p.x==n&&p.y==r&&(p.active=!1)}},e.plot=function(t,n,i){var s=new r(e(t),n,i,e.plot.plugins);return s},e.plot.version="0.8.2",e.plot.plugins=[],e.fn.plot=function(t,n){return this.each(function(){e.plot(this,t,n)})}}(jQuery),define("flot",function(){}),function(e){function n(e,t){return t*Math.floor(e/t)}function r(e,t,n,r){if(typeof e.strftime=="function")return e.strftime(t);var i=function(e,t){return e=""+e,t=""+(t==null?"0":t),e.length==1?t+e:e},s=[],o=!1,u=e.getHours(),a=u<12;n==null&&(n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),r==null&&(r=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]);var f;u>12?f=u-12:u==0?f=12:f=u;for(var l=0;l<t.length;++l){var c=t.charAt(l);if(o){switch(c){case"a":c=""+r[e.getDay()];break;case"b":c=""+n[e.getMonth()];break;case"d":c=i(e.getDate());break;case"e":c=i(e.getDate()," ");break;case"h":case"H":c=i(u);break;case"I":c=i(f);break;case"l":c=i(f," ");break;case"m":c=i(e.getMonth()+1);break;case"M":c=i(e.getMinutes());break;case"q":c=""+(Math.floor(e.getMonth()/3)+1);break;case"S":c=i(e.getSeconds());break;case"y":c=i(e.getFullYear()%100);break;case"Y":c=""+e.getFullYear();break;case"p":c=a?"am":"pm";break;case"P":c=a?"AM":"PM";break;case"w":c=""+e.getDay()}s.push(c),o=!1}else c=="%"?o=!0:s.push(c)}return s.join("")}function i(e){function t(e,t,n,r){e[t]=function(){return n[r].apply(n,arguments)}}var n={date:e};e.strftime!=undefined&&t(n,"strftime",e,"strftime"),t(n,"getTime",e,"getTime"),t(n,"setTime",e,"setTime");var r=["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds"];for(var i=0;i<r.length;i++)t(n,"get"+r[i],e,"getUTC"+r[i]),t(n,"set"+r[i],e,"setUTC"+r[i]);return n}function s(e,t){if(t.timezone=="browser")return new Date(e);if(!t.timezone||t.timezone=="utc")return i(new Date(e));if(typeof timezoneJS!="undefined"&&typeof timezoneJS.Date!="undefined"){var n=new timezoneJS.Date;return n.setTimezone(t.timezone),n.setTime(e),n}return i(new Date(e))}function l(t){t.hooks.processOptions.push(function(t,i){e.each(t.getAxes(),function(e,t){var i=t.options;i.mode=="time"&&(t.tickGenerator=function(e){var t=[],r=s(e.min,i),u=0,l=i.tickSize&&i.tickSize[1]==="quarter"||i.minTickSize&&i.minTickSize[1]==="quarter"?f:a;i.minTickSize!=null&&(typeof i.tickSize=="number"?u=i.tickSize:u=i.minTickSize[0]*o[i.minTickSize[1]]);for(var c=0;c<l.length-1;++c)if(e.delta<(l[c][0]*o[l[c][1]]+l[c+1][0]*o[l[c+1][1]])/2&&l[c][0]*o[l[c][1]]>=u)break;var h=l[c][0],p=l[c][1];if(p=="year"){if(i.minTickSize!=null&&i.minTickSize[1]=="year")h=Math.floor(i.minTickSize[0]);else{var d=Math.pow(10,Math.floor(Math.log(e.delta/o.year)/Math.LN10)),v=e.delta/o.year/d;v<1.5?h=1:v<3?h=2:v<7.5?h=5:h=10,h*=d}h<1&&(h=1)}e.tickSize=i.tickSize||[h,p];var m=e.tickSize[0];p=e.tickSize[1];var g=m*o[p];p=="second"?r.setSeconds(n(r.getSeconds(),m)):p=="minute"?r.setMinutes(n(r.getMinutes(),m)):p=="hour"?r.setHours(n(r.getHours(),m)):p=="month"?r.setMonth(n(r.getMonth(),m)):p=="quarter"?r.setMonth(3*n(r.getMonth()/3,m)):p=="year"&&r.setFullYear(n(r.getFullYear(),m)),r.setMilliseconds(0),g>=o.minute&&r.setSeconds(0),g>=o.hour&&r.setMinutes(0),g>=o.day&&r.setHours(0),g>=o.day*4&&r.setDate(1),g>=o.month*2&&r.setMonth(n(r.getMonth(),3)),g>=o.quarter*2&&r.setMonth(n(r.getMonth(),6)),g>=o.year&&r.setMonth(0);var y=0,b=Number.NaN,w;do{w=b,b=r.getTime(),t.push(b);if(p=="month"||p=="quarter")if(m<1){r.setDate(1);var E=r.getTime();r.setMonth(r.getMonth()+(p=="quarter"?3:1));var S=r.getTime();r.setTime(b+y*o.hour+(S-E)*m),y=r.getHours(),r.setHours(0)}else r.setMonth(r.getMonth()+m*(p=="quarter"?3:1));else p=="year"?r.setFullYear(r.getFullYear()+m):r.setTime(b+g)}while(b<e.max&&b!=w);return t},t.tickFormatter=function(e,t){var n=s(e,t.options);if(i.timeformat!=null)return r(n,i.timeformat,i.monthNames,i.dayNames);var u=t.options.tickSize&&t.options.tickSize[1]=="quarter"||t.options.minTickSize&&t.options.minTickSize[1]=="quarter",a=t.tickSize[0]*o[t.tickSize[1]],f=t.max-t.min,l=i.twelveHourClock?" %p":"",c=i.twelveHourClock?"%I":"%H",h;a<o.minute?h=c+":%M:%S"+l:a<o.day?f<2*o.day?h=c+":%M"+l:h="%b %d "+c+":%M"+l:a<o.month?h="%b %d":u&&a<o.quarter||!u&&a<o.year?f<o.year?h="%b":h="%b %Y":u&&a<o.year?f<o.year?h="Q%q":h="Q%q %Y":h="%Y";var p=r(n,h,i.monthNames,i.dayNames);return p})})})}var t={xaxis:{timezone:null,timeformat:null,twelveHourClock:!1,monthNames:null}},o={second:1e3,minute:6e4,hour:36e5,day:864e5,month:2592e6,quarter:7776e6,year:525949.2*60*1e3},u=[[1,"second"],[2,"second"],[5,"second"],[10,"second"],[30,"second"],[1,"minute"],[2,"minute"],[5,"minute"],[10,"minute"],[30,"minute"],[1,"hour"],[2,"hour"],[4,"hour"],[8,"hour"],[12,"hour"],[1,"day"],[2,"day"],[3,"day"],[.25,"month"],[.5,"month"],[1,"month"],[2,"month"]],a=u.concat([[3,"month"],[6,"month"],[1,"year"]]),f=u.concat([[1,"quarter"],[2,"quarter"],[1,"year"]]);e.plot.plugins.push({init:l,options:t,name:"time",version:"1.0"}),e.plot.formatDate=r,e.plot.dateGenerator=s}(jQuery),define("flot_time",function(){}),function(e){function n(t){function n(t,n,r,i,s,o){var u=r.points,a=r.pointsize,f=n.lines.show,l=e.extend({},n),c=[],h=[],p,d,v,m,g,y;l.datapoints={points:[],pointsize:a,format:r.format},l.label=null,l.color=o,l.threshold=null,l.originSeries=n,l.data=[];for(d=0;d<u.length;d+=a){v=u[d],m=u[d+1],p=g,m<i||m>s?g=c:g=h;if(f&&p!==g&&v!=null&&d>0&&u[d-a]!=null){var b=v+(i-m)*(v-u[d-a])/(m-u[d-a+1]);p.push(b),p.push(i);for(y=2;y<a;++y)p.push(u[d+y]);g.push(null),g.push(null);for(y=2;y<a;++y)g.push(u[d+y]);g.push(b),g.push(i);for(y=2;y<a;++y)g.push(u[d+y])}g.push(v),g.push(m);for(y=2;y<a;++y)g.push(u[d+y])}r.points=h,l.datapoints.points=c;if(l.datapoints.points.length>0){var w=e.inArray(n,t.getData());t.getData().splice(w+1,0,l)}}function r(t,r,i){if(!r.threshold)return;r.threshold instanceof Array?(r.threshold.sort(function(e,t){return e.below-t.below}),e(r.threshold).each(function(e,o){n(t,r,i,o.below,o.above,o.color)})):n(t,r,i,r.threshold.below,r.threshold.above,r.threshold.color)}function i(t,n,r){if(!r.threshold)return;var i=r.threshold.color?r.threshold.color:"black";e(".legendLabel").each(function(){if(e(this).text()===r.label){var t=e(this).prev().find("div > div");t.css("border-right-color",i),t.css("border-bottom-color",i)}})}t.hooks.processDatapoints.push(r),t.hooks.drawSeries.push(i)}var t={series:{threshold:null}};e.plot.plugins.push({init:n,options:t,name:"threshold",version:"1.3"})}(jQuery),define("flot_threshold",function(){}),define("views/flotchart",["jquery","underscore","backbone","flot","flot_time","flot_threshold"],function(e,t,n){return app.views.FlotChart=n.View.extend({tagName:"div",className:"flot_chart",style:"height: 100px;",initialize:function(e){this.options=e||{},t.bindAll(this,"render"),this.model.bind("change",function(e){console.log("Change event in FlotChart",e.id),this.render()},this)},render:function(){var n=this.model.attributes;delete n.id;var r=t.toArray(n),i=[];t.each(r,function(e){i.push([e[1],e[0]])});var s={xaxis:{mode:"time",timezone:"browser",alignTicksWithAxis:!0,tickSize:[5,"minute"]},bars:{show:!0,barWidth:3e5,align:"center"},color:"rgb(30, 180, 20)",threshold:{below:30,color:"rgb(200, 20, 30)"},grid:{color:"#444444",backgroundColor:{colors:["#fff","#e4f4f4"]},borderColor:"#FFFFFF",borderWidth:1,clickable:!1,hoverable:!0,autoHighlight:!0},data:i};return this.plot=e.plot(this.el,[s],s),this}}),app.views.Parkingarea});var Geo={};Geo.parseDMS=function(e){if(typeof n=="object")throw new TypeError("Geo.parseDMS - dmsStr is [DOM?] object");if(typeof e=="number"&&isFinite(e))return Number(e);var t=String(e).trim().replace(/^-/,"").replace(/[NSEW]$/i,"").split(/[^0-9.,]+/);t[t.length-1]==""&&t.splice(t.length-1);if(t=="")return NaN;switch(t.length){case 3:var n=t[0]/1+t[1]/60+t[2]/3600;break;case 2:var n=t[0]/1+t[1]/60;break;case 1:var n=t[0];break;default:return NaN}return/^-|[WS]$/i.test(e.trim())&&(n=-n),Number(n)},Geo.toDMS=function(e,t,n){if(typeof e=="object")throw new TypeError("Geo.toDMS - deg is [DOM?] object");if(isNaN(e))return null;typeof t=="undefined"&&(t="dms");if(typeof n=="undefined")switch(t){case"d":n=4;break;case"dm":n=2;break;case"dms":n=0;break;default:t="dms",n=0}e=Math.abs(e);switch(t){case"d":i=e.toFixed(n),i<100&&(i="0"+i),i<10&&(i="0"+i),dms=i+"°";break;case"dm":var r=(e*60).toFixed(n),i=Math.floor(r/60),s=(r%60).toFixed(n);i<100&&(i="0"+i),i<10&&(i="0"+i),s<10&&(s="0"+s),dms=i+"°"+s+"′";break;case"dms":var o=(e*3600).toFixed(n),i=Math.floor(o/3600),s=Math.floor(o/60)%60,u=(o%60).toFixed(n);i<100&&(i="0"+i),i<10&&(i="0"+i),s<10&&(s="0"+s),u<10&&(u="0"+u),dms=i+"°"+s+"′"+u+"″"}return dms},Geo.toLat=function(e,t,n){var r=Geo.toDMS(e,t,n);return r==null?"–":r.slice(1)+(e<0?"S":"N")},Geo.toLon=function(e,t,n){var r=Geo.toDMS(e,t,n);return r==null?"–":r+(e<0?"W":"E")},Geo.toBrng=function(e,t,n){e=(Number(e)+360)%360;var r=Geo.toDMS(e,t,n);return r==null?"–":r.replace("360","0")},window.console||(window.console={log:function(){}}),define("geo",function(){}),LatLon.prototype.distanceTo=function(e,t){typeof t=="undefined"&&(t=4);var n=this._radius,r=this._lat.toRad(),i=this._lon.toRad(),s=e._lat.toRad(),o=e._lon.toRad(),u=s-r,a=o-i,f=Math.sin(u/2)*Math.sin(u/2)+Math.cos(r)*Math.cos(s)*Math.sin(a/2)*Math.sin(a/2),l=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),c=n*l;return c.toPrecisionFixed(t)},LatLon.prototype.bearingTo=function(e){var t=this._lat.toRad(),n=e._lat.toRad(),r=(e._lon-this._lon).toRad(),i=Math.sin(r)*Math.cos(n),s=Math.cos(t)*Math.sin(n)-Math.sin(t)*Math.cos(n)*Math.cos(r),o=Math.atan2(i,s);return(o.toDeg()+360)%360},LatLon.prototype.finalBearingTo=function(e){var t=e._lat.toRad(),n=this._lat.toRad(),r=(this._lon-e._lon).toRad(),i=Math.sin(r)*Math.cos(n),s=Math.cos(t)*Math.sin(n)-Math.sin(t)*Math.cos(n)*Math.cos(r),o=Math.atan2(i,s);return(o.toDeg()+180)%360},LatLon.prototype.midpointTo=function(e){lat1=this._lat.toRad(),lon1=this._lon.toRad(),lat2=e._lat.toRad();var t=(e._lon-this._lon).toRad(),n=Math.cos(lat2)*Math.cos(t),r=Math.cos(lat2)*Math.sin(t);return lat3=Math.atan2(Math.sin(lat1)+Math.sin(lat2),Math.sqrt((Math.cos(lat1)+n)*(Math.cos(lat1)+n)+r*r)),lon3=lon1+Math.atan2(r,Math.cos(lat1)+n),lon3=(lon3+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat3.toDeg(),lon3.toDeg())},LatLon.prototype.destinationPoint=function(e,t){t=typeof t=="number"?t:typeof t=="string"&&t.trim()!=""?+t:NaN,t/=this._radius,e=e.toRad();var n=this._lat.toRad(),r=this._lon.toRad(),i=Math.asin(Math.sin(n)*Math.cos(t)+Math.cos(n)*Math.sin(t)*Math.cos(e)),s=r+Math.atan2(Math.sin(e)*Math.sin(t)*Math.cos(n),Math.cos(t)-Math.sin(n)*Math.sin(i));return s=(s+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(i.toDeg(),s.toDeg())},LatLon.intersection=function(e,t,n,r){return t=typeof t=="number"?t:typeof t=="string"&&trim(t)!=""?+t:NaN,r=typeof r=="number"?r:typeof r=="string"&&trim(r)!=""?+r:NaN,lat1=e._lat.toRad(),lon1=e._lon.toRad(),lat2=n._lat.toRad(),lon2=n._lon.toRad(),brng13=t.toRad(),brng23=r.toRad(),dLat=lat2-lat1,dLon=lon2-lon1,dist12=2*Math.asin(Math.sqrt(Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)*Math.sin(dLon/2))),dist12==0?null:(brngA=Math.acos((Math.sin(lat2)-Math.sin(lat1)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat1))),isNaN(brngA)&&(brngA=0),brngB=Math.acos((Math.sin(lat1)-Math.sin(lat2)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat2))),Math.sin(lon2-lon1)>0?(brng12=brngA,brng21=2*Math.PI-brngB):(brng12=2*Math.PI-brngA,brng21=brngB),alpha1=(brng13-brng12+Math.PI)%(2*Math.PI)-Math.PI,alpha2=(brng21-brng23+Math.PI)%(2*Math.PI)-Math.PI,Math.sin(alpha1)==0&&Math.sin(alpha2)==0?null:Math.sin(alpha1)*Math.sin(alpha2)<0?null:(alpha3=Math.acos(-Math.cos(alpha1)*Math.cos(alpha2)+Math.sin(alpha1)*Math.sin(alpha2)*Math.cos(dist12)),dist13=Math.atan2(Math.sin(dist12)*Math.sin(alpha1)*Math.sin(alpha2),Math.cos(alpha2)+Math.cos(alpha1)*Math.cos(alpha3)),lat3=Math.asin(Math.sin(lat1)*Math.cos(dist13)+Math.cos(lat1)*Math.sin(dist13)*Math.cos(brng13)),dLon13=Math.atan2(Math.sin(brng13)*Math.sin(dist13)*Math.cos(lat1),Math.cos(dist13)-Math.sin(lat1)*Math.sin(lat3)),lon3=lon1+dLon13,lon3=(lon3+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat3.toDeg(),lon3.toDeg())))},LatLon.prototype.rhumbDistanceTo=function(e){var t=this._radius,n=this._lat.toRad(),r=e._lat.toRad(),i=(e._lat-this._lat).toRad(),s=Math.abs(e._lon-this._lon).toRad(),o=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),u=isFinite(i/o)?i/o:Math.cos(n);Math.abs(s)>Math.PI&&(s=s>0?-(2*Math.PI-s):2*Math.PI+s);var a=Math.sqrt(i*i+u*u*s*s)*t;return a.toPrecisionFixed(4)},LatLon.prototype.rhumbBearingTo=function(e){var t=this._lat.toRad(),n=e._lat.toRad(),r=(e._lon-this._lon).toRad(),i=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(t/2+Math.PI/4));Math.abs(r)>Math.PI&&(r=r>0?-(2*Math.PI-r):2*Math.PI+r);var s=Math.atan2(r,i);return(s.toDeg()+360)%360},LatLon.prototype.rhumbDestinationPoint=function(e,t){var n=this._radius,r=parseFloat(t)/n,i=this._lat.toRad(),s=this._lon.toRad();e=e.toRad();var o=r*Math.cos(e);Math.abs(o)<1e-10&&(o=0);var u=i+o,a=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),f=isFinite(o/a)?o/a:Math.cos(i),l=r*Math.sin(e)/f;return Math.abs(u)>Math.PI/2&&(u=u>0?Math.PI-u:-Math.PI-u),lon2=(s+l+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(u.toDeg(),lon2.toDeg())},LatLon.prototype.rhumbMidpointTo=function(e){lat1=this._lat.toRad(),lon1=this._lon.toRad(),lat2=e._lat.toRad(),lon2=e._lon.toRad(),Math.abs(lon2-lon1)>Math.PI&&(lon1+=2*Math.PI);var t=(lat1+lat2)/2,n=Math.tan(Math.PI/4+lat1/2),r=Math.tan(Math.PI/4+lat2/2),i=Math.tan(Math.PI/4+t/2),s=((lon2-lon1)*Math.log(i)+lon1*Math.log(r)-lon2*Math.log(n))/Math.log(r/n);return isFinite(s)||(s=(lon1+lon2)/2),s=(s+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(t.toDeg(),s.toDeg())},LatLon.prototype.lat=function(e,t){return typeof e=="undefined"?this._lat:Geo.toLat(this._lat,e,t)},LatLon.prototype.lon=function(e,t){return typeof e=="undefined"?this._lon:Geo.toLon(this._lon,e,t)},LatLon.prototype.toString=function(e,t){return typeof e=="undefined"&&(e="dms"),Geo.toLat(this._lat,e,t)+", "+Geo.toLon(this._lon,e,t)},typeof Number.prototype.toRad=="undefined"&&(Number.prototype.toRad=function(){return this*Math.PI/180}),typeof Number.prototype.toDeg=="undefined"&&(Number.prototype.toDeg=function(){return this*180/Math.PI}),typeof Number.prototype.toPrecisionFixed=="undefined"&&(Number.prototype.toPrecisionFixed=function(e){var t=this.toPrecision(e);return t=t.replace(/(.+)e\+(.+)/,function(e,t,n){t=t.replace(/\./,""),l=t.length-1;while(n-->l)t+="0";return t}),t=t.replace(/(.+)e-(.+)/,function(e,t,n){t=t.replace(/\./,"");while(n-->1)t="0"+t;return"0."+t}),t}),typeof String.prototype.trim=="undefined"&&(String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),window.console||(window.console={log:function(){}}),define("latlon",function(){}),define("views/distance",["jquery","underscore","backbone","latlon"],function(e,t,n){return app.views.Distance=n.View.extend({tagName:"span",className:"",initialize:function(){t.bindAll(this,"render"),this.listenTo(n,"distance",this.render,this)},render:function(){var e="<span class='glyphicon glyphicon-road'> </span>  ";if(app.position!==undefined){var t=new LatLon(app.position.coords.latitude,app.position.coords.longitude),n=new LatLon(this.model.attributes.latitude,this.model.attributes.longitude),r=t.distanceTo(n);this.model.attributes.distance=r,this.$el.addClass(""),e=e+r+" Km"}else this.$el.removeClass("badge badge-positive"),e+=" n.a.";return this.$el.html(e),app.views.myScroll&&app.views.myScroll.refresh(),this}}),app.views.Distance}),define("views/parkingarea",["jquery","underscore","backbone","views/freeslot","models/history","views/history","views/flotchart","views/distance"],function(e,t,n){return app.views.Parkingarea=n.View.extend({tagName:"li",className:"table-view-cell parking media",initialize:function(r){this.options=r||{},t.bindAll(this,"render"),this.model.bind("change",function(e){console.log("Change event in parkingarea",e.id),this.render()},this),this.$el.on("change",this.update,this),e(".trend",this.$el).on("change",this.update,this),e(".realtime",this.$el).on("change",this.update,this);var i=this.options.template||"#parkingareaListItem_template";i==="#parkingareaDetails_template"&&(console.log("listen di parkingare"),this.listenTo(n,"backbutton",this.handle_backbutton,this))},render:function(){var n=this.options.template||"#parkingareaListItem_template",r=t.template(e(n).html(),this.model.attributes);this.$el.html(r),setTimeout(function(){app.views.myScroll&&app.views.myScroll.refresh()},100);var i=new app.models.History({id:this.model.id});this.listenTo(i,"change",this.update);var s=new app.views.Freeslot({model:i});e(".realtime",this.el).html(s.el);var o=new app.views.History({model:i}),u=new app.views.Distance({model:this.model});e(".distance",this.el).html(u.$el);if(n==="#parkingareaDetails_template"){var a=new app.views.FlotChart({model:i});e(".chart",this.$el).html(a.$el),e("#update_all",this.$el).html(app.reload.render().el)}var f=JSON.parse(window.localStorage.getItem("favorites")),l=this.model.id,c=e.inArray(l,f);return c>=0?(e(".star span",this.el).addClass("glyphicon-star"),e(".star span",this.el).addClass("yellow")):e(".star span",this.el).addClass("glyphicon-star-empty"),this},update:function(){return setTimeout(function(){app.views.myScroll&&app.views.myScroll.refresh()},100),this},events:{"click .star":"toggle_as_favorite"},toggle_as_favorite:function(t){var n=JSON.parse(window.localStorage.getItem("favorites")),r=this.model.id;console.log(n),console.log(r),e(t.target).toggleClass("glyphicon glyphicon-star"),e(t.target).toggleClass("glyphicon glyphicon-star-empty"),e(t.target).toggleClass("yellow");var i=e.inArray(r,n);i>=0?(navigator.notification.alert("Removed from favorites",function(){},"ParkingBolzano","Ok"),n.splice(i,1)):(navigator.notification.alert("Added to favorites",function(){},"ParkingBolzano","Ok"),n.push(r)),window.localStorage.setItem("favorites",JSON.stringify(n))},handle_backbutton:function(e){console.log("handle_backbutton"),window.history.back()},update_all:function(e){e.preventDefault(),console.log("update_all di parkingarea"),n.trigger("freeslot:update")}}),app.views.Parkingarea}),define("views/parkingareaList",["jquery","underscore","backbone","Iscroll","models/parkingarea","models/parkingareaCollection","views/parkingarea"],function(e,t,n,r){return app.views.ParkingareaList=n.View.extend({className:"",initialize:function(){t.bindAll(this,"render","reset"),this.collection.bind("reset",function(e){console.log("event reset in ParkingareaList"),this.reset()},this),this.listenTo(n,"collection:failed",this.render_error,this),this.collection.bind("add",function(e){console.log('ParkingareaList  this.collection.bind("add"'),this.add(e),app.views.myScroll.refresh()},this),this.collection.bind("remove",function(e){console.log("event remove in ParkingareaList"),this.reset()},this),this.template_error=t.template("Errore di rete, <a href='#' id='reload'>Reload</a>"),this.template_loading=t.template(e("#main_loading_template").html()),this.template_list=t.template("<div class='excard'><ul class='table-view'></ul></div>",{}),this.template=t.template("Default"),this.reload()},add:function(t){console.log("ParkingareaList  ADD");var n=new app.views.Parkingarea({model:t});return e("ul",this.$el).append(n.render().el),this},render:function(){return console.log("ParkingareaList render",this.collection.models),this.$el.html(this.template),this},reset:function(){return console.log("ParkingareaList reset",this.collection.models),this.$template_list=e(this.template_list),this.collection.each(function(t){var n=new app.views.Parkingarea({model:t});e("ul",this.$template_list).append(n.render().el)},this),this.$el.html(this.$template_list),app.views.myScroll.refresh(),this.template=this.template_list,this},render_error:function(){return console.log("ParkingareaList render_error"),this.$el.html(this.template_error),this.template=this.template_error,this},render_loading:function(){return console.log("ParkingareaList render_loading"),this.$el.html(this.template_loading),this.template=this.template_loading,this},events:{"click #reload":"reload_click"},reload_click:function(){console.log("reload click"),this.reload()},reload:function(){console.log("ParkingareaList reload"),this.render_loading(),this.collection.update_all()}}),app.views.ParkingareaList}),define("views/reload",["jquery","underscore","backbone"],function(e,t,n){return app.views.Reload=n.View.extend({tagName:"span",className:"glyphicon glyphicon-refresh",initialize:function(){return t.bindAll(this,"render","trigger_update","set_loading"),this.collection=app.parkingarea_collection,this.collection.on("reset",function(){this.enable(),this.render()},this),this.listenTo(n,"collection:update",this.set_loading,this),this.listenTo(n,"collection:failed",this.render,this),this.listenTo(n,"freeslot:updated",this.render,this),this.listenTo(n,"collection:update_all",this.disable,this),this},render:function(){return this.$el.removeClass("glyphicon-refresh-animate"),this.$el.empty(),this},set_loading:function(){return this.$el.empty(),this.$el.addClass("glyphicon-refresh-animate"),this.$el.parent().blur(),this},events:{click:"trigger_update"},disable:function(){this.$el.addClass("disable")},enable:function(){this.$el.removeClass("disable")},trigger_update:function(e){return console.log("update_all di reload"),n.trigger("collection:update"),!1}}),app.views.Reload}),define("views/home",["jquery","underscore","backbone","Iscroll","spin","models/parkingareaCollection","views/parkingareaList","views/reload"],function(e,t,n,r,i){return app.views.Home=n.View.extend({tagName:"div",initialize:function(){t.bindAll(this,"render"),this.collection.bind("reset",function(e){console.log("this.collection event reset in home"),this.scroll()},this);var r=window.localStorage.getItem("realtime_update");return r=="true"&&n.trigger("tick:start"),this.template=t.template(e("#home_template").html()),this.$el.html(this.template),this.collection_view=new app.views.ParkingareaList({el:e("#wrapper",this.$el),collection:this.collection}),this._first_run=!0,this},render:function(){console.log("render di home"),this.scroll();var t=window.localStorage.getItem("gps_startup");return t=="true"&&(console.log("gps start"),this._first_run===!0?(this.position(undefined),this._first_run=!1):app.watchposition_id!==undefined&&(app.position!==undefined?e("#geo").addClass("green"):e("#geo").addClass("work"))),this},events:{"click #geo":"position"},position:function(t){t&&(e(t.target).blur(),e(t.target).parent().blur(),console.log(e(t.target)));if(app.watchposition_id===undefined){e("#geo").addClass("work"),console.log("start location");var r=function(t){console.log("locationOnSuccess"),e("#geo").removeClass("work"),e("#geo").addClass("green"),app.position=t,n.trigger("distance")},i=function(t){console.log("locationOnError"),e("#geo").removeClass("green"),e("#geo").addClass("work"),app.position=undefined,n.trigger("distance")},s={enableHighAccuracy:!0,timeout:1e4,maximumAge:15e3};app.watchposition_id=navigator.geolocation.watchPosition(r,i,s)}else console.log("stop location"),e("#geo").removeClass("green work"),navigator.geolocation.clearWatch(app.watchposition_id),app.watchposition_id=undefined},scroll:function(){console.log("scroll"),app.views.myScroll&&(app.views.myScroll.destroy(),app.views.myScroll=null),app.views.myScroll=new r(e(".content",this.$el).get(0),{snap:!0,momentum:!1,hScrollbar:!1,vScrollbar:!1,lockDirection:!0,click:!0}),app.views.myScroll.on("scrollEnd",function(){})}}),app.views.Home}),function(e,t,n){function i(){var t=e.L;r.noConflict=function(){return e.L=t,this},e.L=r}var r={version:"0.8-dev"};typeof module=="object"&&typeof module.exports=="object"?module.exports=r:typeof define=="function"&&define.amd?define("leaflet",r):i(),r.Util={extend:function(e){var t=Array.prototype.slice.call(arguments,1),n,r,i,s;for(r=0,i=t.length;r<i;r++){s=t[r];for(n in s)e[n]=s[n]}return e},create:Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}(),bind:function(e,t){var n=Array.prototype.slice;if(e.bind)return e.bind.apply(e,n.call(arguments,1));var r=n.call(arguments,2);return function(){return e.apply(t,r.length?r.concat(n.call(arguments)):arguments)}},stamp:function(e){return e._leaflet_id=e._leaflet_id||++r.Util.lastId,e._leaflet_id},lastId:0,throttle:function(e,t,n){var r,i,s,o;return o=function(){r=!1,i&&(s.apply(n,i),i=!1)},s=function(){r?i=arguments:(e.apply(n,arguments),setTimeout(o,t),r=!0)},s},wrapNum:function(e,t,n){var r=t[1],i=t[0],s=r-i;return e===r&&n?e:((e-i)%s+s)%s+i},falseFn:function(){return!1},formatNum:function(e,t){var n=Math.pow(10,t||5);return Math.round(e*n)/n},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},splitWords:function(e){return r.Util.trim(e).split(/\s+/)},setOptions:function(e,t){e.hasOwnProperty("options")||(e.options=e.options?r.Util.create(e.options):{});for(var n in t)e.options[n]=t[n];return e.options},getParamString:function(e,t,n){var r=[];for(var i in e)r.push(encodeURIComponent(n?i.toUpperCase():i)+"="+encodeURIComponent(e[i]));return(!t||t.indexOf("?")===-1?"?":"&")+r.join("&")},template:function(e,t){return e.replace(r.Util.templateRe,function(e,r){var i=t[r];if(i===n)throw new Error("No value provided for variable "+e);return typeof i=="function"&&(i=i(t)),i})},templateRe:/\{ *([\w_]+) *\}/g,isArray:Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function t(t){return e["webkit"+t]||e["moz"+t]||e["ms"+t]}function i(t){var r=+(new Date),i=Math.max(0,16-(r-n));return n=r+i,e.setTimeout(t,i)}var n=0,s=e.requestAnimationFrame||t("RequestAnimationFrame")||i,o=e.cancelAnimationFrame||t("CancelAnimationFrame")||t("CancelRequestAnimationFrame")||function(t){e.clearTimeout(t)};r.Util.requestAnimFrame=function(t,n,o,u){if(!o||s!==i)return s.call(e,r.bind(t,n),u);t.call(n)},r.Util.cancelAnimFrame=function(t){t&&o.call(e,t)}}(),r.extend=r.Util.extend,r.bind=r.Util.bind,r.stamp=r.Util.stamp,r.setOptions=r.Util.setOptions,r.Class=function(){},r.Class.extend=function(e){var t=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks.length&&this.callInitHooks()},n=t.__super__=this.prototype,i=r.Util.create(n);i.constructor=t,t.prototype=i;for(var s in this)this.hasOwnProperty(s)&&s!=="prototype"&&(t[s]=this[s]);return e.statics&&(r.extend(t,e.statics),delete e.statics),e.includes&&(r.Util.extend.apply(null,[i].concat(e.includes)),delete e.includes),i.options&&(e.options=r.Util.extend(r.Util.create(i.options),e.options)),r.extend(i,e),i._initHooks=[],i.callInitHooks=function(){if(this._initHooksCalled)return;n.callInitHooks&&n.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=i._initHooks.length;e<t;e++)i._initHooks[e].call(this)},t},r.Class.include=function(e){r.extend(this.prototype,e)},r.Class.mergeOptions=function(e){r.extend(this.prototype.options,e)},r.Class.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),n=typeof e=="function"?e:function(){this[e].apply(this,t)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n)},r.Evented=r.Class.extend({on:function(e,t,n){if(typeof e=="object")for(var i in e)this._on(i,e[i],t);else{e=r.Util.splitWords(e);for(var s=0,o=e.length;s<o;s++)this._on(e[s],t,n)}return this},off:function(e,t,n){if(!e)delete this._events;else if(typeof e=="object")for(var i in e)this._off(i,e[i],t);else{e=r.Util.splitWords(e);for(var s=0,o=e.length;s<o;s++)this._off(e[s],t,n)}return this},_on:function(e,t,n){var i=this._events=this._events||{},s=n&&n!==this&&r.stamp(n);if(s){var o=e+"_idx",u=e+"_len",a=i[o]=i[o]||{},f=r.stamp(t)+"_"+s;a[f]||(a[f]={fn:t,ctx:n},i[u]=(i[u]||0)+1)}else i[e]=i[e]||[],i[e].push({fn:t})},_off:function(e,t,n){var i=this._events,s=e+"_idx",o=e+"_len";if(!i)return;if(!t){delete i[e],delete i[s],delete i[o];return}var u=n&&n!==this&&r.stamp(n),a,f,l,c,h;if(u)h=r.stamp(t)+"_"+u,a=i[s],a&&a[h]&&(c=a[h],delete a[h],i[o]--);else{a=i[e];if(a)for(f=0,l=a.length;f<l;f++)if(a[f].fn===t){c=a[f],a.splice(f,1);break}}c&&(c.fn=r.Util.falseFn)},fire:function(e,t,n){if(!this.listens(e,n))return this;var i=r.Util.extend({},t,{type:e,target:this}),s=this._events;if(s){var o=s[e+"_idx"],u,a,f,l;if(s[e]){f=s[e].slice();for(u=0,a=f.length;u<a;u++)f[u].fn.call(this,i)}for(l in o)o[l].fn.call(o[l].ctx,i)}return n&&this._propagateEvent(i),this},listens:function(e,t){var n=this._events;if(n&&(n[e]||n[e+"_len"]))return!0;if(t)for(var r in this._eventParents)if(this._eventParents[r].listens(e,t))return!0;return!1},once:function(e,t,n){if(typeof e=="object"){for(var i in e)this.once(i,e[i],t);return this}var s=r.bind(function(){this.off(e,t,n).off(e,s,n)},this);return this.on(e,t,n).on(e,s,n)},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[r.stamp(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[r.stamp(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,r.extend({layer:e.target},e),!0)}});var s=r.Evented.prototype;s.addEventListener=s.on,s.removeEventListener=s.clearAllEventListeners=s.off,s.addOneTimeEventListener=s.once,s.fireEvent=s.fire,s.hasEventListeners=s.listens,r.Mixin={Events:s},function(){var n=navigator.userAgent.toLowerCase(),i=t.documentElement,s="ActiveXObject"in e,o=n.indexOf("webkit")!==-1,u=n.indexOf("phantom")!==-1,a=n.search("android [23]")!==-1,f=n.indexOf("chrome")!==-1,l=typeof orientation!="undefined",c=navigator.msPointerEnabled&&navigator.msMaxTouchPoints&&!e.PointerEvent,h=e.PointerEvent&&navigator.pointerEnabled&&navigator.maxTouchPoints||c,p=s&&"transition"in i.style,d="WebKitCSSMatrix"in e&&"m11"in new e.WebKitCSSMatrix&&!a,v="MozPerspective"in i.style,m="OTransition"in i.style,g="devicePixelRatio"in e&&e.devicePixelRatio>1;if(!g&&"matchMedia"in e){var y=e.matchMedia("(min-resolution:144dpi)");g=y&&y.matches}var b=!e.L_NO_TOUCH&&!u&&(h||"ontouchstart"in e||e.DocumentTouch&&t instanceof e.DocumentTouch);r.Browser={ie:s,ielt9:s&&!t.addEventListener,webkit:o,gecko:n.indexOf("gecko")!==-1&&!o&&!e.opera&&!s,android:n.indexOf("android")!==-1,android23:a,chrome:f,safari:!f&&n.indexOf("safari")!==-1,ie3d:p,webkit3d:d,gecko3d:v,opera3d:m,any3d:!e.L_DISABLE_3D&&(p||d||v||m)&&!u,mobile:l,mobileWebkit:l&&o,mobileWebkit3d:l&&d,mobileOpera:l&&e.opera,touch:!!b,msPointer:!!c,pointer:!!h,retina:!!g}}(),r.Point=function(e,t,n){this.x=n?Math.round(e):e,this.y=n?Math.round(t):t},r.Point.prototype={clone:function(){return new r.Point(this.x,this.y)},add:function(e){return this.clone()._add(r.point(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(r.point(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},distanceTo:function(e){e=r.point(e);var t=e.x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},equals:function(e){return e=r.point(e),e.x===this.x&&e.y===this.y},contains:function(e){return e=r.point(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+r.Util.formatNum(this.x)+", "+r.Util.formatNum(this.y)+")"}},r.point=function(e,t,i){return e instanceof r.Point?e:r.Util.isArray(e)?new r.Point(e[0],e[1]):e===n||e===null?e:new r.Point(e,t,i)},r.Bounds=function(e,t){if(!e)return;var n=t?[e,t]:e;for(var r=0,i=n.length;r<i;r++)this.extend(n[r])},r.Bounds.prototype={extend:function(e){return e=r.point(e),!this.min&&!this.max?(this.min=e.clone(),this.max=e.clone()):(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(e.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(e.y,this.max.y)),this},getCenter:function(e){return new r.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return new r.Point(this.min.x,this.max.y)},getTopRight:function(){return new r.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,n;return typeof e[0]=="number"||e instanceof r.Point?e=r.point(e):e=r.bounds(e),e instanceof r.Bounds?(t=e.min,n=e.max):t=n=e,t.x>=this.min.x&&n.x<=this.max.x&&t.y>=this.min.y&&n.y<=this.max.y},intersects:function(e){e=r.bounds(e);var t=this.min,n=this.max,i=e.min,s=e.max,o=s.x>=t.x&&i.x<=n.x,u=s.y>=t.y&&i.y<=n.y;return o&&u},isValid:function(){return!!this.min&&!!this.max}},r.bounds=function(e,t){return!e||e instanceof r.Bounds?e:new r.Bounds(e,t)},r.Transformation=function(e,t,n,r){this._a=e,this._b=t,this._c=n,this._d=r},r.Transformation.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new r.Point((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}},r.DomUtil={get:function(e){return typeof e=="string"?t.getElementById(e):e},getStyle:function(e,n){var r=e.style[n]||e.currentStyle&&e.currentStyle[n];if((!r||r==="auto")&&t.defaultView){var i=t.defaultView.getComputedStyle(e,null);r=i?i[n]:null}return r==="auto"?null:r},create:function(e,n,r){var i=t.createElement(e);return i.className=n,r&&r.appendChild(i),i},remove:function(e){var t=e.parentNode;t&&t.removeChild(e)},toFront:function(e){e.parentNode.appendChild(e)},toBack:function(e){var t=e.parentNode;t.insertBefore(e,t.firstChild)},hasClass:function(e,t){if(e.classList!==n)return e.classList.contains(t);var i=r.DomUtil.getClass(e);return i.length>0&&(new RegExp("(^|\\s)"+t+"(\\s|$)")).test(i)},addClass:function(e,t){if(e.classList!==n){var i=r.Util.splitWords(t);for(var s=0,o=i.length;s<o;s++)e.classList.add(i[s])}else if(!r.DomUtil.hasClass(e,t)){var u=r.DomUtil.getClass(e);r.DomUtil.setClass(e,(u?u+" ":"")+t)}},removeClass:function(e,t){e.classList!==n?e.classList.remove(t):r.DomUtil.setClass(e,r.Util.trim((" "+r.DomUtil.getClass(e)+" ").replace(" "+t+" "," ")))},setClass:function(e,t){e.className.baseVal===n?e.className=t:e.className.baseVal=t},getClass:function(e){return e.className.baseVal===n?e.className:e.className.baseVal},setOpacity:function(e,t){if("opacity"in e.style)e.style.opacity=t;else if("filter"in e.style){var n=!1,r="DXImageTransform.Microsoft.Alpha";try{n=e.filters.item(r)}catch(i){if(t===1)return}t=Math.round(t*100),n?(n.Enabled=t!==100,n.Opacity=t):e.style.filter+=" progid:"+r+"(opacity="+t+")"}},testProp:function(e){var n=t.documentElement.style;for(var r=0;r<e.length;r++)if(e[r]in n)return e[r];return!1},setTransform:function(e,t,n){var i=t||new r.Point(0,0);e.style[r.DomUtil.TRANSFORM]="translate3d("+i.x+"px,"+i.y+"px"+",0)"+(n?" scale("+n+")":"")},setPosition:function(e,t,n){e._leaflet_pos=t,r.Browser.any3d&&!n?r.DomUtil.setTransform(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")},getPosition:function(e){return e._leaflet_pos}},function(){r.DomUtil.TRANSFORM=r.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);var n=r.DomUtil.TRANSITION=r.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);r.DomUtil.TRANSITION_END=n==="webkitTransition"||n==="OTransition"?n+"End":"transitionend";if("onselectstart"in t)r.DomUtil.disableTextSelection=function(){r.DomEvent.on(e,"selectstart",r.DomEvent.preventDefault)},r.DomUtil.enableTextSelection=function(){r.DomEvent.off(e,"selectstart",r.DomEvent.preventDefault)};else{var i=r.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);r.DomUtil.disableTextSelection=function(){if(i){var e=t.documentElement.style;this._userSelect=e[i],e[i]="none"}},r.DomUtil.enableTextSelection=function(){i&&(t.documentElement.style[i]=this._userSelect,delete this._userSelect)}}r.DomUtil.disableImageDrag=function(){r.DomEvent.on(e,"dragstart",r.DomEvent.preventDefault)},r.DomUtil.enableImageDrag=function(){r.DomEvent.off(e,"dragstart",r.DomEvent.preventDefault)}}(),r.LatLng=function(e,t,r){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,r!==n&&(this.alt=+r)},r.LatLng.prototype={equals:function(e,t){if(!e)return!1;e=r.latLng(e);var i=Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng));return i<=(t===n?1e-9:t)},toString:function(e){return"LatLng("+r.Util.formatNum(this.lat,e)+", "+r.Util.formatNum(this.lng,e)+")"},distanceTo:function(e){return r.CRS.Earth.distance(this,r.latLng(e))},wrap:function(){return r.CRS.Earth.wrapLatLng(this)}},r.latLng=function(e,t){return e instanceof r.LatLng?e:r.Util.isArray(e)&&typeof e[0]!="object"?e.length===3?new r.LatLng(e[0],e[1],e[2]):new r.LatLng(e[0],e[1]):e===n||e===null?e:typeof e=="object"&&"lat"in e?new r.LatLng(e.lat,"lng"in e?e.lng:e.lon):t===n?null:new r.LatLng(e,t)},r.LatLngBounds=function(e,t){if(!e)return;var n=t?[e,t]:e;for(var r=0,i=n.length;r<i;r++)this.extend(n[r])},r.LatLngBounds.prototype={extend:function(e){var t=this._southWest,n=this._northEast,i,s;if(e instanceof r.LatLng)i=e,s=e;else{if(!(e instanceof r.LatLngBounds))return e?this.extend(r.latLng(e)||r.latLngBounds(e)):this;i=e._southWest,s=e._northEast;if(!i||!s)return this}return!t&&!n?(this._southWest=new r.LatLng(i.lat,i.lng),this._northEast=new r.LatLng(s.lat,s.lng)):(t.lat=Math.min(i.lat,t.lat),t.lng=Math.min(i.lng,t.lng),n.lat=Math.max(s.lat,n.lat),n.lng=Math.max(s.lng,n.lng)),this},pad:function(e){var t=this._southWest,n=this._northEast,i=Math.abs(t.lat-n.lat)*e,s=Math.abs(t.lng-n.lng)*e;return new r.LatLngBounds(new r.LatLng(t.lat-i,t.lng-s),new r.LatLng(n.lat+i,n.lng+s))},getCenter:function(){return new r.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new r.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new r.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){typeof e[0]=="number"||e instanceof r.LatLng?e=r.latLng(e):e=r.latLngBounds(e);var t=this._southWest,n=this._northEast,i,s;return e instanceof r.LatLngBounds?(i=e.getSouthWest(),s=e.getNorthEast()):i=s=e,i.lat>=t.lat&&s.lat<=n.lat&&i.lng>=t.lng&&s.lng<=n.lng},intersects:function(e){e=r.latLngBounds(e);var t=this._southWest,n=this._northEast,i=e.getSouthWest(),s=e.getNorthEast(),o=s.lat>=t.lat&&i.lat<=n.lat,u=s.lng>=t.lng&&i.lng<=n.lng;return o&&u},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e){return e?(e=r.latLngBounds(e),this._southWest.equals(e.getSouthWest())&&this._northEast.equals(e.getNorthEast())):!1},isValid:function(){return!!this._southWest&&!!this._northEast}},r.latLngBounds=function(e,t){return!e||e instanceof r.LatLngBounds?e:new r.LatLngBounds(e,t)},r.Projection={},r.Projection.LonLat={project:function(e){return new r.Point(e.lng,e.lat)},unproject:function(e){return new r.LatLng(e.y,e.x)},bounds:r.bounds([-180,-90],[180,90])},r.Projection.SphericalMercator={R:6378137,project:function(e){var t=Math.PI/180,n=1-1e-15,i=Math.max(Math.min(Math.sin(e.lat*t),n),-n);return new r.Point(this.R*e.lng*t,this.R*Math.log((1+i)/(1-i))/2)},unproject:function(e){var t=180/Math.PI;return new r.LatLng((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:function(){var e=6378137*Math.PI;return r.bounds([-e,-e],[e,e])}()},r.CRS={latLngToPoint:function(e,t){var n=this.projection.project(e),r=this.scale(t);return this.transformation._transform(n,r)},pointToLatLng:function(e,t){var n=this.scale(t),r=this.transformation.untransform(e,n);return this.projection.unproject(r)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,n=this.scale(e),i=this.transformation.transform(t.min,n),s=this.transformation.transform(t.max,n);return r.bounds(i,s)},wrapLatLng:function(e){var t=this.wrapLng?r.Util.wrapNum(e.lng,this.wrapLng,!0):e.lng,n=this.wrapLat?r.Util.wrapNum(e.lat,this.wrapLat,!0):e.lat;return r.latLng(n,t)}},r.CRS.Simple=r.extend({},r.CRS,{projection:r.Projection.LonLat,transformation:new r.Transformation(1,0,-1,0),scale:function(e){return Math.pow(2,e)},distance:function(e,t){var n=t.lng-e.lng,r=t.lat-e.lat;return Math.sqrt(n*n+r*r)},infinite:!0}),r.CRS.Earth=r.extend({},r.CRS,{wrapLng:[-180,180],R:6378137,distance:function(e,t){var n=Math.PI/180,r=e.lat*n,i=t.lat*n;return this.R*Math.acos(Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos((t.lng-e.lng)*n))}}),r.CRS.EPSG3857=r.extend({},r.CRS.Earth,{code:"EPSG:3857",projection:r.Projection.SphericalMercator,transformation:function(){var e=.5/(Math.PI*r.Projection.SphericalMercator.R);return new r.Transformation(e,.5,-e,.5)}()}),r.CRS.EPSG900913=r.extend({},r.CRS.EPSG3857,{code:"EPSG:900913"}),r.CRS.EPSG4326=r.extend({},r.CRS.Earth,{code:"EPSG:4326",projection:r.Projection.LonLat,transformation:new r.Transformation(1/180,1,-1/180,.5)}),r.Map=r.Evented.extend({options:{crs:r.CRS.EPSG3857,fadeAnimation:!0,trackResize:!0,markerZoomAnimation:!0},initialize:function(e,t){t=r.setOptions(this,t),this._initContainer(e),this._initLayout(),this._onResize=r.bind(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),t.center&&t.zoom!==n&&this.setView(r.latLng(t.center),t.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this.callInitHooks(),this._addLayers(this.options.layers)},setView:function(e,t){return t=t===n?this.getZoom():t,this._resetView(r.latLng(e),this._limitZoom(t)),this},setZoom:function(e,t){return this._loaded?this.setView(this.getCenter(),e,{zoom:t}):(this._zoom=this._limitZoom(e),this)},zoomIn:function(e,t){return this.setZoom(this._zoom+(e||1),t)},zoomOut:function(e,t){return this.setZoom(this._zoom-(e||1),t)},setZoomAround:function(e,t,n){var i=this.getZoomScale(t),s=this.getSize().divideBy(2),o=e instanceof r.Point?e:this.latLngToContainerPoint(e),u=o.subtract(s).multiplyBy(1-1/i),a=this.containerPointToLatLng(s.add(u));return this.setView(a,t,{zoom:n})},fitBounds:function(e,t){t=t||{},e=e.getBounds?e.getBounds():r.latLngBounds(e);var n=r.point(t.paddingTopLeft||t.padding||[0,0]),i=r.point(t.paddingBottomRight||t.padding||[0,0]),s=this.getBoundsZoom(e,!1,n.add(i));s=t.maxZoom?Math.min(t.maxZoom,s):s;var o=i.subtract(n).divideBy(2),u=this.project(e.getSouthWest(),s),a=this.project(e.getNorthEast(),s),f=this.unproject(u.add(a).divideBy(2).add(o),s);return this.setView(f,s,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e){return this.fire("movestart"),this._rawPanBy(r.point(e)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(e){return e=r.latLngBounds(e),this.options.maxBounds=e,e?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):this.off("moveend",this._panInsideMaxBounds)},panInsideBounds:function(e,t){var n=this.getCenter(),r=this._limitCenter(n,this._zoom,e);return n.equals(r)?this:this.panTo(r,t)},invalidateSize:function(e){if(!this._loaded)return this;e=r.extend({animate:!1,pan:!0},e===!0?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var n=this.getSize(),i=t.divideBy(2).round(),s=n.divideBy(2).round(),o=i.subtract(s);return!o.x&&!o.y?this:(e.animate&&e.pan?this.panBy(o):(e.pan&&this._rawPanBy(o),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(r.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:t,newSize:n}))},addHandler:function(e,t){if(!t)return this;var n=this[e]=new t(this);return this._handlers.push(n),this.options[e]&&n.enable(),this},remove:function(){this._initEvents("off");try{delete this._container._leaflet}catch(e){this._container._leaflet=n}return r.DomUtil.remove(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this._loaded&&this.fire("unload"),this},createPane:function(e,t){var n="leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),i=r.DomUtil.create("div",n,t||this._mapPane);return e&&(this._panes[e]=i),i},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds(),t=this.unproject(e.getBottomLeft()),n=this.unproject(e.getTopRight());return new r.LatLngBounds(t,n)},getMinZoom:function(){return this.options.minZoom===n?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===n?this._layersMaxZoom===n?Infinity:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,n){e=r.latLngBounds(e);var i=this.getMinZoom()-(t?1:0),s=this.getMaxZoom(),o=this.getSize(),u=e.getNorthWest(),a=e.getSouthEast(),f=!0,l;n=r.point(n||[0,0]);do i++,l=this.project(a,i).subtract(this.project(u,i)).add(n),f=t?l.x<o.x||l.y<o.y:o.contains(l);while(f&&i<=s);return f&&t?null:t?i:i-1},getSize:function(){if(!this._size||this._sizeChanged)this._size=new r.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1;return this._size.clone()},getPixelBounds:function(){var e=this._getTopLeftPoint();return new r.Bounds(e,e.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPixelWorldBounds:function(){return this.options.crs.getProjectedBounds(this.getZoom())},getPane:function(e){return typeof e=="string"?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e){var t=this.options.crs;return t.scale(e)/t.scale(this._zoom)},getScaleZoom:function(e){return this._zoom+Math.log(e)/Math.LN2},project:function(e,t){return t=t===n?this._zoom:t,this.options.crs.latLngToPoint(r.latLng(e),t)},unproject:function(e,t){return t=t===n?this._zoom:t,this.options.crs.pointToLatLng(r.point(e),t)},layerPointToLatLng:function(e){var t=r.point(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){var t=this.project(r.latLng(e))._round();return t._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(r.latLng(e))},distance:function(e,t){return this.options.crs.distance(r.latLng(e),r.latLng(t))},containerPointToLayerPoint:function(e){return r.point(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return r.point(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(r.point(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(r.latLng(e)))},mouseEventToContainerPoint:function(e){return r.DomEvent.getMousePosition(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=r.DomUtil.get(e);if(!t)throw new Error("Map container not found.");if(t._leaflet)throw new Error("Map container is already initialized.");t._leaflet=!0},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&r.Browser.any3d,r.DomUtil.addClass(e,"leaflet-container"+(r.Browser.touch?" leaflet-touch":"")+(r.Browser.retina?" leaflet-retina":"")+(r.Browser.ielt9?" leaflet-oldie":"")+(r.Browser.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var t=r.DomUtil.getStyle(e,"position");t!=="absolute"&&t!=="relative"&&t!=="fixed"&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._mapPane=this.createPane("mapPane",this._container),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(r.DomUtil.addClass(e.markerPane,"leaflet-zoom-hide"),r.DomUtil.addClass(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,t,n,i){var s=this._zoom!==t;i||(this.fire("movestart"),s&&this.fire("zoomstart")),this._zoom=t,this._initialCenter=e,this._initialTopLeftPoint=this._getNewTopLeftPoint(e),n?this._initialTopLeftPoint._add(this._getMapPanePos()):r.DomUtil.setPosition(this._mapPane,new r.Point(0,0));var o=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!n}),o&&this.fire("load"),this.fire("move"),(s||i)&&this.fire("zoomend"),this.fire("moveend",{hard:!n})},_rawPanBy:function(e){r.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){if(!r.DomEvent)return;t=t||"on",r.DomEvent[t](this._container,"click dblclick mousedown mouseup mouseenter mouseleave mousemove contextmenu",this._handleMouseEvent,this),this.options.trackResize&&r.DomEvent[t](e,"resize",this._onResize,this)},_onResize:function(){r.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=r.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_handleMouseEvent:function(e){if(!this._loaded)return;this._fireMouseEvent(this,e,e.type==="mouseenter"?"mouseover":e.type==="mouseleave"?"mouseout":e.type)},_fireMouseEvent:function(e,t,n,i,s){n=n||t.type;if(r.DomEvent._skipped(t))return;if(n==="click"){if(!t._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved()))return;e.fire("preclick")}if(!e.listens(n,i))return;n==="contextmenu"&&r.DomEvent.preventDefault(t),(n==="click"||n==="dblclick"||n==="contextmenu")&&r.DomEvent.stopPropagation(t);var o={originalEvent:t,containerPoint:this.mouseEventToContainerPoint(t)};o.layerPoint=this.containerPointToLayerPoint(o.containerPoint),o.latlng=s||this.layerPointToLatLng(o.layerPoint),e.fire(n,o,i)},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){return this._loaded?e.call(t||this,{target:this}):this.on("load",e,t),this},_getMapPanePos:function(){return r.DomUtil.getPosition(this._mapPane)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(e,t){var n=this.getSize()._divideBy(2);return this.project(e,t)._subtract(n)._round()},_latLngToNewLayerPoint:function(e,t,n){var r=this._getNewTopLeftPoint(n,t).add(this._getMapPanePos());return this.project(e,t)._subtract(r)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,n){if(!n)return e;var i=this.project(e,t),s=this.getSize().divideBy(2),o=new r.Bounds(i.subtract(s),i.add(s)),u=this._getBoundsOffset(o,n,t);return this.unproject(i.add(u),t)},_limitOffset:function(e,t){if(!t)return e;var n=this.getPixelBounds(),i=new r.Bounds(n.min.add(e),n.max.add(e));return e.add(this._getBoundsOffset(i,t))},_getBoundsOffset:function(e,t,n){var i=this.project(t.getNorthWest(),n).subtract(e.min),s=this.project(t.getSouthEast(),n).subtract(e.max),o=this._rebound(i.x,-s.x),u=this._rebound(i.y,-s.y);return new r.Point(o,u)},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),n=this.getMaxZoom();return Math.max(t,Math.min(n,e))}}),r.map=function(e,t){return new r.Map(e,t)},r.Layer=r.Evented.extend({options:{pane:"overlayPane"},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},_layerAdd:function(e){var t=e.target;if(!t.hasLayer(this))return;this._map=t,this._zoomAnimated=t._zoomAnimated,this.onAdd(t),this.getAttribution&&this._map.attributionControl&&this._map.attributionControl.addAttribution(this.getAttribution()),this.getEvents&&t.on(this.getEvents(),this),this.fire("add"),t.fire("layeradd",{layer:this})}}),r.Map.include({addLayer:function(e){var t=r.stamp(e);return this._layers[t]?e:(this._layers[t]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e),this)},removeLayer:function(e){var t=r.stamp(e);return this._layers[t]?(this._loaded&&e.onRemove(this),e.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(e.getAttribution()),e.getEvents&&this.off(e.getEvents(),e),delete this._layers[t],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return!!e&&r.stamp(e)in this._layers},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},_addLayers:function(e){e=e?r.Util.isArray(e)?e:[e]:[];for(var t=0,n=e.length;t<n;t++)this.addLayer(e[t])},_addZoomLimit:function(e){if(isNaN(e.options.maxZoom)||!isNaN(e.options.minZoom))this._zoomBoundLayers[r.stamp(e)]=e,this._updateZoomLevels()},_removeZoomLimit:function(e){var t=r.stamp(e);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var e=Infinity,t=-Infinity,r=this._getZoomSpan();for(var i in this._zoomBoundLayers){var s=this._zoomBoundLayers[i].options;e=s.minZoom===n?e:Math.min(e,s.minZoom),t=s.maxZoom===n?t:Math.max(t,s.maxZoom)}this._layersMaxZoom=t===-Infinity?n:t,this._layersMinZoom=e===Infinity?n:e,r!==this._getZoomSpan()&&this.fire("zoomlevelschange")}}),r.Projection.Mercator={R:6378137,R_MINOR:6356752.314245179,bounds:r.bounds([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(e){var t=Math.PI/180,n=this.R,i=e.lat*t,s=this.R_MINOR/n,o=Math.sqrt(1-s*s),u=o*Math.sin(i),a=Math.tan(Math.PI/4-i/2)/Math.pow((1-u)/(1+u),o/2);return i=-n*Math.log(Math.max(a,1e-10)),new r.Point(e.lng*t*n,i)},unproject:function(e){var t=180/Math.PI,n=this.R,i=this.R_MINOR/n,s=Math.sqrt(1-i*i),o=Math.exp(-e.y/n),u=Math.PI/2-2*Math.atan(o);for(var a=0,f=.1,l;a<15&&Math.abs(f)>1e-7;a++)l=s*Math.sin(u),l=Math.pow((1-l)/(1+l),s/2),f=Math.PI/2-2*Math.atan(o*l)-u,u+=f;return new r.LatLng(u*t,e.x*t/n)}},r.CRS.EPSG3395=r.extend({},r.CRS.Earth,{code:"EPSG:3395",projection:r.Projection.Mercator,transformation:function(){var e=.5/(Math.PI*r.Projection.Mercator.R);return new r.Transformation(e,.5,-e,.5)}()}),r.GridLayer=r.Layer.extend({options:{pane:"tilePane",tileSize:256,opacity:1,unloadInvisibleTiles:r.Browser.mobile,updateWhenIdle:r.Browser.mobile,updateInterval:150},initialize:function(e){e=r.setOptions(this,e)},onAdd:function(){this._initContainer(),this.options.updateWhenIdle||(this._update=r.Util.throttle(this._update,this.options.updateInterval,this)),this._reset(),this._update()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._clearBgBuffer(),r.DomUtil.remove(this._container),e._removeZoomLimit(this),this._container=null},bringToFront:function(){return this._map&&(r.DomUtil.toFront(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(r.DomUtil.toBack(this._container),this._setAutoZIndex(Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},getEvents:function(){var e={viewreset:this._reset,moveend:this._update};return this.options.updateWhenIdle||(e.move=this._update),this._zoomAnimated&&(e.zoomstart=this._startZoomAnim,e.zoomanim=this._animateZoom,e.zoomend=this._endZoomAnim),e},_updateZIndex:function(){this._container&&this.options.zIndex!==n&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){var t=this.getPane().children,n=-e(-Infinity,Infinity);for(var r=0,i=t.length,s;r<i;r++)s=t[r].style.zIndex,t[r]!==this._container&&s&&(n=e(n,+s));isFinite(n)&&(this.options.zIndex=n+e(-1,1),this._updateZIndex())},_updateOpacity:function(){var e=this.options.opacity;if(r.Browser.ielt9)for(var t in this._tiles)r.DomUtil.setOpacity(this._tiles[t],e);else r.DomUtil.setOpacity(this._container,e)},_initContainer:function(){if(this._container)return;this._container=r.DomUtil.create("div","leaflet-layer"),this._updateZIndex();if(this._zoomAnimated){var e="leaflet-tile-container leaflet-zoom-animated";this._bgBuffer=r.DomUtil.create("div",e,this._container),this._tileContainer=r.DomUtil.create("div",e,this._container),r.DomUtil.setTransform(this._tileContainer)}else this._tileContainer=this._container;this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container)},_reset:function(e){for(var t in this._tiles)this.fire("tileunload",{tile:this._tiles[t]});this._tiles={},this._tilesToLoad=0,this._tilesTotal=0,this._tileContainer.innerHTML="",this._zoomAnimated&&e&&e.hard&&this._clearBgBuffer(),this._tileNumBounds=this._getTileNumBounds(),this._resetWrap()},_resetWrap:function(){var e=this._map,t=e.options.crs;if(t.infinite)return;var n=this._getTileSize();t.wrapLng&&(this._wrapLng=[Math.floor(e.project([0,t.wrapLng[0]]).x/n),Math.ceil(e.project([0,t.wrapLng[1]]).x/n)]),t.wrapLat&&(this._wrapLat=[Math.floor(e.project([t.wrapLat[0],0]).y/n),Math.ceil(e.project([t.wrapLat[1],0]).y/n)])},_getTileSize:function(){return this.options.tileSize},_update:function(){if(!this._map)return;var e=this._map.getPixelBounds(),t=this._map.getZoom(),n=this._getTileSize();if(t>this.options.maxZoom||t<this.options.minZoom)return;var i=r.bounds(e.min.divideBy(n).floor(),e.max.divideBy(n).floor());this._addTiles(i),this.options.unloadInvisibleTiles&&this._removeOtherTiles(i)},_addTiles:function(e){var n=[],i=e.getCenter(),s=this._map.getZoom(),o,u,a;for(o=e.min.y;o<=e.max.y;o++)for(u=e.min.x;u<=e.max.x;u++)a=new r.Point(u,o),a.z=s,!(this._tileCoordsToKey(a)in this._tiles)&&this._isValidTile(a)&&n.push(a);var f=n.length;if(f===0)return;this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=f,this._tilesTotal+=f,n.sort(function(e,t){return e.distanceTo(i)-t.distanceTo(i)});var l=t.createDocumentFragment();for(u=0;u<f;u++)this._addTile(n[u],l);this._tileContainer.appendChild(l)},_isValidTile:function(e){var t=this._map.options.crs;if(!t.infinite){var n=this._tileNumBounds;if(!t.wrapLng&&(e.x<n.min.x||e.x>n.max.x)||!t.wrapLat&&(e.y<n.min.y||e.y>n.max.y))return!1}if(!this.options.bounds)return!0;var i=this._tileCoordsToBounds(e);return r.latLngBounds(this.options.bounds).intersects(i)},_tileCoordsToBounds:function(e){var t=this._map,n=this.options.tileSize,i=e.multiplyBy(n),s=i.add([n,n]),o=t.wrapLatLng(t.unproject(i,e.z)),u=t.wrapLatLng(t.unproject(s,e.z));return new r.LatLngBounds(o,u)},_tileCoordsToKey:function(e){return e.x+":"+e.y},_keyToTileCoords:function(e){var t=e.split(":"),n=parseInt(t[0],10),i=parseInt(t[1],10);return new r.Point(n,i)},_removeOtherTiles:function(e){for(var t in this._tiles)e.contains(this._keyToTileCoords(t))||this._removeTile(t)},_removeTile:function(e){var t=this._tiles[e];r.DomUtil.remove(t),delete this._tiles[e],this.fire("tileunload",{tile:t})},_initTile:function(e){var t=this._getTileSize();r.DomUtil.addClass(e,"leaflet-tile"),e.style.width=t+"px",e.style.height=t+"px",e.onselectstart=r.Util.falseFn,e.onmousemove=r.Util.falseFn,r.Browser.ielt9&&this.options.opacity<1&&r.DomUtil.setOpacity(e,this.options.opacity),r.Browser.android&&!r.Browser.android23&&(e.style.WebkitBackfaceVisibility="hidden")},_addTile:function(e,t){var n=this._getTilePos(e);this._wrapCoords(e);var i=this.createTile(e,r.bind(this._tileReady,this));this._initTile(i),this.createTile.length<2&&setTimeout(r.bind(this._tileReady,this,null,i),0),r.DomUtil.setPosition(i,n,!0),this._tiles[this._tileCoordsToKey(e)]=i,t.appendChild(i),this.fire("tileloadstart",{tile:i})},_tileReady:function(e,t){e&&this.fire("tileerror",{error:e,tile:t}),r.DomUtil.addClass(t,"leaflet-tile-loaded"),this.fire("tileload",{tile:t}),this._tilesToLoad--,this._tilesToLoad===0&&this._visibleTilesReady()},_visibleTilesReady:function(){this.fire("load"),this._zoomAnimated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(r.bind(this._clearBgBuffer,this),300))},_getTilePos:function(e){return e.multiplyBy(this._getTileSize()).subtract(this._map.getPixelOrigin())},_wrapCoords:function(e){e.x=this._wrapLng?r.Util.wrapNum(e.x,this._wrapLng):e.x,e.y=this._wrapLat?r.Util.wrapNum(e.y,this._wrapLat):e.y},_getTileNumBounds:function(){var e=this._map.getPixelWorldBounds(),t=this._getTileSize();return e?r.bounds(e.min.divideBy(t).floor(),e.max.divideBy(t).ceil().subtract([1,1])):null},_startZoomAnim:function(){this._prepareBgBuffer(),this._prevTranslate=this._translate||new r.Point(0,0),this._prevScale=this._scale},_animateZoom:function(e){this._translate=this._prevTranslate.multiplyBy(e.scale).add(e.origin.multiplyBy(1-e.scale)),this._scale=this._prevScale*e.scale,r.DomUtil.setTransform(this._bgBuffer,this._translate,this._scale)},_endZoomAnim:function(){var e=this._tileContainer;e.style.visibility="",r.DomUtil.toFront(e)},_clearBgBuffer:function(){var e=this._map,t=this._bgBuffer;e&&!e._animatingZoom&&!e.touchZoom._zooming&&t&&(t.innerHTML="",r.DomUtil.setTransform(t))},_prepareBgBuffer:function(){var e=this._tileContainer,t=this._bgBuffer;this._abortLoading&&this._abortLoading();if(this._tilesToLoad/this._tilesTotal>.5){e.style.visibility="hidden";return}t.style.visibility="hidden",r.DomUtil.setTransform(t),this._tileContainer=t,this._bgBuffer=e,this._translate=new r.Point(0,0),this._scale=1,clearTimeout(this._clearBgBufferTimer)}}),r.gridLayer=function(e){return new r.GridLayer(e)},r.TileLayer=r.GridLayer.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",zoomOffset:0},initialize:function(e,t){this._url=e,t=r.setOptions(this,t),t.detectRetina&&r.Browser.retina&&t.maxZoom>0&&(t.tileSize=Math.floor(t.tileSize/2),t.zoomOffset++,t.minZoom=Math.max(0,t.minZoom),t.maxZoom--),typeof t.subdomains=="string"&&(t.subdomains=t.subdomains.split(""))},setUrl:function(e,t){return this._url=e,t||this.redraw(),this},createTile:function(e,n){var i=t.createElement("img");return i.onload=r.bind(this._tileOnLoad,this,n,i),i.onerror=r.bind(this._tileOnError,this,n,i),i.alt="",i.src=this.getTileUrl(e),i},getTileUrl:function(e){return r.Util.template(this._url,r.extend({r:this.options.detectRetina&&r.Browser.retina&&this.options.maxZoom>0?"@2x":"",s:this._getSubdomain(e),x:e.x,y:this.options.tms?this._tileNumBounds.max.y-e.y:e.y,z:this._getZoomForUrl()},this.options))},_tileOnLoad:function(e,t){e(null,t)},_tileOnError:function(e,t,n){var r=this.options.errorTileUrl;r&&(t.src=r),e(n,t)},_getTileSize:function(){var e=this._map,t=this.options,n=e.getZoom()+t.zoomOffset,r=t.maxNativeZoom;return r&&n>r?Math.round(e.getZoomScale(n)/e.getZoomScale(r)*t.tileSize):t.tileSize},_removeTile:function(e){var t=this._tiles[e];r.GridLayer.prototype._removeTile.call(this,e),r.Browser.android||(t.onload=null,t.src=r.Util.emptyImageUrl)},_getZoomForUrl:function(){var e=this.options,t=this._map.getZoom();return e.zoomReverse&&(t=e.maxZoom-t),t+=e.zoomOffset,e.maxNativeZoom?Math.min(t,e.maxNativeZoom):t},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var e,t;for(e in this._tiles)t=this._tiles[e],t.complete||(t.onload=r.Util.falseFn,t.onerror=r.Util.falseFn,t.src=r.Util.emptyImageUrl,r.DomUtil.remove(t))}}),r.tileLayer=function(e,t){return new r.TileLayer(e,t)},r.TileLayer.WMS=r.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(e,t){this._url=e;var n=r.extend({},this.defaultWmsParams);for(var i in t)!this.options.hasOwnProperty(i)&&i!=="crs"&&(n[i]=t[i]);t=r.setOptions(this,t),n.width=n.height=t.tileSize*(t.detectRetina&&r.Browser.retina?2:1),this.wmsParams=n},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,r.TileLayer.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._tileCoordsToBounds(e),n=this._crs.project(t.getNorthWest()),i=this._crs.project(t.getSouthEast()),s=(this._wmsVersion>=1.3&&this._crs===r.CRS.EPSG4326?[i.y,n.x,n.y,i.x]:[n.x,i.y,i.x,n.y]).join(","),o=r.Util.template(this._url,{s:this._getSubdomain(e)});return o+r.Util.getParamString(this.wmsParams,o,!0)+"&BBOX="+s},setParams:function(e,t){return r.extend(this.wmsParams,e),t||this.redraw(),this}}),r.tileLayer.wms=function(e,t){return new r.TileLayer.WMS(e,t)},r.ImageOverlay=r.Layer.extend({options:{opacity:1},initialize:function(e,t,n){this._url=e,this._bounds=r.latLngBounds(t),r.setOptions(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){r.DomUtil.remove(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},bringToFront:function(){return this._map&&r.DomUtil.toFront(this._image),this},bringToBack:function(){return this._map&&r.DomUtil.toBack(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},getAttribution:function(){return this.options.attribution},getEvents:function(){var e={viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},_initImage:function(){var e=this._image=r.DomUtil.create("img","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));e.onselectstart=r.Util.falseFn,e.onmousemove=r.Util.falseFn,e.onload=r.bind(this.fire,this,"load"),e.src=this._url},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._bounds.getNorthWest(),e.zoom,e.center),n=this._map._latLngToNewLayerPoint(this._bounds.getSouthEast(),e.zoom,e.center).subtract(t),i=t.add(n._multiplyBy((1-1/e.scale)/2));r.DomUtil.setTransform(this._image,i,e.scale)},_reset:function(){var e=this._image,t=new r.Bounds(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=t.getSize();r.DomUtil.setPosition(e,t.min),e.style.width=n.x+"px",e.style.height=n.y+"px"},_updateOpacity:function(){r.DomUtil.setOpacity(this._image,this.options.opacity)}}),r.imageOverlay=function(e,t,n){return new r.ImageOverlay(e,t,n)},r.Icon=r.Class.extend({initialize:function(e){r.setOptions(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var n=this._getIconUrl(e);if(!n){if(e==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var r=this._createImg(n,t&&t.tagName==="IMG"?t:null);return this._setIconStyles(r,e),r},_setIconStyles:function(e,t){var n=this.options,i=r.point(n[t+"Size"]),s=r.point(t==="shadow"&&n.shadowAnchor||n.iconAnchor||i&&i.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+(n.className||""),s&&(e.style.marginLeft=-s.x+"px",e.style.marginTop=-s.y+"px"),i&&(e.style.width=i.x+"px",e.style.height=i.y+"px")},_createImg:function(e,n){return n=n||t.createElement("img"),n.src=e,n},_getIconUrl:function(e){return r.Browser.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}}),r.icon=function(e){return new r.Icon(e)},r.Icon.Default=r.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(e){var t=e+"Url";if(this.options[t])return this.options[t];var n=r.Icon.Default.imagePath;if(!n)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return n+"/marker-"+e+(r.Browser.retina&&e==="icon"?"-2x":"")+".png"}}),r.Icon.Default.imagePath=function(){var e=t.getElementsByTagName("script"),n=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/,r,i,s,o;for(r=0,i=e.length;r<i;r++){s=e[r].src;if(s.match(n))return o=s.split(n)[0],(o?o+"/":"")+"images"}}(),r.Marker=r.Layer.extend({options:{pane:"markerPane",icon:new r.Icon.Default,clickable:!0,keyboard:!0,zIndexOffset:0,opacity:1,riseOffset:250},initialize:function(e,t){r.setOptions(this,t),this._latlng=r.latLng(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._initIcon(),this.update()},onRemove:function(){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow()},getEvents:function(){var e={viewreset:this.update};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=r.latLng(e),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){if(this._icon){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=e.icon.createIcon(this._icon),i=!1;n!==this._icon&&(this._icon&&this._removeIcon(),i=!0,e.title&&(n.title=e.title),e.alt&&(n.alt=e.alt)),r.DomUtil.addClass(n,t),e.keyboard&&(n.tabIndex="0"),this._icon=n,this._initInteraction(),e.riseOnHover&&r.DomEvent.on(n,{mouseover:this._bringToFront,mouseout:this._resetZIndex},this);var s=e.icon.createShadow(this._shadow),o=!1;s!==this._shadow&&(this._removeShadow(),o=!0),s&&r.DomUtil.addClass(s,t),this._shadow=s,e.opacity<1&&this._updateOpacity(),i&&this.getPane().appendChild(this._icon),s&&o&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&r.DomEvent.off(this._icon,{mouseover:this._bringToFront,mouseout:this._resetZIndex},this),r.DomUtil.remove(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&r.DomUtil.remove(this._shadow),this._shadow=null},_setPos:function(e){r.DomUtil.setPosition(this._icon,e),this._shadow&&r.DomUtil.setPosition(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon.style.zIndex=this._zIndex+e},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(!this.options.clickable)return;r.DomUtil.addClass(this._icon,"leaflet-clickable"),r.DomEvent.on(this._icon,"click dblclick mousedown mouseup mouseover mouseout contextmenu keypress",this._fireMouseEvent,this),r.Handler.MarkerDrag&&(this.dragging=new r.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())},_fireMouseEvent:function(e,t){e.type==="mousedown"&&r.DomEvent.preventDefault(e);if(e.type==="click"&&this.dragging&&this.dragging.moved())return;e.type==="keypress"&&e.keyCode===13&&(t="click"),this._map&&this._map._fireMouseEvent(this,e,t,!0,this._latlng)},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;r.DomUtil.setOpacity(this._icon,e),this._shadow&&r.DomUtil.setOpacity(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),r.marker=function(e,t){return new r.Marker(e,t)},r.DivIcon=r.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(e){var n=e&&e.tagName==="DIV"?e:t.createElement("div"),r=this.options;return n.innerHTML=r.html!==!1?r.html:"",r.bgPos&&(n.style.backgroundPosition=-r.bgPos.x+"px "+ -r.bgPos.y+"px"),this._setIconStyles(n,"icon"),n},createShadow:function(){return null}}),r.divIcon=function(e){return new r.DivIcon(e)},r.Map.mergeOptions({closePopupOnClick:!0}),r.Popup=r.Layer.extend({options:{pane:"popupPane",minWidth:50,maxWidth:300,offset:[0,7],autoPan:!0,autoPanPadding:[5,5],closeButton:!0,zoomAnimation:!0},initialize:function(e,t){r.setOptions(this,e),this._source=t},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&this.options.zoomAnimation,this._container||this._initLayout(),e._fadeAnimated&&r.DomUtil.setOpacity(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&r.DomUtil.setOpacity(this._container,1),e.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this},!0)},openOn:function(e){return e.openPopup(this),this},onRemove:function(e){e._fadeAnimated?(r.DomUtil.setOpacity(this._container,0),this._removeTimeout=setTimeout(r.bind(r.DomUtil.remove,r.DomUtil,this._container),200)):r.DomUtil.remove(this._container),e.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this},!0)},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=r.latLng(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},update:function(){if(!this._map)return;this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan()},getEvents:function(){var e={viewreset:this._updatePosition},t=this.options;this._zoomAnimated&&(e.zoomanim=this._animateZoom);if("closeOnClick"in t?t.closeOnClick:this._map.options.closePopupOnClick)e.preclick=this._close;return t.keepInView&&(e.moveend=this._adjustPan),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var e="leaflet-popup",t=this._container=r.DomUtil.create("div",e+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"));if(this.options.closeButton){var n=this._closeButton=r.DomUtil.create("a",e+"-close-button",t);n.href="#close",n.innerHTML="&#215;",r.DomEvent.on(n,"click",this._onCloseButtonClick,this)}var i=this._wrapper=r.DomUtil.create("div",e+"-content-wrapper",t);this._contentNode=r.DomUtil.create("div",e+"-content",i),r.DomEvent.disableClickPropagation(i).disableScrollPropagation(this._contentNode).on(i,"contextmenu",r.DomEvent.stopPropagation),this._tipContainer=r.DomUtil.create("div",e+"-tip-container",t),this._tip=r.DomUtil.create("div",e+"-tip",this._tipContainer)},_updateContent:function(){if(!this._content)return;var e=this._contentNode;if(typeof this._content=="string")e.innerHTML=this._content;else{while(e.hasChildNodes())e.removeChild(e.firstChild);e.appendChild(this._content)}this.fire("contentupdate")},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="",t.whiteSpace="nowrap";var n=e.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),t.width=n+1+"px",t.whiteSpace="",t.height="";var i=e.offsetHeight,s=this.options.maxHeight,o="leaflet-popup-scrolled";s&&i>s?(t.height=s+"px",r.DomUtil.addClass(e,o)):r.DomUtil.removeClass(e,o),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(!this._map)return;var e=this._map.latLngToLayerPoint(this._latlng),t=r.point(this.options.offset);this._zoomAnimated?r.DomUtil.setPosition(this._container,e):t=t.add(e);var n=this._containerBottom=-t.y,i=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=n+"px",this._container.style.left=i+"px"},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);r.DomUtil.setPosition(this._container,t)},_adjustPan:function(){if(!this.options.autoPan)return;var e=this._map,t=this._container.offsetHeight,n=this._containerWidth,i=new r.Point(this._containerLeft,-t-this._containerBottom);this._zoomAnimated&&i._add(r.DomUtil.getPosition(this._container));var s=e.layerPointToContainerPoint(i),o=r.point(this.options.autoPanPadding),u=r.point(this.options.autoPanPaddingTopLeft||o),a=r.point(this.options.autoPanPaddingBottomRight||o),f=e.getSize(),l=0,c=0;s.x+n+a.x>f.x&&(l=s.x+n-f.x+a.x),s.x-l-u.x<0&&(l=s.x-u.x),s.y+t+a.y>f.y&&(c=s.y+t-f.y+a.y),s.y-c-u.y<0&&(c=s.y-u.y),(l||c)&&e.fire("autopanstart").panBy([l,c])},_onCloseButtonClick:function(e){this._close(),r.DomEvent.stop(e)}}),r.popup=function(e,t){return new r.Popup(e,t)},r.Map.include({openPopup:function(e,t,n){if(!(e instanceof r.Popup)){var i=e;e=(new r.Popup(n)).setContent(i)}return t&&e.setLatLng(t),this.hasLayer(e)?this:(this.closePopup(),this._popup=e,this.addLayer(e))},closePopup:function(e){if(!e||e===this._popup)e=this._popup,this._popup=null;return e&&this.removeLayer(e),this}}),r.Layer.include({bindPopup:function(e,t){if(e instanceof r.Popup)this._popup=e,e._source=this;else{if(!this._popup||t)this._popup=new r.Popup(t,this);this._popup.setContent(e)}return this._popupHandlersAdded||(this.on({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.on({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&this._map&&this._map.openPopup(this._popup,e||this._latlng||this.getCenter()),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._map?this.closePopup():this.openPopup()),this},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){this._map.openPopup(this._popup,e.latlng)},_movePopup:function(e){this._popup.setLatLng(e.latlng)}}),r.Marker.include({bindPopup:function(e,t){var n=r.point(this.options.icon.options.popupAnchor||[0,0]).add(r.Popup.prototype.options.offset);return t=r.extend({offset:n},t),r.Layer.prototype.bindPopup.call(this,e,t)},_openPopup:r.Layer.prototype.togglePopup}),r.LayerGroup=r.Layer.extend({initialize:function(e){this._layers={};var t,n;if(e)for(t=0,n=e.length;t<n;t++)this.addLayer(e[t])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){return!!e&&(e in this._layers||this.getLayerId(e)in this._layers)},clearLayers:function(){for(var e in this._layers)this.removeLayer(this._layers[e]);return this},invoke:function(e){var t=Array.prototype.slice.call(arguments,1),n,r;for(n in this._layers)r=this._layers[n],r[e]&&r[e].apply(r,t);return this},onAdd:function(e){for(var t in this._layers)e.addLayer(this._layers[t])},onRemove:function(e){for(var t in this._layers)e.removeLayer(this._layers[t])},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];for(var t in this._layers)e.push(this._layers[t]);return e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return r.stamp(e)}}),r.layerGroup=function(e){return new r.LayerGroup(e)},r.FeatureGroup=r.LayerGroup.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),r.LayerGroup.prototype.addLayer.call(this,e),this._popupContent&&e.bindPopup&&e.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),r.LayerGroup.prototype.removeLayer.call(this,e),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:e})):this},bindPopup:function(e,t){return this._popupContent=e,this._popupOptions=t,this.invoke("bindPopup",e,t)},openPopup:function(e){for(var t in this._layers){this._layers[t].openPopup(e);break}return this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new r.LatLngBounds;return this.eachLayer(function(t){e.extend(t.getBounds?t.getBounds():t.getLatLng())}),e}}),r.featureGroup=function(e){return new r.FeatureGroup(e)},r.Renderer=r.Layer.extend({options:{padding:0},initialize:function(e){r.setOptions(this,e),r.stamp(this)},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&r.DomUtil.addClass(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update()},onRemove:function(){r.DomUtil.remove(this._container)},getEvents:function(){var e={moveend:this._update};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},_animateZoom:function(e){var t=e.origin.subtract(this._map._getCenterLayerPoint()),n=this._bounds.min.add(t.multiplyBy(1-e.scale));r.DomUtil.setTransform(this._container,n,e.scale)},_update:function(){var e=this.options.padding,t=this._map.getSize(),n=this._map.containerPointToLayerPoint(t.multiplyBy(-e)).round();this._bounds=new r.Bounds(n,n.add(t.multiplyBy(1+e*2)).round())}}),r.Map.include({getRenderer:function(e){var t=e.options.renderer||this.options.renderer||this._renderer;return t||(t=this._renderer=r.SVG&&r.svg()||r.Canvas&&r.canvas()),this.hasLayer(t)||this.addLayer(t),t}}),r.Path=r.Layer.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",fillOpacity:.2,clickable:!0},onAdd:function(){this._renderer=this._map.getRenderer(this),this._renderer._initPath(this),this._project(),this._update(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},getEvents:function(){return{viewreset:this._project,moveend:this._update}},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return r.setOptions(this,e),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer._bringToBack(this),this},_fireMouseEvent:function(e,t){this._map._fireMouseEvent(this,e,t,!0)},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(r.Browser.touch?10:0)}}),r.LineUtil={simplify:function(e,t){if(!t||!e.length)return e.slice();var n=t*t;return e=this._reducePoints(e,n),e=this._simplifyDP(e,n),e},pointToSegmentDistance:function(e,t,n){return Math.sqrt(this._sqClosestPointOnSegment(e,t,n,!0))},closestPointOnSegment:function(e,t,n){return this._sqClosestPointOnSegment(e,t,n)},_simplifyDP:function(e,t){var r=e.length,i=typeof Uint8Array!=n+""?Uint8Array:Array,s=new i(r);s[0]=s[r-1]=1,this._simplifyDPStep(e,s,t,0,r-1);var o,u=[];for(o=0;o<r;o++)s[o]&&u.push(e[o]);return u},_simplifyDPStep:function(e,t,n,r,i){var s=0,o,u,a;for(u=r+1;u<=i-1;u++)a=this._sqClosestPointOnSegment(e[u],e[r],e[i],!0),a>s&&(o=u,s=a);s>n&&(t[o]=1,this._simplifyDPStep(e,t,n,r,o),this._simplifyDPStep(e,t,n,o,i))},_reducePoints:function(e,t){var n=[e[0]];for(var r=1,i=0,s=e.length;r<s;r++)this._sqDist(e[r],e[i])>t&&(n.push(e[r]),i=r);return i<s-1&&n.push(e[s-1]),n},clipSegment:function(e,t,n,r){var i=r?this._lastCode:this._getBitCode(e,n),s=this._getBitCode(t,n),o,u,a;this._lastCode=s;for(;;){if(!(i|s))return[e,t];if(i&s)return!1;o=i||s,u=this._getEdgeIntersection(e,t,o,n),a=this._getBitCode(u,n),o===i?(e=u,i=a):(t=u,s=a)}},_getEdgeIntersection:function(e,t,n,i){var s=t.x-e.x,o=t.y-e.y,u=i.min,a=i.max,f,l;return n&8?(f=e.x+s*(a.y-e.y)/o,l=a.y):n&4?(f=e.x+s*(u.y-e.y)/o,l=u.y):n&2?(f=a.x,l=e.y+o*(a.x-e.x)/s):n&1&&(f=u.x,l=e.y+o*(u.x-e.x)/s),new r.Point(f,l,!0)},_getBitCode:function(e,t){var n=0;return e.x<t.min.x?n|=1:e.x>t.max.x&&(n|=2),e.y<t.min.y?n|=4:e.y>t.max.y&&(n|=8),n},_sqDist:function(e,t){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r},_sqClosestPointOnSegment:function(e,t,n,i){var s=t.x,o=t.y,u=n.x-s,a=n.y-o,f=u*u+a*a,l;return f>0&&(l=((e.x-s)*u+(e.y-o)*a)/f,l>1?(s=n.x,o=n.y):l>0&&(s+=u*l,o+=a*l)),u=e.x-s,a=e.y-o,i?u*u+a*a:new r.Point(s,o)}},r.Polyline=r.Path.extend({options:{smoothFactor:1},initialize:function(e,t){r.setOptions(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},addLatLng:function(e){return e=r.latLng(e),this._latlngs.push(e),this._bounds.extend(e),this.redraw()},spliceLatLngs:function(){var e=[].splice.apply(this._latlngs,arguments);return this._setLatLngs(this._latlngs),this.redraw(),e},closestLayerPoint:function(e){var t=Infinity,n=null,i=r.LineUtil._sqClosestPointOnSegment,s,o;for(var u=0,a=this._parts.length;u<a;u++){var f=this._parts[u];for(var l=1,c=f.length;l<c;l++){s=f[l-1],o=f[l];var h=i(e,s,o,!0);h<t&&(t=h,n=i(e,s,o))}}return n&&(n.distance=Math.sqrt(t)),n},getCenter:function(){var e,t,n,r,i,s,o,u=this._rings[0],a=u.length;for(e=0,t=0;e<a-1;e++)t+=u[e].distanceTo(u[e+1])/2;for(e=0,r=0;e<a-1;e++){i=u[e],s=u[e+1],n=i.distanceTo(s),r+=n;if(r>t)return o=(r-t)/n,this._map.layerPointToLatLng([s.x-o*(s.x-i.x),s.y-o*(s.y-i.y)])}},getBounds:function(){return this._bounds},_setLatLngs:function(e){this._bounds=new r.LatLngBounds,this._latlngs=this._convertLatLngs(e)},_convertLatLngs:function(e){var t=[],n=this._flat(e);for(var i=0,s=e.length;i<s;i++)n?(t[i]=r.latLng(e[i]),this._bounds.extend(t[i])):t[i]=this._convertLatLngs(e[i]);return t},_flat:function(e){return!r.Util.isArray(e[0])||typeof e[0][0]!="object"},_project:function(){this._rings=[],this._projectLatlngs(this._latlngs,this._rings);var e=this._clickTolerance(),t=new r.Point(e,-e);this._latlngs.length&&(this._pxBounds=new r.Bounds(this._map.latLngToLayerPoint(this._bounds.getSouthWest())._subtract(t),this._map.latLngToLayerPoint(this._bounds.getNorthEast())._add(t)))},_projectLatlngs:function(e,t){var n=e[0]instanceof r.LatLng,i=e.length,s,o;if(n){o=[];for(s=0;s<i;s++)o[s]=this._map.latLngToLayerPoint(e[s]);t.push(o)}else for(s=0;s<i;s++)this._projectLatlngs(e[s],t)},_clipPoints:function(){if(this.options.noClip){this._parts=this._rings;return}this._parts=[];var e=this._parts,t=this._renderer._bounds,n,i,s,o,u,a,f;for(n=0,s=0,o=this._rings.length;n<o;n++){f=this._rings[n];for(i=0,u=f.length;i<u-1;i++){a=r.LineUtil.clipSegment(f[i],f[i+1],t,i);if(!a)continue;e[s]=e[s]||[],e[s].push(a[0]);if(a[1]!==f[i+1]||i===u-2)e[s].push(a[1]),s++}}},_simplifyPoints:function(){var e=this._parts,t=this.options.smoothFactor;for(var n=0,i=e.length;n<i;n++)e[n]=r.LineUtil.simplify(e[n],t)},_update:function(){if(!this._map)return;this._clipPoints(),this._simplifyPoints(),this._updatePath()},_updatePath:function(){this._renderer._updatePoly(this)}}),r.polyline=function(e,t){return new r.Polyline(e,t)},r.PolyUtil={},r.PolyUtil.clipPolygon=function(e,t){var n,i=[1,4,2,8],s,o,u,a,f,l,c,h,p=r.LineUtil;for(s=0,l=e.length;s<l;s++)e[s]._code=p._getBitCode(e[s],t);for(u=0;u<4;u++){c=i[u],n=[];for(s=0,l=e.length,o=l-1;s<l;o=s++)a=e[s],f=e[o],a._code&c?f._code&c||(h=p._getEdgeIntersection(f,a,c,t),h._code=p._getBitCode(h,t),n.push(h)):(f._code&c&&(h=p._getEdgeIntersection(f,a,c,t),h._code=p._getBitCode(h,t),n.push(h)),n.push(a));e=n}return e},r.Polygon=r.Polyline.extend({options:{fill:!0},getCenter:function(){var e,t,n,r,i,s,o,u,a,f=this._rings[0];o=u=a=0;for(e=0,n=f.length,t=n-1;e<n;t=e++)r=f[e],i=f[t],s=r.y*i.x-i.y*r.x,u+=(r.x+i.x)*s,a+=(r.y+i.y)*s,o+=s*3;return this._map.layerPointToLatLng([u/o,a/o])},_convertLatLngs:function(e){var t=r.Polyline.prototype._convertLatLngs.call(this,e),n=t.length;return n>=2&&t[0]instanceof r.LatLng&&t[0].equals(t[n-1])&&t.pop(),t},_clipPoints:function(){if(this.options.noClip){this._parts=this._rings;return}var e=this._renderer._bounds,t=this.options.weight,n=new r.Point(t,t);e=new r.Bounds(e.min.subtract(n),e.max.add(n)),this._parts=[];for(var i=0,s=this._rings.length,o;i<s;i++)o=r.PolyUtil.clipPolygon(this._rings[i],e),o.length&&this._parts.push(o)},_updatePath:function(){this._renderer._updatePoly(this,!0)}}),r.polygon=function(e,t){return new r.Polygon(e,t)},r.Rectangle=r.Polygon.extend({initialize:function(e,t){r.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return e=r.latLngBounds(e),[e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}}),r.rectangle=function(e,t){return new r.Rectangle(e,t)},r.CircleMarker=r.Path.extend({options:{fill:!0,radius:10},initialize:function(e,t){r.setOptions(this,t),this._latlng=r.latLng(e),this._radius=this.options.radius},setLatLng:function(e){return this._latlng=r.latLng(e),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return r.Path.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,n=this._clickTolerance(),i=[e+n,t+n];this._pxBounds=new r.Bounds(this._point.subtract(i),this._point.add(i))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)}}),r.circleMarker=function(e,t){return new r.CircleMarker(e,t)},r.Circle=r.CircleMarker.extend({initialize:function(e,t,n){r.setOptions(this,n),this._latlng=r.latLng(e),this._mRadius=t},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY];return new r.LatLngBounds(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:r.Path.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,n=this._map,i=n.options.crs;if(i.distance===r.CRS.Earth.distance){var s=Math.PI/180,o=this._mRadius/r.CRS.Earth.R/s,u=n.project([t+o,e]),a=n.project([t-o,e]),f=u.add(a).divideBy(2),l=n.unproject(f).lat,c=Math.acos((Math.cos(o*s)-Math.sin(t*s)*Math.sin(l*s))/(Math.cos(t*s)*Math.cos(l*s)))/s;this._point=f.subtract(n.getPixelOrigin()),this._radius=isNaN(c)?0:Math.max(Math.round(f.x-n.project([l,e-c]).x),1),this._radiusY=Math.max(Math.round(f.y-u.y),1)}else{var h=i.unproject(i.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(h).x}this._updateBounds()}}),r.circle=function(e,t,n){return new r.Circle(e,t,n)},r.SVG=r.Renderer.extend({_initContainer:function(){this._container=r.SVG.create("svg"),this._paths={},this._initEvents(),this._container.setAttribute("pointer-events","none")},_update:function(){if(this._map._animatingZoom&&this._bounds)return;r.Renderer.prototype._update.call(this);var e=this._bounds,t=e.getSize(),n=this._container,i=this.getPane();r.Browser.mobileWebkit&&i.removeChild(n),r.DomUtil.setPosition(n,e.min),n.setAttribute("width",t.x),n.setAttribute("height",t.y),n.setAttribute("viewBox",[e.min.x,e.min.y,t.x,t.y].join(" ")),r.Browser.mobileWebkit&&i.appendChild(n)},_initPath:function(e){var t=e._path=r.SVG.create("path");e.options.className&&r.DomUtil.addClass(t,e.options.className),e.options.clickable&&r.DomUtil.addClass(t,"leaflet-clickable"),this._updateStyle(e)},_addPath:function(e){var t=e._path;this._container.appendChild(t),this._paths[r.stamp(t)]=e},_removePath:function(e){var t=e._path;r.DomUtil.remove(t),delete this._paths[r.stamp(t)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var t=e._path,n=e.options;if(!t)return;n.stroke?(t.setAttribute("stroke",n.color),t.setAttribute("stroke-opacity",n.opacity),t.setAttribute("stroke-width",n.weight),t.setAttribute("stroke-linecap",n.lineCap),t.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?t.setAttribute("stroke-dasharray",n.dashArray):t.removeAttribute("stroke-dasharray"),n.dashOffset?t.setAttribute("stroke-dashoffset",n.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),n.fill?(t.setAttribute("fill",n.fillColor||n.color),t.setAttribute("fill-opacity",n.fillOpacity),t.setAttribute("fill-rule","evenodd")):t.setAttribute("fill","none"),t.setAttribute("pointer-events",n.pointerEvents||(n.clickable?"visiblePainted":"none"))},_updatePoly:function(e,t){this._setPath(e,r.SVG.pointsToPath(e._parts,t))},_updateCircle:function(e){var t=e._point,n=e._radius,r=e._radiusY||n,i="a"+n+","+r+" 0 1,0 ",s=e._empty()?"M0 0":"M"+(t.x-n)+","+t.y+i+n*2+",0 "+i+ -n*2+",0 ";this._setPath(e,s)},_setPath:function(e,t){e._path.setAttribute("d",t)},_bringToFront:function(e){r.DomUtil.toFront(e._path)},_bringToBack:function(e){r.DomUtil.toBack(e._path)},_initEvents:function(){r.DomEvent.on(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu",this._fireMouseEvent,this)},_fireMouseEvent:function(e){this._paths[r.stamp(e.target||e.srcElement)]._fireMouseEvent(e)}}),r.extend(r.SVG,{create:function(e){return t.createElementNS("http://www.w3.org/2000/svg",e)},pointsToPath:function(e,t){var n="",i,s,o,u,a,f;for(i=0,o=e.length;i<o;i++){a=e[i];for(s=0,u=a.length;s<u;s++)f=a[s],n+=(s?"L":"M")+f.x+" "+f.y;n+=t?r.Browser.svg?"z":"x":""}return n||"M0 0"}}),r.Browser.svg=!!t.createElementNS&&!!r.SVG.create("svg").createSVGRect,r.svg=function(e){return r.Browser.svg||r.Browser.vml?new r.SVG(e):null},r.Browser.vml=!r.Browser.svg&&function(){try{var e=t.createElement("div");e.innerHTML='<v:shape adj="1"/>';var n=e.firstChild;return n.style.behavior="url(#default#VML)",n&&typeof n.adj=="object"}catch(r){return!1}}(),r.SVG.include(r.Browser.vml?{_initContainer:function(){this._container=r.DomUtil.create("div","leaflet-vml-container"),this._paths={},this._initEvents()},_update:function(){if(this._map._animatingZoom)return;r.Renderer.prototype._update.call(this)},_initPath:function(e){var t=e._container=r.SVG.create("shape");r.DomUtil.addClass(t,"leaflet-vml-shape "+(this.options.className||"")),t.coordsize="1 1",e._path=r.SVG.create("path"),t.appendChild(e._path),this._updateStyle(e)},_addPath:function(e){var t=e._container;this._container.appendChild(t),this._paths[r.stamp(t)]=e},_removePath:function(e){var t=e._container;r.DomUtil.remove(t),delete this._paths[r.stamp(t)]},_updateStyle:function(e){var t=e._stroke,n=e._fill,i=e.options,s=e._container;s.stroked=!!i.stroke,s.filled=!!i.fill,i.stroke?(t||(t=e._stroke=r.SVG.create("stroke"),s.appendChild(t)),t.weight=i.weight+"px",t.color=i.color,t.opacity=i.opacity,i.dashArray?t.dashStyle=r.Util.isArray(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):t.dashStyle="",t.endcap=i.lineCap.replace("butt","flat"),t.joinstyle=i.lineJoin):t&&(s.removeChild(t),e._stroke=null),i.fill?(n||(n=e._fill=r.SVG.create("fill"),s.appendChild(n)),n.color=i.fillColor||i.color,n.opacity=i.fillOpacity):n&&(s.removeChild(n),e._fill=null)},_updateCircle:function(e){var t=e._point,n=Math.round(e._radius),r=Math.round(e._radiusY||n);this._setPath(e,e._empty()?"M0 0":"AL "+t.x+","+t.y+" "+n+","+r+" 0,"+23592600)},_setPath:function(e,t){e._path.v=t}}:{}),r.Browser.vml&&(r.SVG.create=function(){try{return t.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return t.createElement("<lvml:"+e+' class="lvml">')}}catch(e){return function(e){return t.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}()),r.Canvas=r.Renderer.extend({onAdd:function(){r.Renderer.prototype.onAdd.call(this),this._layers=this._layers||{},this._draw()},_initContainer:function(){var e=this._container=t.createElement("canvas");r.DomEvent.on(e,"mousemove",this._onMouseMove,this).on(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),this._ctx=e.getContext("2d")},_update:function(){if(this._map._animatingZoom&&this._bounds)return;r.Renderer.prototype._update.call(this);var e=this._bounds,t=this._container,n=e.getSize(),i=r.Browser.retina?2:1;r.DomUtil.setPosition(t,e.min),t.width=i*n.x,t.height=i*n.y,t.style.width=n.x+"px",t.style.height=n.y+"px",r.Browser.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y)},_initPath:function(e){this._layers[r.stamp(e)]=e},_addPath:r.Util.falseFn,_removePath:function(e){e._removed=!0,this._requestRedraw(e)},_updatePath:function(e){this._redrawBounds=e._pxBounds,this._draw(!0),e._project(),e._update(),this._draw(),this._redrawBounds=null},_updateStyle:function(e){this._requestRedraw(e)},_requestRedraw:function(e){if(!this._map)return;this._redrawBounds=this._redrawBounds||new r.Bounds,this._redrawBounds.extend(e._pxBounds.min).extend(e._pxBounds.max),this._redrawRequest=this._redrawRequest||r.Util.requestAnimFrame(this._redraw,this)},_redraw:function(){this._redrawRequest=null,this._draw(!0),this._draw(),this._redrawBounds=null},_draw:function(e){this._clear=e;var t;for(var n in this._layers)t=this._layers[n],(!this._redrawBounds||t._pxBounds.intersects(this._redrawBounds))&&t._updatePath(),e&&t._removed&&(delete t._removed,delete this._layers[n])},_updatePoly:function(e,t){var n,r,i,s,o=e._parts,u=o.length,a=this._ctx;if(!u)return;a.beginPath();for(n=0;n<u;n++){for(r=0,i=o[n].length;r<i;r++)s=o[n][r],a[r?"lineTo":"moveTo"](s.x,s.y);t&&a.closePath()}this._fillStroke(a,e)},_updateCircle:function(e){if(e._empty())return;var t=e._point,n=this._ctx,r=e._radius,i=(e._radiusY||r)/r;i!==1&&(n.save(),n.scale(1,i)),n.beginPath(),n.arc(t.x,t.y/i,r,0,Math.PI*2,!1),i!==1&&n.restore(),this._fillStroke(n,e)},_fillStroke:function(e,t){var n=this._clear,r=t.options;e.globalCompositeOperation=n?"destination-out":"source-over",r.fill&&(e.globalAlpha=n?1:r.fillOpacity,e.fillStyle=r.fillColor||r.color,e.fill("evenodd")),r.stroke&&(e.globalAlpha=n?1:r.opacity,t._prevWeight=e.lineWidth=n?t._prevWeight+1:r.weight,e.strokeStyle=r.color,e.lineCap=r.lineCap,e.lineJoin=r.lineJoin,e.stroke())},_onClick:function(e){var t=this._map.mouseEventToLayerPoint(e);for(var n in this._layers)this._layers[n]._containsPoint(t)&&this._layers[n]._fireMouseEvent(e)},_onMouseMove:function(e){if(!this._map||this._map._animatingZoom)return;var t=this._map.mouseEventToLayerPoint(e);for(var n in this._layers)this._handleHover(this._layers[n],e,t)},_handleHover:function(e,t,n){if(!e.options.clickable)return;e._containsPoint(n)?(e._mouseInside||(r.DomUtil.addClass(this._container,"leaflet-clickable"),e._fireMouseEvent(t,"mouseover"),e._mouseInside=!0),e._fireMouseEvent(t)):e._mouseInside&&(r.DomUtil.removeClass(this._container,"leaflet-clickable"),e._fireMouseEvent(t,"mouseout"),e._mouseInside=!1)},_bringToFront:r.Util.falseFn,_bringToBack:r.Util.falseFn}),r.Browser.canvas=function(){return!!t.createElement("canvas").getContext}(),r.canvas=function(e){return r.Browser.canvas?new r.Canvas(e):null},r.Polyline.prototype._containsPoint=function(e,t){var n,i,s,o,u,a,f=this._clickTolerance();if(!this._pxBounds.contains(e))return!1;for(n=0,o=this._parts.length;n<o;n++){a=this._parts[n];for(i=0,u=a.length,s=u-1;i<u;s=i++){if(!t&&i===0)continue;if(r.LineUtil.pointToSegmentDistance(e,a[s],a[i])<=f)return!0}}return!1},r.Polygon.prototype._containsPoint=function(e){var t=!1,n,i,s,o,u,a,f,l;if(!this._pxBounds.contains(e))return!1;for(o=0,f=this._parts.length;o<f;o++){n=this._parts[o];for(u=0,l=n.length,a=l-1;u<l;a=u++)i=n[u],s=n[a],i.y>e.y!=s.y>e.y&&e.x<(s.x-i.x)*(e.y-i.y)/(s.y-i.y)+i.x&&(t=!t)}return t||r.Polyline.prototype._containsPoint.call(this,e,!0)},r.CircleMarker.prototype._containsPoint=function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()},r.GeoJSON=r.FeatureGroup.extend({initialize:function(e,t){r.setOptions(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t=r.Util.isArray(e)?e:e.features,n,i,s;if(t){for(n=0,i=t.length;n<i;n++)s=t[n],(s.geometries||s.geometry||s.features||s.coordinates)&&this.addData(s);return this}var o=this.options;if(o.filter&&!o.filter(e))return;var u=r.GeoJSON.geometryToLayer(e,o);return u.feature=r.GeoJSON.asFeature(e),u.defaultOptions=u.options,this.resetStyle(u),o.onEachFeature&&o.onEachFeature(e,u),this.addLayer(u)},resetStyle:function(e){return e.options=e.defaultOptions,this._setLayerStyle(e,this.options.style),this},setStyle:function(e){return this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(e,t){typeof t=="function"&&(t=t(e.feature)),e.setStyle&&e.setStyle(t)}}),r.extend(r.GeoJSON,{geometryToLayer:function(e,t){var n=e.type==="Feature"?e.geometry:e,i=n.coordinates,s=[],o=t&&t.pointToLayer,u=t&&t.coordsToLatLng||this.coordsToLatLng,a,f,l,c;switch(n.type){case"Point":return a=u(i),o?o(e,a):new r.Marker(a);case"MultiPoint":for(l=0,c=i.length;l<c;l++)a=u(i[l]),s.push(o?o(e,a):new r.Marker(a));return new r.FeatureGroup(s);case"LineString":case"MultiLineString":return f=this.coordsToLatLngs(i,n.type==="LineString"?0:1,u),new r.Polyline(f,t);case"Polygon":case"MultiPolygon":return f=this.coordsToLatLngs(i,n.type==="Polygon"?1:2,u),new r.Polygon(f,t);case"GeometryCollection":for(l=0,c=n.geometries.length;l<c;l++)s.push(this.geometryToLayer({geometry:n.geometries[l],type:"Feature",properties:e.properties},t));return new r.FeatureGroup(s);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(e){return new r.LatLng(e[1],e[0],e[2])},coordsToLatLngs:function(e,t,n){var r=[];for(var i=0,s=e.length,o;i<s;i++)o=t?this.coordsToLatLngs(e[i],t-1,n):(n||this.coordsToLatLng)(e[i]),r.push(o);return r},latLngToCoords:function(e){return e.alt!==n?[e.lng,e.lat,e.alt]:[e.lng,e.lat]},latLngsToCoords:function(e,t,n){var i=[];for(var s=0,o=e.length;s<o;s++)i.push(t?r.GeoJSON.latLngsToCoords(e[s],t-1,n):r.GeoJSON.latLngToCoords(e[s]));return!t&&n&&i.push(i[0]),i},getFeature:function(e,t){return e.feature?r.extend({},e.feature,{geometry:t}):r.GeoJSON.asFeature(t)},asFeature:function(e){return e.type==="Feature"?e:{type:"Feature",properties:{},geometry:e}}});var o={toGeoJSON:function(){return r.GeoJSON.getFeature(this,{type:"Point",coordinates:r.GeoJSON.latLngToCoords(this.getLatLng())})}};r.Marker.include(o),r.Circle.include(o),r.CircleMarker.include(o),r.Polyline.prototype.toGeoJSON=function(){var e=!this._flat(this._latlngs),t=r.GeoJSON.latLngsToCoords(this._latlngs,e?1:0);return r.GeoJSON.getFeature(this,{type:(e?"Multi":"")+"LineString",coordinates:t})},r.Polygon.prototype.toGeoJSON=function(){var e=!this._flat(this._latlngs),t=e&&!this._flat(this._latlngs[0]),n=r.GeoJSON.latLngsToCoords(this._latlngs,t?2:e?1:0,!0);return e&&this._latlngs.length===1&&(t=!0,n=[n]),e||(n=[n]),r.GeoJSON.getFeature(this,{type:(t?"Multi":"")+"Polygon",coordinates:n})},r.LayerGroup.include({toMultiPoint:function(){var e=[];return this.eachLayer(function(t){e.push(t.toGeoJSON().geometry.coordinates)}),r.GeoJSON.getFeature(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(e==="MultiPoint")return this.toMultiPoint();var t=e==="GeometryCollection",n=[];return this.eachLayer(function(e){if(e.toGeoJSON){var i=e.toGeoJSON();n.push(t?i.geometry:r.GeoJSON.asFeature(i))}}),t?r.GeoJSON.getFeature(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}}),r.geoJson=function(e,t){return new r.GeoJSON(e,t)};var u="_leaflet_events";r.DomEvent={on:function(e,t,n,i){if(typeof t=="object")for(var s in t)this._on(e,s,t[s],n);else{t=r.Util.splitWords(t);for(var o=0,u=t.length;o<u;o++)this._on(e,t[o],n,i)}return this},off:function(e,t,n,i){if(typeof t=="object")for(var s in t)this._off(e,s,t[s],n);else{t=r.Util.splitWords(t);for(var o=0,u=t.length;o<u;o++)this._off(e,t[o],n,i)}return this},_on:function(t,n,i,s){var o=n+r.stamp(i)+(s?"_"+r.stamp(s):"");if(t[u]&&t[u][o])return this;var a=function(n){return i.call(s||t,n||e.event)},f=a;return r.Browser.pointer&&n.indexOf("touch")===0?this.addPointerListener(t,n,a,o):(r.Browser.touch&&n==="dblclick"&&this.addDoubleTapListener&&this.addDoubleTapListener(t,a,o),"addEventListener"in t?n==="mousewheel"?(t.addEventListener("DOMMouseScroll",a,!1),t.addEventListener(n,a,!1)):n==="mouseenter"||n==="mouseleave"?(a=function(n){n=n||e.event;if(!r.DomEvent._checkMouse(t,n))return;return f(n)},t.addEventListener(n==="mouseenter"?"mouseover":"mouseout",a,!1)):(n==="click"&&r.Browser.android&&(a=function(e){return r.DomEvent._filterClick(e,f)}),t.addEventListener(n,a,!1)):"attachEvent"in t&&t.attachEvent("on"+n,a),t[u]=t[u]||{},t[u][o]=a,this)},_off:function(e,t,n,i){var s=t+r.stamp(n)+(i?"_"+r.stamp(i):""),o=e[u]&&e[u][s];return o?(r.Browser.pointer&&t.indexOf("touch")===0?this.removePointerListener(e,t,s):r.Browser.touch&&t==="dblclick"&&this.removeDoubleTapListener?this.removeDoubleTapListener(e,s):"removeEventListener"in e?t==="mousewheel"?(e.removeEventListener("DOMMouseScroll",o,!1),e.removeEventListener(t,o,!1)):e.removeEventListener(t==="mouseenter"?"mouseover":t==="mouseleave"?"mouseout":t,o,!1):"detachEvent"in e&&e.detachEvent("on"+t,o),e[u][s]=null,this):this},stopPropagation:function(e){return e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,r.DomEvent._skipped(e),this},disableScrollPropagation:function(e){return r.DomEvent.on(e,"mousewheel MozMousePixelScroll",r.DomEvent.stopPropagation)},disableClickPropagation:function(e){var t=r.DomEvent.stopPropagation;return r.DomEvent.on(e,r.Draggable.START.join(" "),t),r.DomEvent.on(e,{click:r.DomEvent._fakeStop,dblclick:t})},preventDefault:function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this},stop:function(e){return r.DomEvent.preventDefault(e).stopPropagation(e)},getMousePosition:function(e,t){if(!t)return new r.Point(e.clientX,e.clientY);var n=t.getBoundingClientRect();return new r.Point(e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop)},getWheelDelta:function(e){var t=0;return e.wheelDelta&&(t=e.wheelDelta/120),e.detail&&(t=-e.detail/3),t},_skipEvents:{},_fakeStop:function(e){r.DomEvent._skipEvents[e.type]=!0},_skipped:function(e){var t=this._skipEvents[e.type];return this._skipEvents[e.type]=!1,t},_checkMouse:function(e,t){var n=t.relatedTarget;if(!n)return!0;try{while(n&&n!==e)n=n.parentNode}catch(r){return!1}return n!==e},_filterClick:function(e,t){var n=e.timeStamp||e.originalEvent.timeStamp,i=r.DomEvent._lastClick&&n-r.DomEvent._lastClick;console.log(i);if(i&&i>100&&i<2500||e.target._simulatedClick&&!e._simulated){r.DomEvent.stop(e);return}return r.DomEvent._lastClick=n,t(e)}},r.DomEvent.addListener=r.DomEvent.on,r.DomEvent.removeListener=r.DomEvent.off,r.Draggable=r.Evented.extend({statics:{START:r.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(e,t){this._element=e,this._dragStartTarget=t||e},enable:function(){if(this._enabled)return;r.DomEvent.on(this._dragStartTarget,r.Draggable.START.join(" "),this._onDown,this),this._enabled=!0},disable:function(){if(!this._enabled)return;r.DomEvent.off(this._dragStartTarget,r.Draggable.START.join(" "),this._onDown,this),this._enabled=!1,this._moved=!1},_onDown:function(e){this._moved=!1;if(e.shiftKey||e.which!==1&&e.button!==1&&!e.touches)return;r.DomEvent.stopPropagation(e);if(r.Draggable._disabled)return;r.DomUtil.disableImageDrag(),r.DomUtil.disableTextSelection();if(this._moving)return;this.fire("down");var n=e.touches?e.touches[0]:e;this._startPoint=new r.Point(n.clientX,n.clientY),this._startPos=this._newPos=r.DomUtil.getPosition(this._element),r.DomEvent.on(t,r.Draggable.MOVE[e.type],this._onMove,this).on(t,r.Draggable.END[e.type],this._onUp,this)},_onMove:function(e){if(e.touches&&e.touches.length>1){this._moved=!0;return}var n=e.touches&&e.touches.length===1?e.touches[0]:e,i=new r.Point(n.clientX,n.clientY),s=i.subtract(this._startPoint);if(!s.x&&!s.y)return;if(r.Browser.touch&&Math.abs(s.x)+Math.abs(s.y)<3)return;r.DomEvent.preventDefault(e),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=r.DomUtil.getPosition(this._element).subtract(s),r.DomUtil.addClass(t.body,"leaflet-dragging"),r.DomUtil.addClass(e.target||e.srcElement,"leaflet-drag-target")),this._newPos=this._startPos.add(s),this._moving=!0,r.Util.cancelAnimFrame(this._animRequest),this._animRequest=r.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)},_updatePosition:function(){this.fire("predrag"),r.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(e){r.DomUtil.removeClass(t.body,"leaflet-dragging"),r.DomUtil.removeClass(e.target||e.srcElement,"leaflet-drag-target");for(var n in r.Draggable.MOVE)r.DomEvent.off(t,r.Draggable.MOVE[n],this._onMove,this).off(t,r.Draggable.END[n],this._onUp,this);r.DomUtil.enableImageDrag(),r.DomUtil.enableTextSelection(),this._moved&&this._moving&&(r.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),r.Handler=r.Class.extend({initialize:function(e){this._map=e},enable:function(){if(this._enabled)return;this._enabled=!0,this.addHooks()},disable:function(){if(!this._enabled)return;this._enabled=!1,this.removeHooks()},enabled:function(){return!!this._enabled}}),r.Map.mergeOptions({dragging:!0,inertia:!r.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:Infinity,inertiaThreshold:r.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),r.Map.Drag=r.Handler.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new r.Draggable(e._mapPane,e._container),this._draggable.on({down:this._onDown,dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),e.on("viewreset",this._onViewReset,this),e.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDown:function(){this._map._panAnim&&this._map._panAnim.stop()},_onDragStart:function(){var e=this._map;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var e=this._lastTime=+(new Date),t=this._lastPos=this._draggable._newPos;this._positions.push(t),this._times.push(e),e-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var e=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_onPreDrag:function(){var e=this._worldWidth,t=Math.round(e/2),n=this._initialWorldOffset,r=this._draggable._newPos.x,i=(r-t+n)%e+t-n,s=(r+t+n)%e-t-n,o=Math.abs(i+n)<Math.abs(s+n)?i:s;this._draggable._newPos.x=o},_onDragEnd:function(e){var t=this._map,n=t.options,i=+(new Date)-this._lastTime,s=!n.inertia||i>n.inertiaThreshold||!this._positions[0];t.fire("dragend",e);if(s)t.fire("moveend");else{var o=this._lastPos.subtract(this._positions[0]),u=(this._lastTime+i-this._times[0])/1e3,a=n.easeLinearity,f=o.multiplyBy(a/u),l=f.distanceTo([0,0]),c=Math.min(n.inertiaMaxSpeed,l),h=f.multiplyBy(c/l),p=c/(n.inertiaDeceleration*a),d=h.multiplyBy(-p/2).round();!d.x||!d.y?t.fire("moveend"):(d=t._limitOffset(d,t.options.maxBounds),r.Util.requestAnimFrame(function(){t.panBy(d,{duration:p,easeLinearity:a,noMoveStart:!0})}))}}}),r.Map.addInitHook("addHandler","dragging",r.Map.Drag),r.Map.mergeOptions({doubleClickZoom:!0}),r.Map.DoubleClickZoom=r.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,n=t.getZoom()+(e.originalEvent.shiftKey?-1:1);t.options.doubleClickZoom==="center"?t.setZoom(n):t.setZoomAround(e.containerPoint,n)}}),r.Map.addInitHook("addHandler","doubleClickZoom",r.Map.DoubleClickZoom),r.Map.mergeOptions({scrollWheelZoom:!0}),r.Map.ScrollWheelZoom=r.Handler.extend({addHooks:function(){r.DomEvent.on(this._map._container,{mousewheel:this._onWheelScroll,MozMousePixelScroll:r.DomEvent.preventDefault},this),this._delta=0},removeHooks:function(){r.DomEvent.off(this._map._container,{mousewheel:this._onWheelScroll,MozMousePixelScroll:r.DomEvent.preventDefault},this)},_onWheelScroll:function(e){var t=r.DomEvent.getWheelDelta(e);this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+(new Date));var n=Math.max(40-(+(new Date)-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(r.bind(this._performZoom,this),n),r.DomEvent.stop(e)},_performZoom:function(){var e=this._map,t=this._delta,n=e.getZoom();t=t>0?Math.ceil(t):Math.floor(t),t=Math.max(Math.min(t,4),-4),t=e._limitZoom(n+t)-n,this._delta=0,this._startTime=null;if(!t)return;e.options.scrollWheelZoom==="center"?e.setZoom(n+t):e.setZoomAround(this._lastMousePos,n+t)}}),r.Map.addInitHook("addHandler","scrollWheelZoom",r.Map.ScrollWheelZoom),r.extend(r.DomEvent,{_touchstart:r.Browser.msPointer?"MSPointerDown":r.Browser.pointer?"pointerdown":"touchstart",_touchend:r.Browser.msPointer?"MSPointerUp":r.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(e,n,i){function l(e){var t;r.Browser.pointer?(f.push(e.pointerId),t=f.length):t=e.touches.length;if(t>1)return;var n=Date.now(),i=n-(s||n);o=e.touches?e.touches[0]:e,u=i>0&&i<=a,s=n}function c(e){if(r.Browser.pointer){var t=f.indexOf(e.pointerId);if(t===-1)return;f.splice(t,1)}if(u){if(r.Browser.pointer){var i={},a,l;for(l in o)a=o[l],i[l]=a&&a.bind?a.bind(o):a;o=i}o.type="dblclick",n(o),s=null}}var s,o,u=!1,a=250,f=[],h="_leaflet_",p=this._touchstart,d=this._touchend;e[h+p+i]=l,e[h+d+i]=c;var v=r.Browser.pointer?t.documentElement:e;return e.addEventListener(p,l,!1),v.addEventListener(d,c,!1),r.Browser.pointer&&v.addEventListener(r.DomEvent.POINTER_CANCEL,c,!1),this},removeDoubleTapListener:function(e,n){var i="_leaflet_",s=r.Browser.pointer?t.documentElement:e,o=e[i+this._touchend+n];return e.removeEventListener(this._touchstart,e[i+this._touchstart+n],!1),s.removeEventListener(this._touchend,o,!1),r.Browser.pointer&&s.removeEventListener(r.DomEvent.POINTER_CANCEL,o,!1),this}}),r.extend(r.DomEvent,{POINTER_DOWN:r.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:r.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:r.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:r.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:{},addPointerListener:function(e,t,n,r){return t==="touchstart"?this._addPointerStart(e,n,r):t==="touchmove"?this._addPointerMove(e,n,r):t==="touchend"&&this._addPointerEnd(e,n,r),this},removePointerListener:function(e,t,n){var r=e["_leaflet_"+t+n];return t==="touchstart"?e.removeEventListener(this.POINTER_DOWN,r,!1):t==="touchmove"?e.removeEventListener(this.POINTER_MOVE,r,!1):t==="touchend"&&(e.removeEventListener(this.POINTER_UP,r,!1),e.removeEventListener(this.POINTER_CANCEL,r,!1)),this},_addPointerStart:function(e,n,i){var s=r.bind(function(e){r.DomEvent.preventDefault(e),this._pointers[e.pointerId]=e,this._handlePointer(e,n)},this);e["_leaflet_touchstart"+i]=s,e.addEventListener(this.POINTER_DOWN,s,!1);if(!this._pointerDocListener){var o=r.bind(function(e){delete this._pointers[e.pointerId]},this);t.documentElement.addEventListener(this.POINTER_UP,o,!1),t.documentElement.addEventListener(this.POINTER_CANCEL,o,!1),this._pointerDocListener=!0}},_handlePointer:function(e,t){e.touches=[];for(var n in this._pointers)e.touches.push(this._pointers[n]);e.changedTouches=[e],t(e)},_addPointerMove:function(e,t,n){var i=r.bind(function(e){if((e.pointerType===e.MSPOINTER_TYPE_MOUSE||e.pointerType==="mouse")&&e.buttons===0)return;this._pointers[e.pointerId]=e,this._handlePointer(e,t)},this);e["_leaflet_touchmove"+n]=i,e.addEventListener(this.POINTER_MOVE,i,!1)},_addPointerEnd:function(e,t,n){var i=r.bind(function(e){delete this._pointers[e.pointerId],this._handlePointer(e,t)},this);e["_leaflet_touchend"+n]=i,e.addEventListener(this.POINTER_UP,i,!1),e.addEventListener(this.POINTER_CANCEL,i,!1)}}),r.Map.mergeOptions({touchZoom:r.Browser.touch&&!r.Browser.android23,bounceAtZoomLimits:!0}),r.Map.TouchZoom=r.Handler.extend({addHooks:function(){r.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){r.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var n=this._map;if(!e.touches||e.touches.length!==2||n._animatingZoom||this._zooming)return;var i=n.mouseEventToLayerPoint(e.touches[0]),s=n.mouseEventToLayerPoint(e.touches[1]),o=n._getCenterLayerPoint();this._startCenter=i.add(s)._divideBy(2),this._startDist=i.distanceTo(s),this._moved=!1,this._zooming=!0,this._centerOffset=o.subtract(this._startCenter),n._panAnim&&n._panAnim.stop(),r.DomEvent.on(t,"touchmove",this._onTouchMove,this).on(t,"touchend",this._onTouchEnd,this),r.DomEvent.preventDefault(e)},_onTouchMove:function(e){if(!e.touches||e.touches.length!==2||!this._zooming)return;var t=this._map,n=t.mouseEventToLayerPoint(e.touches[0]),i=t.mouseEventToLayerPoint(e.touches[1]);this._scale=n.distanceTo(i)/this._startDist,this._delta=n._add(i)._divideBy(2)._subtract(this._startCenter);if(!t.options.bounceAtZoomLimits&&(t.getZoom()===t.getMinZoom()&&this._scale<1||t.getZoom()===t.getMaxZoom()&&this._scale>1))return;this._moved||(t.fire("movestart").fire("zoomstart"),this._moved=!0),r.Util.cancelAnimFrame(this._animRequest),this._animRequest=r.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),r.DomEvent.preventDefault(e)},_updateOnMove:function(){var e=this._map;e.options.touchZoom==="center"?this._center=e.getCenter():this._center=e.layerPointToLatLng(this._getTargetCenter()),this._zoom=e.getScaleZoom(this._scale),e._animateZoom(this._center,this._zoom)},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,r.Util.cancelAnimFrame(this._animRequest),r.DomEvent.off(t,"touchmove",this._onTouchMove).off(t,"touchend",this._onTouchEnd);var e=this._map,n=e.getZoom(),i=this._zoom-n,s=e._limitZoom(n+(i>0?Math.ceil(i):Math.floor(i)));e._animateZoom(this._center,s,!0)},_getTargetCenter:function(){var e=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(e)}}),r.Map.addInitHook("addHandler","touchZoom",r.Map.TouchZoom),r.Map.mergeOptions({tap:!0,tapTolerance:15}),r.Map.Tap=r.Handler.extend({addHooks:function(){r.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){r.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(!e.touches)return;r.DomEvent.preventDefault(e),this._fireClick=!0;if(e.touches.length>1){this._fireClick=!1,clearTimeout(this._holdTimeout);return}var n=e.touches[0],i=n.target;this._startPos=this._newPos=new r.Point(n.clientX,n.clientY),i.tagName&&i.tagName.toLowerCase()==="a"&&r.DomUtil.addClass(i,"leaflet-active"),this._holdTimeout=setTimeout(r.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",n))},this),1e3),this._simulateEvent("mousedown",n),r.DomEvent.on(t,{touchmove:this._onMove,touchend:this._onUp},this)},_onUp:function(e){clearTimeout(this._holdTimeout),r.DomEvent.off(t,{touchmove:this._onMove,touchend:this._onUp},this);if(this._fireClick&&e&&e.changedTouches){var n=e.changedTouches[0],i=n.target;i&&i.tagName&&i.tagName.toLowerCase()==="a"&&r.DomUtil.removeClass(i,"leaflet-active"),this._simulateEvent("mouseup",n),this._isTapValid()&&this._simulateEvent("click",n)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(e){var t=e.touches[0];this._newPos=new r.Point(t.clientX,t.clientY)},_simulateEvent:function(n,r){var i=t.createEvent("MouseEvents");i._simulated=!0,r.target._simulatedClick=!0,i.initMouseEvent(n,!0,!0,e,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),r.target.dispatchEvent(i)}}),r.Browser.touch&&!r.Browser.pointer&&r.Map.addInitHook("addHandler","tap",r.Map.Tap),r.Map.mergeOptions({boxZoom:!0}),r.Map.BoxZoom=r.Handler.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane},addHooks:function(){r.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){r.DomEvent.off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_onMouseDown:function(e){this._moved=!1;if(!e.shiftKey||e.which!==1&&e.button!==1)return!1;r.DomUtil.disableTextSelection(),r.DomUtil.disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(e),r.DomEvent.on(t,{mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=r.DomUtil.create("div","leaflet-zoom-box",this._container),r.DomUtil.addClass(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var t=new r.Bounds(this._point,this._startPoint),n=t.getSize();r.DomUtil.setPosition(this._box,t.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(r.DomUtil.remove(this._box),r.DomUtil.removeClass(this._container,"leaflet-crosshair")),r.DomUtil.enableTextSelection(),r.DomUtil.enableImageDrag(),r.DomEvent.off(t,{mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(){this._finish();if(!this._moved)return;var e=new r.LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})},_onKeyDown:function(e){e.keyCode===27&&this._finish()}}),r.Map.addInitHook("addHandler","boxZoom",r.Map.BoxZoom),r.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),r.Map.Keyboard=r.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(e){this._map=e,this._setPanOffset(e.options.keyboardPanOffset),this._setZoomOffset(e.options.keyboardZoomOffset)},addHooks:function(){var e=this._map._container;e.tabIndex===-1&&(e.tabIndex="0"),r.DomEvent.on(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),r.DomEvent.off(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(this._focused)return;var n=t.body,r=t.documentElement,i=n.scrollTop||r.scrollTop,s=n.scrollLeft||r.scrollLeft;this._map._container.focus(),e.scrollTo(s,i)},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(e){var t=this._panKeys={},n=this.keyCodes,r,i;for(r=0,i=n.left.length;r<i;r++)t[n.left[r]]=[-1*e,0];for(r=0,i=n.right.length;r<i;r++)t[n.right[r]]=[e,0];for(r=0,i=n.down.length;r<i;r++)t[n.down[r]]=[0,e];for(r=0,i=n.up.length;r<i;r++)t[n.up[r]]=[0,-1*e]},_setZoomOffset:function(e){var t=this._zoomKeys={},n=this.keyCodes,r,i;for(r=0,i=n.zoomIn.length;r<i;r++)t[n.zoomIn[r]]=e;for(r=0,i=n.zoomOut.length;r<i;r++)t[n.zoomOut[r]]=-e},_addHooks:function(){r.DomEvent.on(t,"keydown",this._onKeyDown,this)},_removeHooks:function(){r.DomEvent.off(t,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(e.altKey||e.ctrlKey||e.metaKey)return;var t=e.keyCode,n=this._map;if(t in this._panKeys){if(n._panAnim&&n._panAnim._inProgress)return;n.panBy(this._panKeys[t]),n.options.maxBounds&&n.panInsideBounds(n.options.maxBounds)}else{if(!(t in this._zoomKeys))return;n.setZoom(n.getZoom()+this._zoomKeys[t])}r.DomEvent.stop(e)}}),r.Map.addInitHook("addHandler","keyboard",r.Map.Keyboard),r.Handler.MarkerDrag=r.Handler.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new r.Draggable(e,e)),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),r.DomUtil.addClass(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),r.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var e=this._marker,t=e._shadow,n=r.DomUtil.getPosition(e._icon),i=e._map.layerPointToLatLng(n);t&&r.DomUtil.setPosition(t,n),e._latlng=i,e.fire("move",{latlng:i}).fire("drag")},_onDragEnd:function(e){this._marker.fire("moveend").fire("dragend",e)}}),r.Control=r.Class.extend({options:{position:"topright"},initialize:function(e){r.setOptions(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this._map=e;var t=this._container=this.onAdd(e),n=this.getPosition(),i=e._controlCorners[n];return r.DomUtil.addClass(t,"leaflet-control"),n.indexOf("bottom")!==-1?i.insertBefore(t,i.firstChild):i.appendChild(t),this},remove:function(){return r.DomUtil.remove(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),r.control=function(e){return new r.Control(e)},r.Map.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){function i(i,s){var o=t+i+" "+t+s;e[i+s]=r.DomUtil.create("div",o,n)}var e=this._controlCorners={},t="leaflet-",n=this._controlContainer=r.DomUtil.create("div",t+"control-container",this._container);i("top","left"),i("top","right"),i("bottom","left"),i("bottom","right")},_clearControlPos:function(){r.DomUtil.remove(this._controlContainer)}}),r.Control.Zoom=r.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",n=r.DomUtil.create("div",t+" leaflet-bar"),i=this.options;return this._zoomInButton=this._createButton(i.zoomInText,i.zoomInTitle,t+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(i.zoomOutText,i.zoomOutTitle,t+"-out",n,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(e){this._map.zoomIn(e.shiftKey?3:1)},_zoomOut:function(e){this._map.zoomOut(e.shiftKey?3:1)},_createButton:function(e,t,n,i,s){var o=r.DomUtil.create("a",n,i);return o.innerHTML=e,o.href="#",o.title=t,r.DomEvent.on(o,"mousedown dblclick",r.DomEvent.stopPropagation).on(o,"click",r.DomEvent.stop).on(o,"click",s,this).on(o,"click",this._refocusOnMap,this),o},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";r.DomUtil.removeClass(this._zoomInButton,t),r.DomUtil.removeClass(this._zoomOutButton,t),e._zoom===e.getMinZoom()&&r.DomUtil.addClass(this._zoomOutButton,t),e._zoom===e.getMaxZoom()&&r.DomUtil.addClass(this._zoomInButton,t)}}),r.Map.mergeOptions({zoomControl:!0}),r.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new r.Control.Zoom,this.addControl(this.zoomControl))}),r.control.zoom=function(e){return new r.Control.Zoom(e)},r.Control.Attribution=r.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(e){r.setOptions(this,e),this._attributions={}},onAdd:function(e){this._container=r.DomUtil.create("div","leaflet-control-attribution"),r.DomEvent.disableClickPropagation(this._container);for(var t in e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());return this._update(),this._container},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){if(!e)return;return this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this},removeAttribution:function(e){if(!e)return;return this._attributions[e]&&(this._attributions[e]--,this._update()),this},_update:function(){if(!this._map)return;var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var n=[];this.options.prefix&&n.push(this.options.prefix),e.length&&n.push(e.join(", ")),this._container.innerHTML=n.join(" | ")}}),r.Map.mergeOptions({attributionControl:!0}),r.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new r.Control.Attribution).addTo(this))}),r.control.attribution=function(e){return new r.Control.Attribution(e)},r.Control.Scale=r.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var t="leaflet-control-scale",n=r.DomUtil.create("div",t),i=this.options;return this._addScales(i,t+"-line",n),e.on(i.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),n},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,n){e.metric&&(this._mScale=r.DomUtil.create("div",t,n)),e.imperial&&(this._iScale=r.DomUtil.create("div",t,n))},_update:function(){var e=this._map,t=e.getSize().y/2,n=r.CRS.Earth.distance(e.containerPointToLatLng([0,t]),e.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(n)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var t=this._getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,n,t/e)},_updateImperial:function(e){var t=e*3.2808399,n,r,i;t>5280?(n=t/5280,r=this._getRoundNum(n),this._updateScale(this._iScale,r+" mi",r/n)):(i=this._getRoundNum(t),this._updateScale(this._iScale,i+" ft",i/t))},_updateScale:function(e,t,n){e.style.width=Math.round(this.options.maxWidth*n)-10+"px",e.innerHTML=t},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,t*n}}),r.control.scale=function(e){return new r.Control.Scale(e)},r.Control.Layers=r.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(e,t,n){r.setOptions(this,n),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var i in e)this._addLayer(e[i],i);for(i in t)this._addLayer(t[i],i,!0)},onAdd:function(){return this._initLayout(),this._update(),this._container},addBaseLayer:function(e,t){return this._addLayer(e,t),this._update()},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._update()},removeLayer:function(e){return e.off("add remove",this._onLayerChange,this),delete this._layers[r.stamp(e)],this._update()},_initLayout:function(){var e="leaflet-control-layers",t=this._container=r.DomUtil.create("div",e);t.setAttribute("aria-haspopup",!0),r.Browser.touch?r.DomEvent.on(t,"click",r.DomEvent.stopPropagation):r.DomEvent.disableClickPropagation(t).disableScrollPropagation(t);var n=this._form=r.DomUtil.create("form",e+"-list");if(this.options.collapsed){r.Browser.android||r.DomEvent.on(t,{mouseenter:this._expand,mouseleave:this._collapse},this);var i=this._layersLink=r.DomUtil.create("a",e+"-toggle",t);i.href="#",i.title="Layers",r.Browser.touch?r.DomEvent.on(i,"click",r.DomEvent.stop).on(i,"click",this._expand,this):r.DomEvent.on(i,"focus",this._expand,this),r.DomEvent.on(n,"click",function(){setTimeout(r.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=r.DomUtil.create("div",e+"-base",n),this._separator=r.DomUtil.create("div",e+"-separator",n),this._overlaysList=r.DomUtil.create("div",e+"-overlays",n),t.appendChild(n)},_addLayer:function(e,t,n){e.on("add remove",this._onLayerChange,this);var i=r.stamp(e);this._layers[i]={layer:e,name:t,overlay:n},this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex))},_update:function(){if(!this._container)return;this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var e,t,n,r;for(n in this._layers)r=this._layers[n],this._addItem(r),t=t||r.overlay,e=e||!r.overlay;return this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._layers[r.stamp(e.target)].overlay,n=t?e.type==="add"?"overlayadd":"overlayremove":e.type==="add"?"baselayerchange":null;n&&this._map.fire(n,e.target)},_createRadioElement:function(e,n){var r='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(n?' checked="checked"':"")+"/>",i=t.createElement("div");return i.innerHTML=r,i.firstChild},_addItem:function(e){var n=t.createElement("label"),i=this._map.hasLayer(e.layer),s;e.overlay?(s=t.createElement("input"),s.type="checkbox",s.className="leaflet-control-layers-selector",s.defaultChecked=i):s=this._createRadioElement("leaflet-base-layers",i),s.layerId=r.stamp(e.layer),r.DomEvent.on(s,"click",this._onInputClick,this);var o=t.createElement("span");o.innerHTML=" "+e.name,n.appendChild(s),n.appendChild(o);var u=e.overlay?this._overlaysList:this._baseLayersList;return u.appendChild(n),n},_onInputClick:function(){var e=this._form.getElementsByTagName("input"),t,n,r;this._handlingClick=!0;for(var i=0,s=e.length;i<s;i++)t=e[i],n=this._layers[t.layerId].layer,r=this._map.hasLayer(n),t.checked&&!r?this._map.addLayer(n):!t.checked&&r&&this._map.removeLayer(n);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){r.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){r.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded")}}),r.control.layers=function(e,t,n){return new r.Control.Layers(e,t,n)},r.PosAnimation=r.Evented.extend({run:function(e,t,n,i){this.stop(),this._el=e,this._inProgress=!0,this._newPos=t,this.fire("start"),e.style[r.DomUtil.TRANSITION]="all "+(n||.25)+"s cubic-bezier(0,0,"+(i||.5)+",1)",r.DomEvent.on(e,r.DomUtil.TRANSITION_END,this._onTransitionEnd,this),r.DomUtil.setPosition(e,t),r.Util.falseFn(e.offsetWidth),this._stepTimer=setInterval(r.bind(this._onStep,this),50)},stop:function(){if(!this._inProgress)return;this._newPos=this._getPos(),this._newPos&&r.DomUtil.setPosition(this._el,this._newPos),this._onTransitionEnd(),r.Util.falseFn(this._el.offsetWidth)},_onStep:function(){var e=this._getPos();if(!e){this._onTransitionEnd();return}this._el._leaflet_pos=e,this.fire("step")},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var t,n,i,s=this._el,o=e.getComputedStyle(s);if(r.Browser.any3d){i=o[r.DomUtil.TRANSFORM].match(this._transformRe);if(!i)return;t=parseFloat(i[1]),n=parseFloat(i[2])}else t=parseFloat(o.left),n=parseFloat(o.top);return new r.Point(t,n,!0)},_onTransitionEnd:function(){r.DomEvent.off(this._el,r.DomUtil.TRANSITION_END,this._onTransitionEnd,this);if(!this._inProgress)return;this._inProgress=!1,this._el.style[r.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end")}}),r.Map.include({setView:function(e,t,i){t=t===n?this._zoom:this._limitZoom(t),e=this._limitCenter(r.latLng(e),t,this.options.maxBounds),i=i||{},this._panAnim&&this._panAnim.stop();if(this._loaded&&!i.reset&&i!==!0){i.animate!==n&&(i.zoom=r.extend({animate:i.animate},i.zoom),i.pan=r.extend({animate:i.animate},i.pan));var s=this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,i.zoom):this._tryAnimatedPan(e,i.pan);if(s)return clearTimeout(this._sizeTimer),this}return this._resetView(e,t),this},panBy:function(e,t){e=r.point(e).round(),t=t||{};if(!e.x&&!e.y)return this;this._panAnim||(this._panAnim=new r.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire("movestart");if(t.animate!==!1){r.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(e);this._panAnim.run(this._mapPane,n,t.duration||.25,t.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){r.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,t){var n=this._getCenterOffset(e)._floor();return(t&&t.animate)!==!0&&!this.getSize().contains(n)?!1:(this.panBy(n,t),!0)}}),r.PosAnimation=r.DomUtil.TRANSITION?r.PosAnimation:r.PosAnimation.extend({run:function(e,t,n,i){this.stop(),this._el=e,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(i||.5,.2),this._startPos=r.DomUtil.getPosition(e),this._offset=t.subtract(this._startPos),this._startTime=+(new Date),this.fire("start"),this._animate()},stop:function(){if(!this._inProgress)return;this._step(),this._complete()},_animate:function(){this._animId=r.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var e=+(new Date)-this._startTime,t=this._duration*1e3;e<t?this._runFrame(this._easeOut(e/t)):(this._runFrame(1),this._complete())},_runFrame:function(e){var t=this._startPos.add(this._offset.multiplyBy(e));r.DomUtil.setPosition(this._el,t),this.fire("step")},_complete:function(){r.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),r.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4});var a=r.DomUtil.TRANSITION&&r.Browser.any3d&&!r.Browser.mobileOpera;a&&r.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation,this._zoomAnimated&&r.DomEvent.on(this._mapPane,r.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),r.Map.include(a?{_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,n){if(this._animatingZoom)return!0;n=n||{};if(!this._zoomAnimated||n.animate===!1||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var i=this.getZoomScale(t),s=this._getCenterOffset(e)._divideBy(1-1/i);return n.animate!==!0&&!this.getSize().contains(s)?!1:(r.Util.requestAnimFrame(function(){this.fire("movestart").fire("zoomstart")._animateZoom(e,t,!0)},this),!0)},_animateZoom:function(e,t,n){n&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=t,r.Draggable&&(r.Draggable._disabled=!0),r.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"));var i=this.getZoomScale(t),s=this._getCenterLayerPoint().add(this._getCenterOffset(e)._divideBy(1-1/i));this.fire("zoomanim",{center:e,zoom:t,origin:s,scale:i})},_onZoomTransitionEnd:function(){this._animatingZoom=!1,r.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),r.Draggable&&(r.Draggable._disabled=!1)}}:{}),r.Map.include({_defaultLocateOptions:{timeout:1e4,watch:!1},locate:function(e){e=this._locateOptions=r.extend(this._defaultLocateOptions,e);if(!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=r.bind(this._handleGeolocationResponse,this),n=r.bind(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,n,e):navigator.geolocation.getCurrentPosition(t,n,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){var t=e.code,n=e.message||(t===1?"permission denied":t===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+n+"."})},_handleGeolocationResponse:function(e){var t=e.coords.latitude,n=e.coords.longitude,i=new r.LatLng(t,n),s=180*e.coords.accuracy/40075017,o=s/Math.cos(Math.PI/180*t),u=r.latLngBounds([t-s,n-o],[t+s,n+o]),a=this._locateOptions;if(a.setView){var f=this.getBoundsZoom(u);this.setView(i,a.maxZoom?Math.min(f,a.maxZoom):f)}var l={latlng:i,bounds:u,timestamp:e.timestamp};for(var c in e.coords)typeof e.coords[c]=="number"&&(l[c]=e.coords[c]);this.fire("locationfound",l)}})}(window,document),define("views/parkingareaMarker",["jquery","underscore","backbone","leaflet","views/parkingarea"],function(e,t,n,r){return app.views.ParkingareaMarker=n.View.extend({initialize:function(e){this.options=e||{},t.bindAll(this,"render"),this.model.bind("change",function(e){console.log("Change event in ParkingareaMarker",e.id),this.render()},this)},render:function(){var e=r.marker([this.model.attributes.latitude,this.model.attributes.longitude]).addTo(app.views.map),t=new app.views.Parkingarea({tagName:"div",model:this.model,template:"#parkingareapopup_template"});e.bindPopup(t.render().el)}}),app.views.ParkingareaMarker}),define("views/map",["jquery","underscore","backbone","leaflet","models/parkingareaCollection","views/parkingarea","views/parkingareaMarker"],function(e,t,n,r){return app.views.Map=n.View.extend({initialize:function(){this.options={},t.bindAll(this,"render"),this.collection.bind("reset",function(e){console.log("event reset in ParkingareaList"),this.render()},this),this.collection.bind("add",function(e){console.log("event add in ParkingareaList"),this.$el.append((new app.views.Parkingarea({model:e,template:"#parkingareaMarker_template"})).el)},this),this.collection.bind("remove",function(e){console.log("event remove in ParkingareaList"),this.render()},this),this.realod_view=new app.views.Reload},render:function(){return this.$el.html(t.template(e("#map_template").html())),window.L_DISABLE_3D=!0,app.views.map=r.map("map",{zoomControl:!0}).setView([46.498174099984666,11.357255100008064],13),r.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{detectRetina:!0,attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(app.views.map),r.Icon.Default.imagePath="./images",this.collection.each(function(e){var t=new app.views.ParkingareaMarker({model:e});t.render()},this),e("#update_all",this.$el).append(app.reload.render().el),this},events:{}}),app.views.Map}),!function(){var e={},t=!1,n=!1,r=!1,i=function(e){var t,n=document.querySelectorAll(".toggle");for(;e&&e!==document;e=e.parentNode)for(t=n.length;t--;)if(n[t]===e)return e};window.addEventListener("touchstart",function(n){n=n.originalEvent||n,r=i(n.target);if(!r)return;var s=r.querySelector(".toggle-handle"),o=r.clientWidth,u=s.clientWidth,a=r.classList.contains("active")?o-u:0;e={pageX:n.touches[0].pageX-a,pageY:n.touches[0].pageY},t=!1}),window.addEventListener("touchmove",function(i){i=i.originalEvent||i;if(i.touches.length>1)return;if(!r)return;var s=r.querySelector(".toggle-handle"),o=i.touches[0],u=r.clientWidth,a=s.clientWidth,f=u-a;t=!0,n=o.pageX-e.pageX;if(Math.abs(n)<Math.abs(o.pageY-e.pageY))return;i.preventDefault();if(n<0)return s.style.webkitTransform="translate3d(0,0,0)";if(n>f)return s.style.webkitTransform="translate3d("+f+"px,0,0)";s.style.webkitTransform="translate3d("+n+"px,0,0)",r.classList[n>u/2-a/2?"add":"remove"]("active")}),window.addEventListener("touchend",function(e){if(!r)return;var i=r.querySelector(".toggle-handle"),s=r.clientWidth,o=i.clientWidth,u=s-o,a=!t&&!r.classList.contains("active")||t&&n>s/2-o/2;a?i.style.webkitTransform="translate3d("+u+"px,0,0)":i.style.webkitTransform="translate3d(0,0,0)",r.classList[a?"add":"remove"]("active"),e=new CustomEvent("toggle",{detail:{isActive:a},bubbles:!0,cancelable:!0}),r.dispatchEvent(e),t=!1,r=!1})}(),define("views/../../lib/toggles",function(){}),define("views/settings",["jquery","underscore","backbone","views/parkingarea","../../lib/toggles"],function(e,t,n){return app.views.Settings=n.View.extend({render:function(){this.$el.html(t.template(e("#settings_template").html()));var n=window.localStorage.getItem("realtime_update"),r=window.localStorage.getItem("gps_startup");return n=="true"&&e("#realtime_update",this.el).addClass("active"),r=="true"&&e("#gps_startup",this.el).addClass("active"),this},events:{"click .btn-back":"back","toggle #realtime_update":"toggle_realtime","toggle #gps_startup":"toggle_gps_startup"},toggle_realtime:function(){var t=e("#realtime_update",this.el).hasClass("active");t?n.trigger("tick:start"):n.trigger("tick:stop"),window.localStorage.setItem("realtime_update",t)},toggle_gps_startup:function(){var t=e("#gps_startup",this.el).hasClass("active");window.localStorage.setItem("gps_startup",t),console.log(t)},back:function(){return window.history.back(),!1}}),app.views.Settings}),define("BasicRouter",["jquery","underscore","backbone","views/home","views/map","views/settings","models/history","views/flotchart","models/parkingareaCollection"],function(e,t,n,r){return app.routers.BasicRouter=n.Router.extend({routes:{"":"home","parkingarea/:id":"parkingAreaDetails","employees/:id/history":"history","employees/:id/map":"map",map:"map",settings:"settings"},initialize:function(){app.parkingarea_collection=new app.models.ParkingareaCollection,app.reload=new app.views.Reload({collection:app.parkingarea_collection})},home:function(){console.log("home"),this.check_views(),app.reload.undelegateEvents(),app.homeView?app.homeView.delegateEvents():(app.homeView=new app.views.Home({collection:app.parkingarea_collection}),app.homeView.render()),app.mapView&&console.log("map"),e("#container").html(app.homeView.$el),e("#update_all").html(app.reload.render().$el),app.reload.delegateEvents(),setTimeout(function(){app.views.myScroll&&app.views.myScroll.refresh()},100);return},parkingAreaDetails:function(t){this.check_views(),app.reload.undelegateEvents();var n=app.parkingarea_collection.get(t);app.parkingarea_view=new app.views.Parkingarea({el:e("#container"),model:n,template:"#parkingareaDetails_template",collection:app.parkingarea_collection}),app.former_views.push(app.parkingarea_view),app.parkingarea_view.render(),app.reload.delegateEvents();return},map:function(t){this.check_views(),app.reload.undelegateEvents();var n=app.parkingarea_collection;app.mapView?app.mapView.delegateEvents():app.mapView=new app.views.Map({el:e("#container"),collection:n}),app.mapView.render(),app.reload.delegateEvents();return},settings:function(t){this.check_views(),app.settingsView=new app.views.Settings({el:e("#container")}),app.settingsView.render();return},check_views:function(){t.each(app.former_views,function(e){console.log("elimino view",e),e.undelegateEvents(),e.unbind(),e.stopListening()}),app.former_views=[]}}),app.routers.BasicRouter});var app={views:{},models:{},routers:{},utils:{},adapters:{},former_views:[]},opts_spinner={lines:12,length:7,width:2,radius:3,corners:1,rotate:0,direction:1,color:"#000",speed:.6,trail:40,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:"15",left:"15"};define("app",["jquery","underscore","backbone","BasicRouter"],function(e,t,n,r){var i={initialize:function(){var e=window.localStorage.getItem("favorites");e||window.localStorage.setItem("favorites",JSON.stringify([]));var t=window.localStorage.getItem("realtime_update");t||window.localStorage.setItem("realtime_update",!0);var n=window.localStorage.getItem("gps_startup");n||window.localStorage.setItem("gps_startup",!0),this.bindEvents();return},bindEvents:function(){window.addEventListener("orientationchange",this.orientationChange,!0),document.addEventListener("pause",i.onPause,!1),document.addEventListener("resume",i.onResume,!1),this.listenTo(n,"tick:start",this.startTick,this),document.addEventListener("deviceready",this.onDeviceReady,!1);var e=new CustomEvent("appready",{});document.dispatchEvent(e);return},onDeviceReady:function(){i.receivedEvent("deviceready"),document.addEventListener("online",i.online,!1),document.addEventListener("offline",i.offline,!1);return},receivedEvent:function(e){console.log("Received Event: "+e),app.router=new r,n.history.start();return},orientationChange:function(e){var t="portrait";if(window.orientation==-90||window.orientation==90)t="landscape";console.log("phonegap: orientationChange -- "+t),setTimeout(function(){app.views.myScroll&&app.views.myScroll.refresh()},100)},startTick:function(){app.setIntervalId_30s=setInterval(function(){n.trigger("tick:30secs")},3e4)},stopTick:function(){console.log("stopTick"),clearInterval(app.setIntervalId_30s)},onPause:function(){n.trigger("tick:stop");return},onResume:function(){n.trigger("tick:start"),console.log("onResume"),navigator.vibrate(3e3);return},online:function(){backbone.trigger("tick:start"),navigator.vibrate(3e3);return},offline:function(){n.trigger("tick:stop"),console.log("offline"),navigator.vibrate(3e3);return}};return t.extend(i,n.Events),i}),"document"in self&&!("classList"in document.createElement("_"))&&function(e){if(!("Element"in e))return;var t="classList",n="prototype",r=e.Element[n],i=Object,s=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(t in this&&this[t]===e)return t;return-1},u=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},a=function(e,t){if(t==="")throw new u("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new u("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},f=function(e){var t=s.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],r=0,i=n.length;for(;r<i;r++)this.push(n[r]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},l=f[n]=[],c=function(){return new f(this)};u[n]=Error[n],l.item=function(e){return this[e]||null},l.contains=function(e){return e+="",a(this,e)!==-1},l.add=function(){var e=arguments,t=0,n=e.length,r,i=!1;do r=e[t]+"",a(this,r)===-1&&(this.push(r),i=!0);while(++t<n);i&&this._updateClassName()},l.remove=function(){var e=arguments,t=0,n=e.length,r,i=!1;do{r=e[t]+"";var s=a(this,r);s!==-1&&(this.splice(s,1),i=!0)}while(++t<n);i&&this._updateClassName()},l.toggle=function(e,t){e+="";var n=this.contains(e),r=n?t!==!0&&"remove":t!==!1&&"add";return r&&this[r](e),!n},l.toString=function(){return this.join(" ")};if(i.defineProperty){var h={get:c,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,h)}catch(p){p.number===-2146823252&&(h.enumerable=!1,i.defineProperty(r,t,h))}}else i[n].__defineGetter__&&r.__defineGetter__(t,c)}(self),define("classlist",function(){}),+function(e){function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(e.style[n]!==undefined)return{end:t[n]};return!1}e.fn.emulateTransitionEnd=function(t){var n=!1,r=this;e(this).one(e.support.transition.end,function(){n=!0});var i=function(){n||e(r).trigger(e.support.transition.end)};return setTimeout(i,t),this},e(function(){e.support.transition=t()})}(jQuery),define("transition",function(){}),require.config({paths:{jquery:"../lib/jquery-2.1.1.min",underscore:"../lib/underscore",backbone:"../lib/backbone",Iscroll:"../lib/iscroll",flot:"../lib/jquery.flot.min",flot_time:"../lib/jquery.flot.time",flot_threshold:"../lib/jquery.flot.threshold",jquerymobile:"../lib/jquery.mobile.custom.min",leaflet:"../lib/leaflet-src",spin:"../lib/spin.min",classlist:"../lib/classList.min",transition:"../lib/transition",latlon:"../lib/latlon",geo:"../lib/geo",leaflet_google:"../lib/leaflet-google",backbone_touch:"../lib/backbone.touch"},shim:{Iscroll:{exports:"IScroll"},flot:["jquery"],flot_time:["flot"],flot_threshold:["flot_time"],jquerymobile:["jquery"],transition:["jquery"],latlon:["geo"],leaflet_google:["leaflet"],backbone_touch:["backbone"]}}),require(["app","base","jquery","classlist","transition"],function(e,t,n){n.ajaxSetup({cache:!1,timeout:25e3}),e.initialize()}),define("main",function(){});